/**
* WorldWide Telescope Web Client
* Copyright 2014-2023 .NET Foundation
* Licensed under the MIT License
* Git hash f7a3bf5049f3e3a38838a04d93daa35506baa8a1
**/
((root,factory)=>{"object"==typeof exports?factory(exports):"function"==typeof define&&define.amd?define(["exports"],factory):factory(root)})(this,function(exports){function IntroJs(obj){this._targetElement=obj,this._options={nextLabel:"Next &rarr;",prevLabel:"&larr; Back",skipLabel:"Skip",doneLabel:"Done",tooltipPosition:"bottom",tooltipClass:"",exitOnEsc:!0,exitOnOverlayClick:!0,showStepNumbers:!0,keyboardNavigation:!0,showButtons:!0,showBullets:!0,scrollToElement:!0}}function _introForElement(targetElm){var introItems=[],self=this;if(this._options.steps)for(var allIntroSteps=[],i=0,stepsLength=this._options.steps.length;i<stepsLength;i++){var floatingElementQuery,currentItem=function _cloneObject(object){if(null==object||"object"!=typeof object||void 0!==object.nodeType)return object;var temp={};for(var key in object)temp[key]=_cloneObject(object[key]);return temp}(this._options.steps[i]);currentItem.step=introItems.length+1,"string"==typeof currentItem.element&&(currentItem.element=document.querySelector(currentItem.element)),void 0!==currentItem.element&&null!=currentItem.element||(null==(floatingElementQuery=document.querySelector(".introjsFloatingElement"))&&((floatingElementQuery=document.createElement("div")).className="introjsFloatingElement",document.body.appendChild(floatingElementQuery)),currentItem.element=floatingElementQuery,currentItem.position="floating"),null!=currentItem.element&&introItems.push(currentItem)}else{if((allIntroSteps=targetElm.querySelectorAll("*[data-intro]")).length<1)return!1;for(var i=0,elmsLength=allIntroSteps.length;i<elmsLength;i++){var currentElement=allIntroSteps[i],step=parseInt(currentElement.getAttribute("data-step"),10);0<step&&(introItems[step-1]={element:currentElement,intro:currentElement.getAttribute("data-intro"),step:parseInt(currentElement.getAttribute("data-step"),10),tooltipClass:currentElement.getAttribute("data-tooltipClass"),position:currentElement.getAttribute("data-position")||this._options.tooltipPosition})}for(var nextStep=0,i=0,elmsLength=allIntroSteps.length;i<elmsLength;i++)if(null==(currentElement=allIntroSteps[i]).getAttribute("data-step")){for(;;){if(void 0===introItems[nextStep])break;nextStep++}introItems[nextStep]={element:currentElement,intro:currentElement.getAttribute("data-intro"),step:nextStep+1,tooltipClass:currentElement.getAttribute("data-tooltipClass"),position:currentElement.getAttribute("data-position")||this._options.tooltipPosition}}}for(var tempIntroItems=[],z=0;z<introItems.length;z++)introItems[z]&&tempIntroItems.push(introItems[z]);return(introItems=tempIntroItems).sort(function(a,b){return a.step-b.step}),self._introItems=introItems,function(targetElm){var overlayLayer=document.createElement("div"),styleText="",self=this;{var elementPosition;overlayLayer.className="introjs-overlay","body"===targetElm.tagName.toLowerCase()?(styleText+="top: 0;bottom: 0; left: 0;right: 0;position: fixed;",overlayLayer.setAttribute("style",styleText)):(elementPosition=_getOffset(targetElm))&&(styleText+="width: "+elementPosition.width+"px; height:"+elementPosition.height+"px; top:"+elementPosition.top+"px;left: "+Math.max(0,elementPosition.left)+"px;",overlayLayer.setAttribute("style",styleText))}return targetElm.appendChild(overlayLayer),overlayLayer.onclick=function(){1==self._options.exitOnOverlayClick&&(_exitIntro.call(self,targetElm),null!=self._introExitCallback)&&self._introExitCallback.call(self)},setTimeout(function(){styleText+="opacity: .8;",overlayLayer.setAttribute("style",styleText)},10),!0}.call(self,targetElm)&&(_nextStep.call(self),targetElm.querySelector(".introjs-skipbutton"),targetElm.querySelector(".introjs-nextbutton"),self._onKeyDown=function(e){27===e.keyCode&&1==self._options.exitOnEsc?(_exitIntro.call(self,targetElm),null!=self._introExitCallback&&self._introExitCallback.call(self)):37===e.keyCode?_previousStep.call(self):39!==e.keyCode&&13!==e.keyCode||(_nextStep.call(self),e.preventDefault?e.preventDefault():e.returnValue=!1)},self._onResize=function(e){_setHelperLayerPosition.call(self,document.querySelector(".introjs-helperLayer"))},window.addEventListener?(this._options.keyboardNavigation&&window.addEventListener("keydown",self._onKeyDown,!0),window.addEventListener("resize",self._onResize,!0)):document.attachEvent&&(this._options.keyboardNavigation&&document.attachEvent("onkeydown",self._onKeyDown),document.attachEvent("onresize",self._onResize))),!1}function _nextStep(){var nextStep;$(".introjs-nextbutton").prop("disabled")||(this._direction="forward",void 0===this._currentStep?this._currentStep=0:++this._currentStep,this._introItems.length<=this._currentStep?("function"==typeof this._introCompleteCallback&&this._introCompleteCallback.call(this),_exitIntro.call(this,this._targetElement)):(nextStep=this._introItems[this._currentStep],void 0!==this._introBeforeChangeCallback&&this._introBeforeChangeCallback.call(this,nextStep.element),function(targetElement){void 0!==this._introChangeCallback&&this._introChangeCallback.call(this,targetElement.element);var self=this,oldHelperLayer=document.querySelector(".introjs-helperLayer");_getOffset(targetElement.element);if(null!=oldHelperLayer){var oldHelperNumberLayer=oldHelperLayer.querySelector(".introjs-helperNumberLayer"),oldtooltipLayer=oldHelperLayer.querySelector(".introjs-tooltiptext"),oldArrowLayer=oldHelperLayer.querySelector(".introjs-arrow"),oldtooltipContainer=oldHelperLayer.querySelector(".introjs-tooltip"),skipTooltipButton=oldHelperLayer.querySelector(".introjs-skipbutton"),prevTooltipButton=oldHelperLayer.querySelector(".introjs-prevbutton"),nextTooltipButton=oldHelperLayer.querySelector(".introjs-nextbutton"),fixParents=(oldtooltipContainer.style.opacity=0,null!=oldHelperNumberLayer&&(null!=(lastIntroItem=this._introItems[0<=targetElement.step-2?targetElement.step-2:0])&&"forward"==this._direction&&"floating"==lastIntroItem.position||"backward"==this._direction&&"floating"==targetElement.position)&&(oldHelperNumberLayer.style.opacity=0),_setHelperLayerPosition.call(self,oldHelperLayer),document.querySelectorAll(".introjs-fixParent"));if(fixParents&&0<fixParents.length)for(var i=fixParents.length-1;0<=i;i--)fixParents[i].className=fixParents[i].className.replace(/introjs-fixParent/g,"").replace(/^\s+|\s+$/g,"");var lastIntroItem=document.querySelector(".introjs-showElement");lastIntroItem.className=lastIntroItem.className.replace(/introjs-[a-zA-Z]+/g,"").replace(/^\s+|\s+$/g,""),self._lastShowElementTimer&&clearTimeout(self._lastShowElementTimer),self._lastShowElementTimer=setTimeout(function(){null!=oldHelperNumberLayer&&(oldHelperNumberLayer.innerHTML=targetElement.step),oldtooltipLayer.innerHTML=targetElement.intro,_placeTooltip.call(self,targetElement.element,oldtooltipContainer,oldArrowLayer,oldHelperNumberLayer),oldHelperLayer.querySelector(".introjs-bullets li > a.active").className="",oldHelperLayer.querySelector('.introjs-bullets li > a[data-stepnumber="'+targetElement.step+'"]').className="active",oldtooltipContainer.style.opacity=1,oldHelperNumberLayer&&(oldHelperNumberLayer.style.opacity=1)},350)}else{for(var helperNumberLayer,lastIntroItem=document.createElement("div"),arrowLayer=document.createElement("div"),tooltipLayer=document.createElement("div"),tooltipTextLayer=document.createElement("div"),bulletsLayer=document.createElement("div"),buttonsLayer=document.createElement("div"),ulContainer=(lastIntroItem.className="introjs-helperLayer",_setHelperLayerPosition.call(self,lastIntroItem),this._targetElement.appendChild(lastIntroItem),arrowLayer.className="introjs-arrow",tooltipTextLayer.className="introjs-tooltiptext",tooltipTextLayer.innerHTML=targetElement.intro,!(bulletsLayer.className="introjs-bullets")===this._options.showBullets&&(bulletsLayer.style.display="none"),document.createElement("ul")),i=0,stepsLength=this._introItems.length;i<stepsLength;i++){var innerLi=document.createElement("li"),anchorLink=document.createElement("a");anchorLink.onclick=function(){self.goToStep(this.getAttribute("data-stepnumber"))},0===i&&(anchorLink.className="active"),anchorLink.href="javascript:void(0);",anchorLink.innerHTML="&nbsp;",anchorLink.setAttribute("data-stepnumber",this._introItems[i].step),innerLi.appendChild(anchorLink),ulContainer.appendChild(innerLi)}bulletsLayer.appendChild(ulContainer),!(buttonsLayer.className="introjs-tooltipbuttons")===this._options.showButtons&&(buttonsLayer.style.display="none"),tooltipLayer.className="introjs-tooltip",tooltipLayer.appendChild(tooltipTextLayer),tooltipLayer.appendChild(bulletsLayer),1==this._options.showStepNumbers&&((helperNumberLayer=document.createElement("span")).className="introjs-helperNumberLayer",helperNumberLayer.innerHTML=targetElement.step,lastIntroItem.appendChild(helperNumberLayer)),tooltipLayer.appendChild(arrowLayer),lastIntroItem.appendChild(tooltipLayer),(nextTooltipButton=document.createElement("a")).onclick=function(){self._introItems.length-1!=self._currentStep&&_nextStep.call(self)},nextTooltipButton.href="javascript:void(0);",nextTooltipButton.innerHTML=this._options.nextLabel,(prevTooltipButton=document.createElement("a")).onclick=function(){0!=self._currentStep&&_previousStep.call(self)},prevTooltipButton.href="javascript:void(0);",prevTooltipButton.innerHTML=this._options.prevLabel,(skipTooltipButton=document.createElement("a")).className="introjs-button introjs-skipbutton",skipTooltipButton.href="javascript:void(0);",skipTooltipButton.innerHTML=this._options.skipLabel,skipTooltipButton.onclick=function(){self._introItems.length-1==self._currentStep&&"function"==typeof self._introCompleteCallback&&self._introCompleteCallback.call(self),self._introItems.length-1!=self._currentStep&&"function"==typeof self._introExitCallback&&self._introExitCallback.call(self),_exitIntro.call(self,self._targetElement)},buttonsLayer.appendChild(skipTooltipButton),1<this._introItems.length&&(buttonsLayer.appendChild(prevTooltipButton),buttonsLayer.appendChild(nextTooltipButton)),tooltipLayer.appendChild(buttonsLayer),_placeTooltip.call(self,targetElement.element,tooltipLayer,arrowLayer,helperNumberLayer)}0==this._currentStep&&1<this._introItems.length?(prevTooltipButton.className="introjs-button introjs-prevbutton introjs-disabled",nextTooltipButton.className="introjs-button introjs-nextbutton",skipTooltipButton.innerHTML=this._options.skipLabel):this._introItems.length-1==this._currentStep||1==this._introItems.length?(skipTooltipButton.innerHTML=this._options.doneLabel,prevTooltipButton.className="introjs-button introjs-prevbutton",nextTooltipButton.className="introjs-button introjs-nextbutton introjs-disabled"):(prevTooltipButton.className="introjs-button introjs-prevbutton",nextTooltipButton.className="introjs-button introjs-nextbutton",skipTooltipButton.innerHTML=this._options.skipLabel);nextTooltipButton.focus(),targetElement.element.className+=" introjs-showElement";tooltipTextLayer=_getPropValue(targetElement.element,"position");"absolute"!==tooltipTextLayer&&"relative"!==tooltipTextLayer&&(targetElement.element.className+=" introjs-relativePosition");var parentElm=targetElement.element.parentNode;for(;null!=parentElm&&"body"!==parentElm.tagName.toLowerCase();){var zIndex=_getPropValue(parentElm,"z-index"),opacity=parseFloat(_getPropValue(parentElm,"opacity"));(/[0-9]+/.test(zIndex)||opacity<1)&&(parentElm.className+=" introjs-fixParent"),parentElm=parentElm.parentNode}(el=>0<=(el=el.getBoundingClientRect()).top&&0<=el.left&&el.bottom+80<=window.innerHeight&&el.right<=window.innerWidth)(targetElement.element)||!0!==this._options.scrollToElement||(bulletsLayer=targetElement.element.getBoundingClientRect(),lastIntroItem=(()=>{var D;return null!=window.innerWidth?{width:window.innerWidth,height:window.innerHeight}:{width:(D=document.documentElement).clientWidth,height:D.clientHeight}})().height,buttonsLayer=bulletsLayer.bottom-(bulletsLayer.bottom-bulletsLayer.top),tooltipLayer=bulletsLayer.bottom-lastIntroItem,buttonsLayer<0||targetElement.element.clientHeight>lastIntroItem?window.scrollBy(0,buttonsLayer-30):window.scrollBy(0,100+tooltipLayer));void 0!==this._introAfterChangeCallback&&this._introAfterChangeCallback.call(this,targetElement.element)}.call(this,nextStep)))}function _previousStep(){}function _exitIntro(targetElement){var overlayLayer=targetElement.querySelector(".introjs-overlay");if(null!=overlayLayer){overlayLayer.style.opacity=0,setTimeout(function(){overlayLayer.parentNode&&overlayLayer.parentNode.removeChild(overlayLayer)},500);var targetElement=targetElement.querySelector(".introjs-helperLayer"),targetElement=(targetElement&&targetElement.parentNode.removeChild(targetElement),document.querySelector(".introjsFloatingElement")),targetElement=(targetElement&&targetElement.parentNode.removeChild(targetElement),document.querySelector(".introjs-showElement")),fixParents=(targetElement&&(targetElement.className=targetElement.className.replace(/introjs-[a-zA-Z]+/g,"").replace(/^\s+|\s+$/g,"")),document.querySelectorAll(".introjs-fixParent"));if(fixParents&&0<fixParents.length)for(var i=fixParents.length-1;0<=i;i--)fixParents[i].className=fixParents[i].className.replace(/introjs-fixParent/g,"").replace(/^\s+|\s+$/g,"");window.removeEventListener?window.removeEventListener("keydown",this._onKeyDown,!0):document.detachEvent&&document.detachEvent("onkeydown",this._onKeyDown),this._currentStep=void 0}}function _placeTooltip(targetElement,tooltipLayer,arrowLayer,helperNumberLayer){if(tooltipLayer.style.top=null,tooltipLayer.style.right=null,tooltipLayer.style.bottom=null,tooltipLayer.style.left=null,tooltipLayer.style.marginLeft=null,tooltipLayer.style.marginTop=null,arrowLayer.style.display="inherit",void 0!==helperNumberLayer&&null!=helperNumberLayer&&(helperNumberLayer.style.top=null,helperNumberLayer.style.left=null),this._introItems[this._currentStep]){var tooltipCssClass="",currentStepObj=this._introItems[this._currentStep],tooltipCssClass=(tooltipCssClass=("string"==typeof currentStepObj.tooltipClass?currentStepObj:this._options).tooltipClass,tooltipLayer.className=("introjs-tooltip "+tooltipCssClass).replace(/^\s+|\s+$/g,""),this._options.tooltipClass);switch(this._introItems[this._currentStep].position){case"top":tooltipLayer.style.left="15px",tooltipLayer.style.top="-"+(_getOffset(tooltipLayer).height+10)+"px",arrowLayer.className="introjs-arrow bottom";break;case"right":tooltipLayer.style.left=_getOffset(targetElement).width+20+"px",arrowLayer.className="introjs-arrow left";break;case"left":1==this._options.showStepNumbers&&(tooltipLayer.style.top="15px"),tooltipLayer.style.right=_getOffset(targetElement).width+20+"px",arrowLayer.className="introjs-arrow right";break;case"floating":arrowLayer.style.display="none";var tooltipOffset=_getOffset(tooltipLayer);tooltipLayer.style.left="50%",tooltipLayer.style.top="50%",tooltipLayer.style.marginLeft="-"+tooltipOffset.width/2+"px",tooltipLayer.style.marginTop="-"+tooltipOffset.height/2+"px",void 0!==helperNumberLayer&&null!=helperNumberLayer&&(helperNumberLayer.style.left="-"+(tooltipOffset.width/2+18)+"px",helperNumberLayer.style.top="-"+(tooltipOffset.height/2+18)+"px");break;default:tooltipLayer.style.bottom="-"+(_getOffset(tooltipLayer).height+10)+"px",arrowLayer.className="introjs-arrow top"}}}function _setHelperLayerPosition(helperLayer){var currentElement,elementPosition;helperLayer&&this._introItems[this._currentStep]&&(elementPosition=_getOffset((currentElement=this._introItems[this._currentStep]).element),helperLayer.setAttribute("style","width: "+(elementPosition.width+(helperLayer="floating"==currentElement.position?0:10))+"px; height:"+(elementPosition.height+helperLayer)+"px; top:"+(elementPosition.top-5)+"px;left: "+Math.max(elementPosition.left-5,0)+"px;"))}function _getPropValue(element,propName){var propValue="";return element.currentStyle?propValue=element.currentStyle[propName]:document.defaultView&&document.defaultView.getComputedStyle&&(propValue=document.defaultView.getComputedStyle(element,null).getPropertyValue(propName)),propValue&&propValue.toLowerCase?propValue.toLowerCase():propValue}function _getOffset(element){for(var elementPosition={},_x=(elementPosition.width=element.offsetWidth,elementPosition.height=element.offsetHeight,0),_y=0;element&&!isNaN(element.offsetLeft)&&!isNaN(element.offsetTop);)_x+=element.offsetLeft,_y+=element.offsetTop,element=element.offsetParent;return elementPosition.top=_y,elementPosition.left=_x,elementPosition}function introJs(targetElm){if("object"==typeof targetElm)return new IntroJs(targetElm);if("string"!=typeof targetElm)return new IntroJs(document.body);if(targetElm=document.querySelector(targetElm))return new IntroJs(targetElm);throw new Error("There is no element with given selector.")}return introJs.version="0.8.0",introJs.fn=IntroJs.prototype={clone:function(){return new IntroJs(this)},setOption:function(option,value){return this._options[option]=value,this},setOptions:function(options){return this._options=((obj1,obj2)=>{var attrname,obj3={};for(attrname in obj1)obj3[attrname]=obj1[attrname];for(attrname in obj2)obj3[attrname]=obj2[attrname];return obj3})(this._options,options),this},start:function(){return _introForElement.call(this,this._targetElement),this},goToStep:function(step){return function(step){this._currentStep=step-2,void 0!==this._introItems&&_nextStep.call(this)}.call(this,step),this},nextStep:function(){return _nextStep.call(this),this},previousStep:function(){return _previousStep.call(this),this},exit:function(){_exitIntro.call(this,this._targetElement)},refresh:function(){return _setHelperLayerPosition.call(this,document.querySelector(".introjs-helperLayer")),this},onbeforechange:function(providedCallback){if("function"!=typeof providedCallback)throw new Error("Provided callback for onbeforechange was not a function");return this._introBeforeChangeCallback=providedCallback,this},onchange:function(providedCallback){if("function"!=typeof providedCallback)throw new Error("Provided callback for onchange was not a function.");return this._introChangeCallback=providedCallback,this},onafterchange:function(providedCallback){if("function"!=typeof providedCallback)throw new Error("Provided callback for onafterchange was not a function");return this._introAfterChangeCallback=providedCallback,this},oncomplete:function(providedCallback){if("function"!=typeof providedCallback)throw new Error("Provided callback for oncomplete was not a function.");return this._introCompleteCallback=providedCallback,this},onexit:function(providedCallback){if("function"!=typeof providedCallback)throw new Error("Provided callback for onexit was not a function.");return this._introExitCallback=providedCallback,this}},exports.introJs=introJs});var ngIntroDirective=angular.module("angular-intro",[]),wwt=(ngIntroDirective.directive("ngIntroOptions",["$timeout","$parse",function($timeout,$parse){return{restrict:"A",link:function(scope,element,attrs){scope[attrs.ngIntroMethod]=function(step){var intro="string"==typeof step?introJs(step):introJs();intro.setOptions(scope.$eval(attrs.ngIntroOptions)),attrs.ngIntroOncomplete&&intro.oncomplete($parse(attrs.ngIntroOncomplete)(scope)),attrs.ngIntroOnexit&&intro.onexit($parse(attrs.ngIntroOnexit)(scope)),attrs.ngIntroOnchange&&intro.onchange($parse(attrs.ngIntroOnchange)(scope)),attrs.ngIntroOnbeforechange&&intro.onbeforechange($parse(attrs.ngIntroOnbeforechange)(scope)),attrs.ngIntroOnafterchange&&intro.onafterchange($parse(attrs.ngIntroOnafterchange)(scope)),("number"==typeof step?intro.goToStep(step):intro).start()},"true"==attrs.ngIntroAutostart&&$timeout(function(){$parse(attrs.ngIntroMethod)(scope)()})}}}]),{gitShortSha:"f7a3bf5",staticAssetsPrefix:"//web.wwtassets.org/webclient/",userwebUrlPrefix:"..",coreStaticUrlPrefix:"//cdn.worldwidetelescope.org/",communitiesUrlPrefix:"..",msLiveOAuthAppId:"000000004015657B",msLiveOAuthRedirUrl:"http://worldwidetelescope.org/webclient",app:angular.module("wwtApp",["mgcrea.ngStrap","ngTouch","ngAnimate","ngRoute","wwtControllers","ngCookies","angular-intro"]).config(function($sceDelegateProvider){$sceDelegateProvider.resourceUrlWhitelist(["self","https://web.wwtassets.org/**","http://web.wwtassets.org/**","https://cdn.worldwidetelescope.org/**","http://cdn.worldwidetelescope.org/**"])}),controllers:angular.module("wwtControllers",[])});$(window).on("load",function(){var scr=document.createElement("script");scr.setAttribute("src",wwtlib.URLHelpers.singleton.coreStaticUrl("data/searchdata_v2.min.js")),document.getElementsByTagName("head")[0].appendChild(scr)}),wwt.app.directive("ngContextMenu",["$dropdown",function($dropdown){return{restrict:"A",scope:{method:"&ngContextMenu"},link:function(scope,element){var handler=scope.method();element.bind("contextmenu",function(event){event.preventDefault();var index=(wwt.lastmouseContext=event).delegateTarget.getAttribute("index");index?handler(parseInt(index),event):handler&&handler(event)})}}}]),wwt.app.directive("ngRightClick",["$parse",function($parse){return function(scope,element,attrs){var fn=$parse(attrs.ngRightClick);element.bind("contextmenu",function(event){scope.$applyAsync(function(){(wwt.lastmouseContext=event).preventDefault(),fn(scope,{$event:event})})})}}]),wwt.app.directive("copyable",["$timeout",function($timeout){return{restrict:"E",templateUrl:wwt.staticAssetsPrefix+"views/copy-to-clipboard.html",scope:{copy:"="},link:function(scope,el,attrs){var input=el.find("input")[0];el.find(".input-group-addon").bind("click",function(event){input.select(),document.execCommand("copy"),$timeout(function(){scope.copy.showStatus=!0,scope.copy.fadeout=!1,input.blur()},0),$timeout(function(){scope.copy.fadeout=!0},3333)})}}}]),wwt.app.directive("localize",["Localization","$rootScope","AppState","Util",function(loc,$rootScope,appState,util){return function($scope,element,attrs){function replaceText(useEn){try{var el,exp,localized,attrib;""===attrs.localize?setTimeout(function(){replaceText(useEn)},200):(el=$(element),exp=new RegExp(attrs.localize,"g"),localized=useEn?attrs.localize:loc.getFromEn(attrs.localize),attrs.locAttrOnly||attrs.localizeOnly||(-1==el.html().indexOf(attrs.localize)||useEn?el.html(localized):el.html(el.html().replace(exp,localized))),(attrs.localizeAttr||attrs.localizeOnly)&&(attrib=attrs.localizeAttr||attrs.localizeOnly,el.attr(attrib)&&-1!=el.attr(attrib).indexOf(localized)&&!useEn?el.attr(attrib,el.attr(attrib).replace(exp,localized)):el.attr(attrib,localized)))}catch(er){util.log("localize",er)}}"EN"!==appState.get("language")?$rootScope.languagePromise.then(function(){replaceText(!1)}):replaceText(!0)}}]),wwt.app.directive("scrollBuffer",["$window",function($window){return function($scope,element,attrs){for(var buffer=parseInt(attrs.scrollBuffer),scope=$scope,parent=$(element).parent();!parent.hasClass("modal-dialog");)parent=parent.parent();parent.on("scroll",function(){var st=this.scrollTop,e=$(this),w=e.width(),h=e.height(),e=e.find(".modal-content div.tn").first(),w=Math.floor(w/e.width()),totalItems=(Math.ceil((st+h)/e.height())+buffer)*w;scope.scrollDepth<totalItems&&scope.$applyAsync(function(){scope.scrollDepth=totalItems})})}}]),wwt.app.directive("jqueryScrollbar",["$rootScope","$window",function($rootScope,$window){return function($scope,element,attrs){var movable=$(element).find(".jspPane");$(element).on("mousewheel",function(event){var event=event.originalEvent,event=(movable=$(element).find(".jspPane"),Math.max(-1,Math.min(1,event.wheelDelta||-event.detail))),curLeft=Math.abs(Math.floor(movable.position().left)),newLeft=event<0?(console.log("down"),newLeft=155*Math.floor((curLeft+155)/155),Math.max(curLeft,Math.abs(newLeft))):(console.log("up"),newLeft=155*Math.floor((curLeft-155)/155),Math.min(curLeft,Math.abs(newLeft)));$(element).data("jsp").scrollToX(Math.abs(newLeft))})}}]),wwt.app.directive("contenteditable",[function(){return{restrict:"A",link:function(scope,element,attrs){var isDuration,hasFocused,stop,s,lastGoodValue,el,incrementing;function validate(){var min,secString,minSec=element.html().split(":"),tenths=0;if(2===minSec.length)min=parseInt(minSec[0].replace(/\D/g,"")),secString=minSec[1].split(".");else{if(1!==minSec.length)return void(s.duration=lastGoodValue);secString=minSec[min=0].split(".")}minSec=parseInt(secString[0].replace(/\D/g,"")),2===secString.length&&(tenths=parseInt(secString[1].replace(/\D/g,""))),s.duration=6e4*min+1e3*minSec+100*tenths}function renderDuration(){100<s.duration?lastGoodValue=s.duration:s.duration=lastGoodValue;var min=s.duration/60/1e3<<0,secs=s.duration/1e3%60,tenths=Math.round(secs%1*10),secs=Math.floor(secs);s.durationString=min+":"+(secs<10?"0":"")+secs+"."+tenths,stop.set_duration(lastGoodValue),hasFocused&&angular.element("#currentTourPanel").scope().refreshStops(),element.html(s.durationString)}function select(){setTimeout(function(){var txt=element.text(),range=document.createRange(),start=0,end=txt.length,txt=(isDuration&&(start=txt.indexOf(":")+1,end=txt.indexOf(".")),range.setStart(el.firstChild,start),range.setEnd(el.firstChild,end),window.getSelection());txt.removeAllRanges(),txt.addRange(range)},10)}element.hasClass("paste-control")||(isDuration=element.hasClass("duration"),hasFocused=!1,stop=scope.stop,s=stop,el=$(element)[0],isDuration?renderDuration():element.html(s.description),element.on("keyup",function(event){if(isDuration)switch(event.keyCode){case 33:case 38:return stop.duration+=1e3,void renderDuration();case 34:case 40:return stop.duration-=1e3,void renderDuration();case 27:case 13:case 9:return void element.blur();default:validate()}}),incrementing=!1,element.on("focus",function(){hasFocused=!0,isDuration?incrementing||(scope.$apply(function(){stop.editingDuration=!0}),element.parent().find(".tinybutton").on("mousedown",function(e){incrementing=!0,setTimeout(function(){incrementing=!1},500),$(this).hasClass("duration-up")?stop.duration+=1e3:stop.duration-=1e3,renderDuration(),select()}),element.parent().find(".tinybutton").on("mouseup",select)):select()}),element.on("blur",function(){incrementing||scope.$applyAsync(function(){isDuration?(validate(),renderDuration(),stop.set_duration(lastGoodValue),stop.editingDuration=!1):s.set_description(element.html()),angular.element("#currentTourPanel").scope().refreshStops()})}))}}}]),wwt.app.directive("movable",["AppState",function(appState){return{restrict:"A",link:function(scope,element,attrs){var stickyCss,el=$(element),target=el,element=target.data("movable-target"),oncomplete=function(){};element&&(el=target.parentsUntil(element).parent()),target.data("sticky")&&((stickyCss=appState.get(target.data("sticky")))&&stickyCss.top&&(el.css(stickyCss),el.on("resize",function(){stickyCss.width=el.width(),stickyCss.height=el.height(),appState.set(target.data("sticky"),stickyCss)})),oncomplete=function(){stickyCss.top=this.css.top,stickyCss.left=this.css.left,appState.set(target.data("sticky"),stickyCss)}),element&&-1<element.indexOf("modal")?setTimeout(function(){target.width()<177||(el.css({position:"absolute",left:($(document.body).width()-el.width())/2}),Object.create(wwt.Move({el:el,target:target,oncomplete:oncomplete})))},1234):Object.create(wwt.Move({el:el,target:target,oncomplete:oncomplete}))}}}]),wwt.app.factory("AppState",function(){var data,api={set:function(key,val){try{null===val&&data[key]?delete data[key]:data[key]=val,localStorage&&localStorage.setItem("appState",JSON.stringify(data))}catch(er){console.log("Error using localstorage. Is it turned off?")}},get:function(k){return data[k]},getAll:function(){return data}};var initialState={layerManagerHidden:!0};try{var storedString=localStorage.getItem("appState"),storedObj=JSON.parse(storedString);if("[object Object]"!=Object.prototype.toString.call(storedObj))throw new Error("stored object not dict");data=storedObj}catch(e){data=initialState}return api}),wwt.app.factory("AutohidePanels",["$rootScope","AppState","Util",function($rootScope,appState,util){var tourPlaying=!1,editingTour=!1,mouseInRegion={tabs:!1,context:!1},panelHidden={tabs:!1,context:!1},panels={tabs:null,context:null},hideTimers={tabs:null,context:null},showingPanels={tabs:!1,context:!1},autoHide={tabs:!1,context:!1},autoHideHover={tabs:!1,context:!1},autoHideClick={tabs:!1,context:!1},hideTimeout=1200;function setBoth(o,ref){"object"==typeof ref?(o.tabs=ref.tabs,o.context=ref.context):(o.tabs=ref,o.context=ref)}var bindEvents=function(){$rootScope.$on("autohideChange",settingChange),$rootScope.$watch("editingTour",tourStateChange),$rootScope.$watch("tourPlaying",function(){$rootScope.tourPlaying&&(panels.tabs=$("#ribbon, #topPanel, .layer-manager")),tourStateChange()}),$(window).on("mousedown",function(){$.each(["tabs","context"],function(i,groupKey){tourPlaying&&!editingTour&&mouseInRegion[groupKey]&&panelHidden[groupKey]&&!showingPanels[groupKey]&&regionClicked(groupKey)})}),$(window).on("mousemove touchstart touchmove touchend",function(event){var event=(null!=event.pageY?event:event.originalEvent.targetTouches[0]).pageY,inBottom=$(window).height()-123<event,inBottom=(inBottom!==mouseInRegion.context&&(mouseInRegion.context=inBottom,cursorRegionChange()),event<142);inBottom!==mouseInRegion.tabs&&(mouseInRegion.tabs=inBottom,cursorRegionChange())})},settingChange=function(){var settings=appState.get("settings");settings&&void 0!==settings.autoHideTabs?(settings.autoHideTabs!==autoHide.tabs&&0==settings.autoHideTabs&&togglePanelGroup(!0,"tabs"),settings.autoHideContext!==autoHide.context&&0==settings.autoHideContext&&togglePanelGroup(!0,"context"),autoHide.tabs=settings.autoHideTabs,autoHide.context=settings.autoHideContext):setBoth(autoHide,!1),hideTimeout=tourPlaying?(panels.tabs=$("#ribbon, #topPanel, .layer-manager"),setBoth(autoHideHover,!0),setBoth(autoHideClick,!0),100):($("#ribbon").fadeIn(),setBoth(autoHideClick,!1),setBoth(autoHideHover,autoHide),panels.tabs=$("#topPanel, .layer-manager"),1200),cursorRegionChange()},tourStateChange=function(){togglePanelGroup(!$rootScope.tourPlaying,"tabs"),togglePanelGroup(!$rootScope.tourPlaying,"context"),editingTour=$rootScope.editingTour,tourPlaying=$rootScope.tourPlaying,settingChange(),cursorRegionChange()},togglePanelGroup=function(show,groupKey){var panelGroup=panels[groupKey];show?(clearTimeout(hideTimers[groupKey]),panelHidden[groupKey]&&!showingPanels[groupKey]&&(showingPanels[groupKey]=!(panelHidden[groupKey]=!1),panelGroup.fadeIn(800,function(){showingPanels[groupKey]=!1}),tourPlaying)&&mouseInRegion.tabs&&(console.log("showingSlides"),$rootScope.$broadcast("showingSlides"))):(clearTimeout(hideTimers[groupKey]),hideTimers[groupKey]=setTimeout(function(){panelHidden[groupKey]=!0,panelGroup.fadeOut(800)},hideTimeout))},regionClicked=function(key){console.log("regionClick",{autoHide:autoHide,autoHideClick:autoHideClick,tabs:panels.tabs}),togglePanelGroup(!0,key),"tabs"===key&&$rootScope.$broadcast("showingSlides")},cursorRegionChange=function(){tourPlaying&&!editingTour||$.each(["tabs","context"],function(i,groupKey){autoHideHover[groupKey]&&(mouseInRegion[groupKey]?togglePanelGroup(!0,groupKey):panelHidden[groupKey]||togglePanelGroup(!1,groupKey))})};return{init:function init(){if($rootScope.is_mobile)return;panels={tabs:$("#topPanel, .layer-manager"),context:$(".context-panel")};if(panels.tabs.length<2)return setTimeout(init,200),void console.log("init",panels.tabs);bindEvents();settingChange();var settings=appState.get("settings");settings&&(void 0!==settings.crosshairs&&wwt.wc.settings.set_showCrosshairs(settings.crosshairs),void 0!==settings.smoothPanning)&&wwt.wc.settings.set_smoothPan(settings.smoothPanning)}}}]),wwt.app.factory("FinderScope",["SearchData","$timeout","Util",function(searchDataService,$timeout,util){var searchData;function scopeMove(){var scope,constellation,closestDist,closestPlace,constellationPlaces,ssPlaces,pos;return!!searchData&&(pos=$(".finder-scope").position(),(pos=wwtlib.WWTControl.singleton.getCoordinatesForScreenPoint(pos.left+301,pos.top+87)).x=(pos.x+720)%360,scope=wwtlib.Coordinates.raDecTo3d(pos.x,pos.y),constellation=wwtlib.Constellations.containment.findConstellationForPoint(pos.x,pos.y),$.each(searchData.Constellations,function(i,item){item.name===constellation?constellationPlaces=item.places:"SolarSystem"===item.name&&(ssPlaces=item.places)}),pos=ssPlaces.concat(constellationPlaces),$.each(pos,function(i,place){try{var placeDist=wwtlib.Vector3d.subtractVectors(place.get_location3d(),scope);(0===i||closestDist.length()>placeDist.length())&&(closestPlace=place,closestDist=placeDist)}catch(er){place&&"Earth"!=place.get_name()&&util.log(er)}}),util.getAstroDetails(closestPlace),closestPlace)}return{init:function(){searchDataService.getData().then(function(d){searchData=d,scopeMove()})},scopeMove:scopeMove}}]),wwt.app.factory("HashManager",["$rootScope",function($rootScope){var api={setHashVal:function(key,v,privateOnly,reset){isNaN(v)&&(v=v.replace(/\s/g,"_"));var newHash="",hash=(privateOnly?privateHash:location.hash).substr(2);reset?newHash=key+"="+v:getHashVal(key,privateOnly)?1<(reset=hash.split("&")).length?$.each(reset,function(i,pair){var kvPair=pair.split("=");0<i&&(newHash+="&"),kvPair[0]==key?newHash+=kvPair[0]+"="+v:newHash+=pair}):hash.split("=")[0]==key&&(newHash+=key+"="+v):newHash=2<hash.length?hash+"&"+key+"="+v:key+"="+v;newHash=newHash.replace(/&&/g,"&"),privateOnly?privateHash="#/"+newHash:location.href="#/"+newHash;return location.href.split("#")[0]+"#/"+newHash},getHashVal:getHashVal,removeHashVal:function(key,privateOnly){var newHash="",hash=(privateOnly?privateHash:location.hash).substr(2);{var pairs;getHashVal(key,privateOnly)?1<(pairs=hash.split("&")).length?$.each(pairs,function(i,pair){var kvPair=pair.split("=");0<i&&(newHash+="&"),kvPair[0]!=key&&(newHash+=pair)}):hash.split("=")[0]==key&&(newHash+=""):newHash=hash}newHash=newHash.replace(/&&/g,"&"),privateOnly?privateHash="#/"+newHash:location.href="#/"+newHash;return location.href.split("#")[0]+"#/"+newHash},getHashObject:getHashObj},privateHash="#/";function getHashVal(key,privateOnly){return getHashObj(privateOnly)[key]}function getHashObj(privateOnly,hashString){var obj={},hashString=hashString||(privateOnly?privateHash:location.hash).substr(2);return 2<hashString.length&&-1!=hashString.indexOf("=")&&0<(privateOnly=hashString.split("&")).length&&$.each(privateOnly,function(i,pair){-1!=pair.indexOf("=")&&2<pair.length&&(pair=pair.split("="),obj[pair[0].replace(/_/g," ")]=pair[1].replace(/_/g," "))}),obj}return window.onhashchange=function(e){setTimeout(function(){$rootScope.$broadcast("hashChange",getHashObj())},10)},api}]),wwt.app.factory("Localization",["$http","$q","Util",function($http,$q,util){var langCode,englishData,englishArray,locArray,lpacks,api={setLanguage:function(code){var deferred=$q.defer();return initPromise.then(function(){var url;"EN"===(langCode=code)?(locArray=englishData.split("\n"),deferred.resolve(!0)):(url=wwtlib.URLHelpers.singleton.rewrite(lpacks.find("languagepack[code="+code+"]").attr("url"),wwtlib.URLRewriteMode.asIfAbsolute),util.log(url),$http.get(url).success(function(data){data=transformLanguagePack(data),locArray=[],$.each(data.split("\n"),function(i,item){var item=item.split("\t"),ind=parseInt(item[0],10);2!==item.length||isNaN(ind)||(locArray[ind]=item[1])}),deferred.resolve(!0)}))}),deferred.promise},getString:getString,getFromEn:function(s){return"EN"===langCode?s:getString($.inArray(s,englishArray),s)},getAvailableLanguages:function(){var deferred=$q.defer();return initPromise.then(function(){var langArray=[];lpacks.find("languagepack").each(function(i,pack){langArray.push({label:$(pack).attr("name"),code:$(pack).attr("code")})}),deferred.resolve(langArray)}),deferred.promise}};function getString(id,s){return locArray&&locArray[id]?locArray[id]:s||""}var deferred,transformLanguagePack=function(data){var re1,re2;return 1==data.charAt(0)?data:(re1=new RegExp(data.charAt(0),"g"),re2=new RegExp(data.charAt(3),"g"),data.replace(re1,"").replace(re2,""))},initPromise=(deferred=$q.defer(),$q.all([$http.get(wwtlib.URLHelpers.singleton.coreStaticUrl("/wwtweb/catalog.aspx?X=Languages")).success(function(data){lpacks=$(data)}).error(function(data,status,headers,config){util.log(data,status,headers,config)}),$http.get(wwtlib.URLHelpers.singleton.coreStaticUrl("/wwtweb/catalog.aspx?Q=lang_en")).success(function(data){data=transformLanguagePack(data);data=(englishData=data).split("\n");englishArray=[],$.each(data,function(){var s1=(s1=this.split("\t")[1])&&s1.split("\r")[0];englishArray[parseInt(this.split("\t")[0])]=s1})})]).then(function(){deferred.resolve(!0)}),deferred.promise);return api}]),wwt.app.factory("MediaFile",["$q",function($q){var mediaCache=[];return{addLocalMedia:function(mediaKey,file){var deferred=$q.defer(),keys=["collection","tour","image"],req=indexedDB.open("tempblob");return req.onupgradeneeded=function(){req.result.createObjectStore("files")},req.onsuccess=function(){var db=req.result,key=keys.indexOf(mediaKey),store=db.transaction("files","readwrite").objectStore("files"),db=function(){var mediaReq=store.get(key);mediaReq.onsuccess=function(e){var file=mediaReq.result,localUrl=URL.createObjectURL(file),file={url:(localUrl={url:localUrl,key:key,size:file.size,name:file.name}).url,key:localUrl.key,db:"tempblob",size:localUrl.size,filename:localUrl.name};deferred.resolve(file),mediaCache[key]=file}};store.put(file,key).onsuccess=db},deferred.promise},flushStore:function(db){var deferred=$q.defer(),db=db||"tempblob",db=indexedDB.deleteDatabase(db);return db.onupgradeneeded=function(){deferred.reject("upgradeneeded")},db.onsuccess=deferred.resolve,db.onerror=deferred.reject,db.onblocked=deferred.reject,deferred.promise},getBinaryData:function(url,asUIntArray,asArrayBuffer){var deferred=$q.defer(),req=(console.time("get binary string"),new XMLHttpRequest);req.open("GET",url,!0),req.onload=function(){if(asArrayBuffer)deferred.resolve(this.response);else if(asUIntArray){for(var uInt8Array=new Uint8Array(this.response),i=0,len=uInt8Array.length;i<len;++i)uInt8Array[i]=this.response[i];deferred.resolve(uInt8Array)}else deferred.resolve(req.responseText);console.timeEnd("get binary data")},asUIntArray?req.responseType="arraybuffer":req.overrideMimeType("text/plain; charset=x-user-defined");return req.send(null),deferred.promise}}}]),wwt.app.factory("SearchUtil",["SearchData","$q","Util","$rootScope",function(searchDataService,$q,util,$rootScope){var sortByImagery=function(p1,p2){return p1.fromCenter-p2.fromCenter};return{runSearch:function(q){var deferred=$q.defer();return searchDataService.getIndex().then(function(d){var searchData=wwt.searchDataIndexed,foundPlaces=[];q.length<2?foundPlaces=searchData[q]:(searchData=searchData[q.charAt(0).toLowerCase()],$.each(searchData,function(i,place){var names=place.get_names(),placeChosen=!1;$.each(names,function(j,name){var words;-1===q.indexOf(" ")&&1<name.split(" ").length?(words=name.split(" "),$.each(words,function(k,word){0!==word.toLowerCase().indexOf(q.toLowerCase())||placeChosen||(foundPlaces.push(place),placeChosen=!0)})):0!==name.toLowerCase().indexOf(q.toLowerCase())||placeChosen||(foundPlaces.push(place),placeChosen=!0)})})),deferred.resolve(foundPlaces.sort(sortByImagery))}),deferred.promise},findNearbyObjects:function(args){var deferred=$q.defer();return searchDataService.getData().then(function(d){var center,dist,constellation,constellationPlaces,ssPlaces,ulCoords,results,solsys,imgsets,searchData=wwt.searchData;!$rootScope.viewport||"Sky"!==args.lookAt&&"SolarSystem"!==args.lookAt?deferred.resolve([]):(ulCoords=args.singleton.getCoordinatesForScreenPoint(0,0),ulCoords=wwtlib.Coordinates.raDecTo3d(ulCoords.x,ulCoords.y),center=wwtlib.Coordinates.raDecTo3d($rootScope.viewport.RA,$rootScope.viewport.Dec),dist=wwtlib.Vector3d.subtractVectors(ulCoords,center).length(),constellation=args.singleton.constellation,$.each(searchData.Constellations,function(i,item){item.name===constellation?constellationPlaces=item.places:"SolarSystem"===item.name&&(ssPlaces=item.places)}),"SolarSystem"===args.lookAt&&deferred.resolve(ssPlaces),ulCoords=ssPlaces.concat(constellationPlaces),results=[],solsys=[],imgsets=[],$.each(ulCoords,function(i,place){if(place&&"Earth"!==place.get_name())try{var placeDist=wwtlib.Vector3d.subtractVectors(place.get_location3d(),center);dist>placeDist.length()&&(place.fromCenter=placeDist.length(),("SolarSystem"===place.get_constellation()?solsys:place.get_studyImageset()?imgsets:results).push(place))}catch(er){util.log(er,place)}}),solsys=solsys.sort(sortByImagery),deferred.resolve(solsys.concat(imgsets.sort(sortByImagery),results.sort(sortByImagery))))}),deferred.promise},getPlaceById:function(id){var deferred=$q.defer();return searchDataService.getData().then(function(d){var constellationIndex=parseInt(id.split(".")[0]),placeIndex=parseInt(id.split(".")[1]),d=d.Constellations[constellationIndex].places[placeIndex];deferred.resolve(d||null)}),deferred.promise}}}]),wwt.app.factory("Skyball",["$rootScope",function($rootScope){var canvas,ctx;function draw(){var radius,centerf,center,points,rc,z,h,sphereSize;arguments[1].isDirty&&(ctx.clearRect(0,0,100,100),sphereSize=$("#skyball").height(),radius=sphereSize/2,centerf=new Point(.71*sphereSize,.71*sphereSize),center=new Point(.71*sphereSize,.71*sphereSize),points=[],rc=Math.PI/180,z=0,h=(sphereSize=$("body")).height(),sphereSize=sphereSize.width(),[wwtlib.WWTControl.singleton.getCoordinatesForScreenPoint(0,0),wwtlib.WWTControl.singleton.getCoordinatesForScreenPoint(sphereSize,0),wwtlib.WWTControl.singleton.getCoordinatesForScreenPoint(sphereSize,h),wwtlib.WWTControl.singleton.getCoordinatesForScreenPoint(0,h)].forEach(function(coord){var coord=wwtlib.Coordinates.fromRaDec(coord.x,coord.y),point=new Point;points.push(point),point.x=centerf.x-Math.cos((coord.get_RA()+6)/12*180*rc)*Math.cos(coord.get_lat()*rc)*radius,point.y=centerf.y-Math.sin(coord.get_lat()*rc)*radius,z+=Math.sin((coord.get_RA()+6)/12*180*rc)*Math.cos(coord.get_lat()*rc)*radius,ctx.beginPath(),ctx.lineWidth="1",ctx.moveTo(center.x,center.y),ctx.lineTo(point.x,point.y),ctx.closePath(),ctx.stroke()}),ctx.beginPath(),ctx.lineWidth="1",ctx.strokeStyle="yellow",$.each(points,function(i,pt){0===i?ctx.moveTo(pt.x,pt.y):ctx.lineTo(pt.x,pt.y)}),ctx.closePath(),ctx.fillStyle=0<z/4?"rgba(255,255,0,.9)":"rgba(255,255,0,.5)",ctx.fill(),ctx.stroke())}function Point(x,y){this.x=x,this.y=y}return{init:function init(){var skyball=$("#skyball");if(!skyball.length)return void setTimeout(init,500);canvas=$("<canvas></canvas>").css({position:"absolute",top:$rootScope.is_mobile?-5:-9,left:$rootScope.is_mobile?-9:-14,height:137,width:307});skyball.append(canvas);ctx=canvas.get(0).getContext("2d");$rootScope.$on("viewportchange",draw);draw(null,{isDirty:!0})}}}]),wwt.app.factory("ThumbList",["$rootScope","Util","Places","$timeout","$templateRequest","$compile",function($rootScope,util,places,$timeout,$templateRequest,$compile){function calcPageSize(scope,isContextPanel){var list=scope.collection,winWid=$(window).width(),listLength=(!isContextPanel||"Sky"!==scope.lookAt&&"SolarSystem"!==scope.lookAt||(winWid-=216),scope.pageSize=$rootScope.is_mobile?99999:Math.floor(winWid/116),scope.expanded&&(scope.pageSize*=5),list?list.length:2);$timeout(function(){scope.pageCount=Math.ceil(listLength/scope.pageSize),spliceOnePage(scope)},10)}function goBack(scope){return $("body").append($("#researchMenu")),scope.currentPage=0===scope.currentPage?scope.currentPage:scope.currentPage-1,spliceOnePage(scope)}function goFwd(scope){return $("body").append($("#researchMenu")),scope.currentPage=scope.currentPage===scope.pageCount-1?scope.currentPage:scope.currentPage+1,spliceOnePage(scope)}function spliceOnePage(scope){var start;scope.collection&&(start=scope.currentPage*scope.pageSize,scope.collectionPage=scope.collection.slice(start,start+scope.pageSize))}return{init:function(scope,name){scope.pageCount=1,scope.pageSize=1,scope.currentPage=0,scope.preventClickBubble=function(event){event.stopImmediatePropagation()},scope.goBack=function(){goBack(scope)},scope.goFwd=function(){goFwd(scope)},scope.showMenu=function(i){if(!$("#researchMenu").length)return $templateRequest(wwt.staticAssetsPrefix+"views/research-menu.html").then(function(tplContent){tplContent=$compile(tplContent)(scope);$("body").append(tplContent),scope.showMenu(i)});var menuContainer,item=scope.collectionPage[i];item.contextMenuEvent=!0,$(".popover-content .close-btn").click(),item.get_isFolder()||"Up Level"===item.get_name()||(menuContainer=$(("context"===name?".nearby-objects ":".top-panel ")+"#menuContainer"+i),(menuContainer=$rootScope.is_mobile?$("#"+name+"Container #menuContainer"+i):menuContainer).append($("#researchMenu")),setTimeout(function(){$(".popover-content .close-btn").click(),menuContainer.find("#researchMenu").addClass("open").off("click").on("click",function(event){event.stopPropagation()}),menuContainer.find(".drop-toggle").click(),$timeout(function(){$rootScope.is_mobile||($(".dropdown-backdrop").off("contextmenu"),$(".dropdown-backdrop").on("contextmenu",function(event){$(this).click(),event.preventDefault()})),scope.setMenuContextItem(item,!0),item.contextMenuEvent=!1},10)},10))},scope.expandThumbnails=function(flag){$("body").append($("#researchMenu")),scope.currentPage=0,scope.expanded=null!=flag?flag:!scope.expanded,scope.expandTop(scope.expanded,name),calcPageSize(scope,"context"===name)},scope.dropdownClass="context"!==name||$rootScope.is_mobile?"dropdown menu-container":"dropup menu-container",scope.popupPosition="context"!==name||$rootScope.is_mobile?"bottom":"top"},clickThumb:function(item,scope,outParams,callback){if(setTimeout(function(){$rootScope.instant=!1},2222),!item)return console.warn(item);if(!item.contextMenuEvent)if(outParams=outParams||{},scope.activeItem=item.get_thumbnailUrl()+item.get_name(),scope.setActiveItem(item),"Up Level"===item.get_name())$("body").append($("#researchMenu")),scope.currentPage=0,outParams.depth--,outParams.breadCrumb.pop(),scope.breadCrumb=outParams.breadCrumb,outParams.cache.pop(),scope.collection=outParams.cache[outParams.cache.length-1],calcPageSize(scope,!1);else if(item.get_url&&item.get_url()&&-1!==item.get_url().indexOf("?wwtfull"))window.open(item.get_url());else if(item.get_isFolder())$("#folderLoadingModal").modal("show"),$("body").append($("#researchMenu")),scope.currentPage=0,outParams.depth++,outParams.breadCrumb.push(item.get_name()),scope.breadCrumb=outParams.breadCrumb,places.getChildren(item).then(function(result){$("#folderLoadingModal").modal("hide"),$.isArray(result[0])&&(result=result[0]);var unique=[];if($.each(result,function(index,el){-1===$.inArray(el,unique)&&unique.push(el)}),scope.collection=unique,calcPageSize(scope,!1),outParams.cache.push(result),outParams.openCollection)if(outParams.newCollectionUrl){for(var i=0;result[i]&&result[i].url&&-1===result[i].url.indexOf(outParams.newCollectionUrl);)i++;scope.clickThumb(result[i]||result[i-1]),outParams.newCollectionUrl=null}else result.length&&scope.clickThumb(result[0]);callback&&callback()});else if(outParams.openCollection?outParams.openCollection=!1:scope.$hide?(scope.$hide(),$rootScope.searchModal=!1):$rootScope.is_mobile&&$("#explorerModal").modal("hide"),setTimeout(function(){$rootScope.$applyAsync(function(){$rootScope.setLookAt(null)})},111),item.isFGImage&&item.imageSet&&"Sky"!==scope.lookAt||item.isSurvey||item.isCatalogHips)item.guid&&-1==item.guid.toLowerCase().indexOf("mars.")&&!item.isCatalogHips&&scope.setLookAt("Sky",item.get_name(),!0,item.isSurvey),item.isCatalogHips?scope.addCatalogHiPS(item):item.isSurvey?scope.setSurveyBg(item.get_name(),item):scope.setForegroundImage(item),scope.$hide&&(scope.$hide(),$rootScope.searchModal=!1);else{if(item.isPanorama)scope.setBackgroundImage(item);else if(item.isEarth)scope.setLookAt("Earth",item.get_name());else if(util.getIsPlanet(item)){if("Sky"===scope.lookAt&&wwtlib.ss.canCast(item,wwtlib.Place))return wwtlib.WWTControl.singleton.gotoTarget3(item.get_camParams()),outParams;"SolarSystem"!==scope.lookAt&&scope.setLookAt("Planet",item._name||"",!0,item.isSurvey),scope.setBackgroundImage(item)}(wwtlib.ss.canCast(item,wwtlib.Place)||wwtlib.ss.canCast(item,wwtlib.Imageset)||item.isEarth)&&!item.isSurvey&&scope.setForegroundImage(item),wwtlib.ss.canCast(item,wwtlib.Tour)&&scope.playTour(item.get_tourUrl())}return outParams},calcPageSize:calcPageSize,spliceOnePage:spliceOnePage,goFwd:goFwd,goBack:goBack}}]),wwt.app.factory("UILibrary",["$rootScope","AppState","Util","Localization","$modal","$sce",function($rootScope,appState,util,loc,$modal,$sce){$rootScope.layerManagerHidden=!!appState.get("layerManagerHidden"),$rootScope.toggleLayerManager=function(){$rootScope.layerManagerHidden=!$rootScope.layerManagerHidden,appState.set("layerManagerHidden",$rootScope.layerManagerHidden)},$rootScope.getCreditsText=function(place){return util.getCreditsText(place)},$rootScope.getCreditsUrl=function(place){return util.getCreditsUrl(place)},$rootScope.getClassificationText=function(clsid){return util.getClassificationText(clsid)||loc.getFromEn("Unknown")},$rootScope.secondsToTime=function(secs){return util.secondsToTime(secs)},$rootScope.resLocation=$("body").data("res-location"),$rootScope.bottomControlsWidth=function(){return angular.element("div.context-panel").width()-angular.element("body.desktop .fov-panel").width()+1},$rootScope.layerManagerHeight=function(){return $(window).height()-(168+$("body.desktop .context-panel").height())},$rootScope.hideFinderScope=function(){$(".finder-scope").hide()},$rootScope.copyLink=function(event,selector){var event=$(event.currentTarget),selector=selector?event.parent().find(selector):event.prev(),flyout=(selector[0].select(),document.execCommand("copy"),$("<div class=clipboard-status>Copied successfully</div>"));selector.parent().css("position","relative").append(flyout),setTimeout(function(){flyout.fadeOut(1111)},3333)},$rootScope.altUnits=[{type:1,label:"Meters"},{type:2,label:"Feet"},{type:3,label:"Inches"},{type:4,label:"Miles"},{type:5,label:"Kilometers"},{type:6,label:"Astronomical Units"},{type:7,label:"Light Years"},{type:8,label:"Parsecs"},{type:9,label:"MegaParsecs"},{type:10,label:"Custom"}],$rootScope.observingLocation={name:"My Location"};function initTypeList(typeKey,scopeKey){"string"!=typeof scopeKey&&(scopeKey=util.firstCharLower(typeKey)),$rootScope[scopeKey]=Object.keys(wwtlib[typeKey]).map(function(label,type){return{type:type,label:util.firstCharUpper(label)}})}function annotationOpts(s){var obj={};return s.split(",").forEach(function(kv){var k=(kv=kv.split(":"))[0].toLowerCase(),v=kv[1];"embed"!==k&&"youtube"!==k||(v=(v+=":"+kv[2]).match(/^(https?:\/\/)?((www\.)?(youtube(-nocookie)?|youtube.googleapis)\.com.*(v\/|v=|vi=|vi\/|e\/|embed\/|user\/.*\/u\/\d+\/)|youtu\.be\/)([_0-9a-z-]+)/i)[7],k="youtube"),obj[k]=v}),obj}function showColorpicker(colorpicker,e){var modalScope=$rootScope.$new();modalScope.colorpicker=colorpicker,modalScope.mouse=e,modalScope.customClass="colorpicker-modal",$modal({scope:modalScope,templateUrl:wwt.staticAssetsPrefix+"views/modals/centered-modal-template.html?v="+util.resVersion,contentTemplate:wwt.staticAssetsPrefix+"views/modals/colorpicker.html?v="+util.resVersion,show:!0,placement:"center",backdrop:!1,controller:"ColorPickerController"})}initTypeList("CoordinatesTypes","coordTypes"),["AltTypes","PointScaleTypes","MarkerScales","MarkerMixes","PlotTypes","ColorMaps"].forEach(initTypeList),$rootScope.loadVOTableModal=wwt.loadVOTableModal=function(voTableLayer,title){voTableLayer.get_table().pagedRows=voTableLayer.get_table().rows.slice(0,100);var modalScope=$rootScope.$new();modalScope.customClass="vo-tbl-modal",modalScope.voTableLayer=voTableLayer,modalScope.votable=modalScope.voTableLayer.get_table(),$modal({scope:modalScope,templateUrl:wwt.staticAssetsPrefix+"views/modals/centered-modal-template.html?v="+util.resVersion,contentTemplate:wwt.staticAssetsPrefix+"views/modals/vo-table-viewer.html?v="+util.resVersion,show:!0,placement:"center",backdrop:!1})};function showFrameWizardDialog(refFrame,propertyMode){var modalScope=$rootScope.$new();refFrame.name=refFrame.name||"",modalScope.refFrame=refFrame,modalScope.dialog=frameWizardDialog,modalScope.propertyMode=propertyMode,modalScope.customClass="wizard",$modal({scope:modalScope,templateUrl:wwt.staticAssetsPrefix+"views/modals/centered-modal-template.html?v="+util.resVersion,contentTemplate:wwt.staticAssetsPrefix+"views/modals/ref-frame-wiz.html?v="+util.resVersion,show:!0,placement:"center",backdrop:!1,controller:"refFrameController"})}function showModal(props){var modalScope=(props.scope||$rootScope).$new(),modalConfig={scope:modalScope,templateUrl:wwt.staticAssetsPrefix+"views/modals/centered-modal-template.html?v="+util.resVersion,contentTemplate:wwt.staticAssetsPrefix+"views/modals/"+props.template+".html?v="+util.resVersion,show:!0,backdrop:void 0!==props.backdrop&&props.backdrop,controller:props.controller},modal=(props.cssClass&&(modalScope.customClass=props.cssClass),props.fixedPosition?(modalScope.customClass+=" noreposition",modalConfig.animation=!1,modalConfig.backdropAnimation=!1,setTimeout(function(){$(".noreposition").removeClass("noreposition").find(".modal-dialog").css({left:300})},2222)):modalConfig.placement="centered",$modal(modalConfig));props.callback&&props.callback({modal:modal,scope:modalScope,modalConfig:modalConfig})}function showDataVizWiz(layerMap){var modalScope=$rootScope.$new(),propertyMode="string"!=typeof layerMap;(modalScope.propertyMode=propertyMode)?modalScope.layer=layerMap:modalScope.layerMap=layerMap,modalScope.customClass="wizard",modalScope.dialog=dataVizWiz,$modal({scope:modalScope,templateUrl:wwt.staticAssetsPrefix+"views/modals/centered-modal-template.html?v="+util.resVersion,contentTemplate:wwt.staticAssetsPrefix+"views/modals/data-viz-wiz.html?v="+util.resVersion,show:!0,placement:"center",backdrop:!1,controller:"DataVizController"})}function showRefFrameProps(refFrame){showFrameWizardDialog(refFrame,!0)}function showGreatCircleDlg(layer){var modalScope=$rootScope.$new();modalScope.layer=layer,modalScope.customClass="great-circle",$modal({scope:modalScope,templateUrl:wwt.staticAssetsPrefix+"views/modals/centered-modal-template.html?v="+util.resVersion,contentTemplate:wwt.staticAssetsPrefix+"views/modals/great-circle.html?v="+util.resVersion,show:!0,placement:"center",backdrop:!1,controller:"greatCircleController"})}function embedVideo(videoid){var modalScope=$rootScope.$new();modalScope.url=$sce.trustAsResourceUrl("//www.youtube.com/embed/"+videoid+"?autoplay=1"),modalScope.customClass="wizard embed-modal",$modal({scope:modalScope,animation:!1,backdropAnimation:!1,templateUrl:wwt.staticAssetsPrefix+"views/modals/centered-modal-template.html?v="+util.resVersion,contentTemplate:wwt.staticAssetsPrefix+"views/modals/embed-video.html?v="+util.resVersion,show:!0,backdrop:!1,controller:"EmbedController"})}$rootScope.loading=function(flag,content){loadingModal&&(loadingModal.hide(),loadingModal=null),flag&&(loadingModal=$modal({templateUrl:wwt.staticAssetsPrefix+"views/modals/loading-content.html?v="+util.resVersion,show:!0,content:content||"Content Loading. Please Wait...",placement:"center"}))},"disable"===util.getQSParam("debug")&&setTimeout(function(){wwtlib.WWTControl.singleton.render=function(){},$("#WorldWideTelescopeControlHost").html("")},888);var loadingModal,frameWizardDialog=wwtlib.LayerManager.get_frameWizardDialog(),dataVizWiz=wwtlib.LayerManager.get_dataVizWizardDialog(),refFrameDialog=wwtlib.LayerManager.get_referenceFramePropsDialog(),greatCircleDlg=wwtlib.LayerManager.get_greatCircleDlg();return wwt.root=$rootScope,{addDialogHooks:function(){wwt.wc.add_annotationClicked(function(interface,event){event=annotationOpts(event.get_id());event.youtube?embedVideo(event.youtube):event.link&&window.open(event.link)}),wwt.wc.add_voTableDisplay(wwt.loadVOTableModal),wwt.wc.add_colorPickerDisplay(showColorpicker),frameWizardDialog.add_showDialogHook(function(frame){showFrameWizardDialog(frame,!1)}),refFrameDialog.add_showDialogHook(showRefFrameProps),greatCircleDlg.add_showDialogHook(showGreatCircleDlg),dataVizWiz.add_showDialogHook(showDataVizWiz)},embedVideo:embedVideo,annotationOpts:annotationOpts,showModal:showModal,showErrorMessage:function(msg){var scope=$rootScope.$new();scope.message=msg,scope.title="Error",showModal({scope:scope,template:"message"})},setObservingLocation:function(props){$rootScope.$applyAsync(function(){props.localHorizonMode=void 0===props.localHorizonMode?$rootScope.ctl.settings._localHorizonMode:props.localHorizonMode,$rootScope.observingLocation=Object.assign($rootScope.observingLocation,props);var earthMap=wwtlib.LayerManager.get_allMaps().Earth,rf=(wwtlib.LayerManager.layerSelectionChanged(earthMap),new wwtlib.ReferenceFrame),rf=(rf.name="Observing Location",rf.lat=props.lat,rf.lng=props.lng,rf.altitude=props.altitude,wwtlib.LayerManager.referenceFrameWizardFinished(rf),$rootScope.hasSetupObservingLocation=!0,{_locationAltitude:props.altitude,_locationLat:props.lat,_locationLng:props.lng,_localHorizonMode:props.localHorizonMode});Object.assign(wwt.wc.settings,rf),wwtlib.LayerManager.layerSelectionChanged(earthMap)})}}}]),wwt.app.factory("Util",["$rootScope",function($rootScope){var api={getClassificationText:getClassificationText,getAstroDetails:function(place){var coords=wwtlib.Coordinates.fromRaDec(place.get_RA(),place.get_dec()),stc=wwtlib.SpaceTimeController,coords=wwtlib.Coordinates.equitorialToHorizon(coords,stc.get_location(),stc.get_now());if(place.altAz=coords,"Solar System"==getClassificationText(place.get_classification())){var coords=stc.get_jNow()+.5,p1=wwtlib.Planets.getPlanetLocation(place.get_name(),coords-1),p2=wwtlib.Planets.getPlanetLocation(place.get_name(),coords),p3=wwtlib.Planets.getPlanetLocation(place.get_name(),coords+1),type=0;switch(place.get_name()){case"Sun":type=1;break;case"Moon":type=2;break;default:type=0}p1=wwtlib.AstroCalc.getRiseTrinsitSet(coords,stc.get_location().get_lat(),-stc.get_location().get_lng(),p1.RA,p1.dec,p2.RA,p2.dec,p3.RA,p3.dec,type)}else p1=wwtlib.AstroCalc.getRiseTrinsitSet(stc.get_jNow()+.5,stc.get_location().get_lat(),-stc.get_location().get_lng(),place.get_RA(),place.get_dec(),place.get_RA(),place.get_dec(),place.get_RA(),place.get_dec(),0);p1.bValid||p1.bNeverRises||(p1.bNeverSets=!0);place.riseSet=p1},formatDecimalHours:function(dayFraction,spaced){var ts=new Date((new Date).toUTCString()).valueOf()-(new Date).valueOf(),day=dayFraction-ts/36e5+.0083333334;for(;24<day;)day-=24;for(;day<0;)day+=24;dayFraction=day.toFixed(0),ts=(60*day-60*dayFraction).toFixed(0),spaced=spaced?" : ":":";return[int2(dayFraction),int2(ts)].join(spaced)},formatHms:function(angle,isHmsFormat,signed,spaced,extraPrecision){var sign="";angle<0?(sign="-",angle=-angle):signed&&(sign="+");signed=[":",":",""];isHmsFormat?signed=["h","m","s"]:spaced&&(signed=[" : "," : ",""]);isHmsFormat=["??","??","??"];{var minutes,secondsStr;isNaN(angle)||(spaced=Math.floor(angle),angle=60*(angle-spaced),minutes=Math.floor(angle),angle=60*(angle-minutes),isNaN(extraPrecision)&&(extraPrecision=0),(secondsStr=angle.toFixed(extraPrecision)).startsWith("60")&&(secondsStr=(angle=0).toFixed(extraPrecision),60==(minutes+=1))&&(minutes=0,spaced+=1),isHmsFormat[0]=spaced.toFixed(0),spaced<10&&(isHmsFormat[0]="0"+isHmsFormat[0]),isHmsFormat[1]=minutes.toFixed(0),minutes<10&&(isHmsFormat[1]="0"+isHmsFormat[1]),isHmsFormat[2]=secondsStr,angle<10&&(isHmsFormat[2]="0"+isHmsFormat[2]))}return sign.concat(isHmsFormat[0],signed[0],isHmsFormat[1],signed[1],isHmsFormat[2],signed[2])},drawCircleOverPlace:function(place){{var circle;removeHoverCircle(),2===$("#lstLookAt option:selected").prop("index")&&((circle=wwt.wc.createCircle()).set_id("focused"),circle.setCenter(15*place.get_RA(),place.get_dec()),circle.set_skyRelative(!1),circle.set_radius(.22),circle.set_lineWidth(3),wwt.wc.addAnnotation(circle),circ=circle)}},removeHoverCircle:removeHoverCircle,getIsPlanet:function(place){var cls;"function"==typeof place.get_classification&&(cls=place.get_classification(),cls="Solar System"===getClassificationText(cls));return cls||"function"==typeof place.get_rotation},secondsToTime:function(secs){var hours=Math.floor(secs/3600),secs=secs%3600,minutes=Math.floor(secs/60),secs=secs%60,secs=Math.ceil(secs);return{h:hours<10?"0"+hours:hours.toString(),m:minutes<10?"0"+minutes:minutes.toString(),s:secs<10?"0"+secs:secs.toString()}},getQSParam:getQSParam,getImageset:getImageset,getCreditsText:function(pl){pl=getImageset(pl);return pl?pl.get_creditsText():""},getCreditsUrl:function(pl){pl=getImageset(pl);return pl?pl.get_creditsUrl():""},isAccelDevice:function(){return accelDevice},isDebug:null!=getQSParam("debug"),nav_user:function(url){window.open(wwt.userwebUrlPrefix+url)},nav_communities:function(url){window.open(wwt.communitiesUrlPrefix+url)},log:function(){null!=getQSParam("debug")&&console.log(arguments)},resetCamera:function(leaveHash){leaveHash||(location.hash="/");wwtlib.WWTControl.singleton.renderContext.viewCamera.rotation=0,wwtlib.WWTControl.singleton.renderContext.viewCamera.angle=0,wwtlib.WWTControl.singleton.renderContext.viewCamera.opacity=100,wwt.wc.gotoRaDecZoom(0,0,60,!0)},goFullscreen:function(){fullscreen||(wwt.requestFullScreen(document.body),fullscreen=!0)},exitFullscreen:function(){fullscreen&&(wwt.exitFullScreen(),fullscreen=!1)},toggleFullScreen:function(){fullscreen=fullscreen?(wwt.exitFullScreen(),!1):(wwt.requestFullScreen(document.body),!0)},getImageSetType:function(sType){imageSetTypes.length||$.each(wwtlib.ImageSetType,function(k,v){isNaN(v)||(imageSetTypes[v]=k.toLowerCase())});return-1==imageSetTypes.indexOf(sType.toLowerCase())?2:imageSetTypes.indexOf(sType.toLowerCase())},trackViewportChanges:function(){viewport={isDirty:!1,init:!0,RA:wwt.wc.getRA(),Dec:wwt.wc.getDec(),Fov:wwt.wc.get_fov(),Roll:wwt.wc.get_roll()},$rootScope.$broadcast("viewportchange",viewport),$rootScope.languagePromise.then(function(){viewport={isDirty:!1,init:!0,RA:wwt.wc.getRA(),Dec:wwt.wc.getDec(),Fov:wwt.wc.get_fov(),Roll:wwt.wc.get_roll()},$rootScope.$broadcast("viewportchange",viewport),viewport.init=!1,setInterval(dirtyViewport,250)})},parseHms:function(input){var parts;-1!=input.indexOf(":")?parts=input.split(":"):-1!=input.indexOf("h")?parts=input.replace(/h/,",").replace(/m/,",").replace(/s/,"").split(","):3===$.trim(input).split(" ").length&&(parts=input.split(" "));return parts?((hours,minutes,seconds)=>(minutes=Math.abs(parseInt(hours))+Math.abs(parseInt(minutes))/60+Math.abs(parseFloat(seconds))/3600,minutes="-"===hours.charAt(0)?0-minutes:minutes))(parts[0],parts[1],parts[2]):parseFloat(input)},resVersion:null!=getQSParam("debug")?$("body").data("resVersion"):Math.floor(99999*Math.random()),argb2Hex:function(argb){function convChannel(cbyte){return 2==(cbyte=cbyte.toString(16)).length?cbyte:"0"+cbyte}return"#"+convChannel(argb.r)+convChannel(argb.g)+convChannel(argb.b)},hex2argb:function(hex,argb){hex=hex.match(/[A-Za-z0-9]{2}/g).map(function(v){return parseInt(v,16)});return argb.r=hex[0],argb.g=hex[1],argb.b=hex[2],argb},firstCharLower:function(s){return s.charAt(0).toLowerCase()+s.substr(1)},firstCharUpper:function(s){return s.charAt(0).toUpperCase()+s.substr(1)},rewritePlaceUrls:function(item){item.get_thumbnailUrl&&(u=item.get_thumbnailUrl())&&(item.thumb=wwtlib.URLHelpers.singleton.rewrite(u,wwtlib.URLRewriteMode.asIfAbsolute));{var u;item.get_url&&(u=item.get_url())&&(item.url=wwtlib.URLHelpers.singleton.rewrite(u,wwtlib.URLRewriteMode.asIfAbsolute))}}},fullscreen=($rootScope.gitShortSha=wwt.gitShortSha,$rootScope.staticAssetsPrefix=wwt.staticAssetsPrefix,$rootScope.userwebUrlPrefix=wwt.userwebUrlPrefix,$rootScope.communitiesUrlPrefix=wwt.communitiesUrlPrefix,$rootScope.coreStaticUrlPrefix=wwt.coreStaticUrlPrefix,$rootScope.msLiveOAuthAppId=wwt.msLiveOAuthAppId,$rootScope.msLiveOAuthRedirUrl=wwt.msLiveOAuthRedirUrl,!1);function getClassificationText(clsid){var str;return clsid&&!isNaN(parseInt(clsid))?($.each(wwtlib.Classification,function(k,v){v===clsid&&(str=k)}),str.replace(/^\s*/,"").replace(/^[a-z]|[^\s][A-Z]/g,function(str,offset){return 0==offset?str.toUpperCase():str.substr(0,1)+" "+str.substr(1).toUpperCase()})):null}function int2(dec){var sign=dec<0?"-":"",dec=Math.floor(Math.abs(dec));return sign+(dec<10?"0":"")+dec}var circ=null;function removeHoverCircle(){circ&&wwt.wc.removeAnnotation(circ)}function getQSParam(name){name=name.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");name=new RegExp("[\\?&]"+name+"=([^&#]*)").exec(location.search);return null==name?null:decodeURIComponent(name[1].replace(/\+/g," "))}function getImageset(place){return place?wwtlib.ss.canCast(place,wwtlib.Imageset)?place:place.get_backgroundImageset&&wwtlib.ss.canCast(place.get_backgroundImageset(),wwtlib.Imageset)?place.get_backgroundImageset():place.get_studyImageset&&wwtlib.ss.canCast(place.get_studyImageset(),wwtlib.Imageset)?place.get_studyImageset():null:null}var accelDevice=!1;var imageSetTypes=[];$(document).on("keyup",function(e){27===e.keyCode&&($rootScope.$broadcast("escKey"),fullscreen=!1)});var viewport={isDirty:!1,RA:0,Dec:0,Fov:60};function has(src,search){return 0<=src.indexOf(search)}var dirtyViewport=function(){var wasDirty=viewport.isDirty;viewport.isDirty=wwt.wc.getRA()!==viewport.RA||wwt.wc.getDec()!==viewport.Dec||wwt.wc.get_fov()!==viewport.Fov||wwt.wc.get_roll()!==viewport.Roll,viewport.RA=wwt.wc.getRA(),viewport.Dec=wwt.wc.getDec(),viewport.Fov=wwt.wc.get_fov(),viewport.Roll=wwt.wc.get_roll(),(viewport.isDirty||wasDirty)&&($rootScope.viewport=viewport,$rootScope.$broadcast("viewportchange",viewport))},browsers={},ua=navigator.userAgent.toLowerCase();return browsers.isEdge=0<has(ua,"edge/"),browsers.isFF=0<has(ua,"firefox"),browsers.isIE=has(ua,"msie")||has(ua,"trident"),browsers.isChrome=has(ua,"chrome"),browsers.isSafari=has(ua,"safari")&&!browsers.isChrome&&!browsers.isIE&&!browsers.isEdge&&!browsers.isFF,browsers.isChrome=0<has(ua,"chrome")&&!browsers.isIE&&!browsers.isEdge&&!browsers.isFF,browsers.isWindows=has(ua,"windows"),$.extend(api,browsers)}]),wwt.app.factory("Astrometry",["$http","$q","$timeout","Util",function($http,$q,$timeout,util){var uploadUrl,statusCallback,statusTypes={connecting:"Connecting",connected:"Connect Success",connectFail:"Connection Failed",uploading:"Uploading Image",uploadSuccess:"Upload Success",uploadFail:"Upload Failed",statusCheck:"Checking Status",statusCheckFail:"Status Check Failed",jobFound:"Job Found",jobStatusCheck:"Checking Job Status",jobFail:"Could Not Resolve Image",jobStatus:"Solving Image",jobSuccess:"Job Succeeded",calibrationFail:"Calibration Results Failed"},sessionId=null,submissionId=null,jobId=null,calibration=null,jobStatus=null,errorData=null,debug=!1;function checkStatus(){showStatus(statusTypes.statusCheck),$.ajax({url:"//nova.astrometry.net/api/submissions/"+submissionId,type:"GET",dataType:"json",crossDomain:!0}).done(function(result){$.each(result.jobs,function(i,job){null!=job&&(jobId=job)}),jobId?(showStatus(statusTypes.jobFound),checkJobStatus()):setTimeout(checkStatus,2e3)}).fail(function(xhr,ajaxOptions,error){errorData=error,showStatus(statusTypes.statusCheckFail)})}function checkJobStatus(){$.ajax({url:"//nova.astrometry.net/api/jobs/"+jobId,type:"GET",dataType:"json",crossDomain:!0}).done(function(result){-1!=(jobStatus=result.status).indexOf("fail")?showStatus(statusTypes.jobFail):"success"!=result.status?(debug&&(calibration={ra:202.45355674088898,dec:47.20018130592933,rotation:122.97953942448784,scale:.3413275776344843,parity:1},showStatus(statusTypes.jobSuccess)),showStatus(statusTypes.jobStatus),window.setTimeout(checkJobStatus,5e3)):$.ajax({url:"//nova.astrometry.net/api/jobs/"+jobId+"/calibration",type:"GET",dataType:"json",crossDomain:!0}).done(function(result){(calibration={}).ra=result.ra,calibration.dec=result.dec,calibration.rotation=result.orientation,calibration.scale=result.pixscale,calibration.parity=result.parity,calibration.radius=result.radius,showStatus(statusTypes.jobSuccess)}).fail(function(xhr,ajaxOptions,error){errorData=error,showStatus(statusTypes.calibrationFail)})}).fail(function(xhr,ajaxOptions,error){errorData=error,showStatus(statusTypes.jobFail)})}function showStatus(status){var statusData={};statusData.sessionId=sessionId,statusData.submissionId=submissionId,statusData.jobId=jobId,statusData.calibration=calibration,statusData.jobStatus=jobStatus,statusData.errorData=errorData,$.each(statusTypes,function(type,message){message===status&&(statusData.status=type,statusData.message=message)}),statusCallback(statusData)}return{submitImage:function(imageUrl,callback,debugFlag){callback&&(statusCallback=callback),uploadUrl=imageUrl,jobId=submissionId=sessionId=null,debug=debugFlag,showStatus(statusTypes.connecting),callback={apikey:"grgfoujnylhbwtjw"},callback=encodeURIComponent(JSON.stringify(callback)),$.ajax({url:"//nova.astrometry.net/api/login",type:"POST",data:"request-json="+callback,dataType:"json",crossDomain:!0}).done(function(result){sessionId=result.session,errorData=null,showStatus(statusTypes.connected),showStatus(statusTypes.uploading),result={url:uploadUrl,session:sessionId},result=encodeURIComponent(JSON.stringify(result)),$.ajax({url:"//nova.astrometry.net/api/url_upload",type:"POST",data:"request-json="+result,dataType:"json",crossDomain:!0}).done(function(result){errorData=null,submissionId=result.subid,showStatus(statusTypes.uploadSuccess),checkStatus()}).fail(function(xhr,ajaxOptions,error){errorData=error,showStatus(statusTypes.uploadFail)})}).fail(function(xhr,ajaxOptions,error){errorData=error,showStatus(statusTypes.connectFail)})}}}]),wwt.app.factory("Community",["$http","$q","$timeout","Util",function($http,$q,$timeout,util){var root,api={getRoot:function(){var deferred=$q.defer();return initPromise.then(function(folders){$.each(folders,function(i,item){util.rewritePlaceUrls(item)}),deferred.resolve(folders)}),deferred.promise},getChildren:function(obj){var deferred=$q.defer();return obj.childLoadCallback(function(){var children=obj.get_children();$.each(children,function(i,item){item.guid=obj.guid+"."+(item.get_isFolder()?item.get_name():i),util.rewritePlaceUrls(item)}),deferred.resolve(transformData(children))}),deferred.promise}};deferred=$q.defer(),function tryInit(){wwt.wc?(root=wwt.wc.createFolder()).loadFromUrl(wwt.communitiesUrlPrefix+"/Resource/Service/Payload",function(){deferred.resolve(root.get_children())}):setTimeout(tryInit,333)}();var deferred,initPromise=deferred.promise;return api}]),wwt.app.factory("Places",["$http","$q","$timeout","Util",function($http,$q,$timeout,util){var root,openCollectionsFolder,api={getRoot:getRoot,getSolarSystemPlaces:function(){var deferred=$q.defer();return getRoot().then(function(rf){getChildren(rf[1]).then(function(d){deferred.resolve(d.slice(1))})}),deferred.promise},getChildren:getChildren,openCollection:function(url){var deferred=$q.defer();openCollectionsFolder||((openCollectionsFolder=wwt.wc.createFolder()).set_name("Open Collections"),openCollectionsFolder.guid="f0",root.addChildFolder(openCollectionsFolder));var collection=wwt.wc.createFolder();return collection.loadFromUrl(url,function(){collection.url=url,openCollectionsFolder.addChildFolder(collection),""==collection.get_name()?deferred.resolve(collection.get_children()):deferred.resolve(collection)}),deferred.promise},importImage:importImage,findChildById:function(guid,collection){var place=null;return guid=guid.replace(/_/g," "),$.each(collection,function(i,item){item.guid===guid&&(place=item)}),place}};function getRoot(){var deferred=$q.defer();return initPromise.then(function(folders){$.each(folders,function(i,item){item.guid=item.get_name(),util.rewritePlaceUrls(item)}),transformData(folders),deferred.resolve(root.get_children())}),deferred.promise}function getChildren(obj){var deferred=$q.defer();return obj.childLoadCallback(function(){var children=obj.get_children();$.each(children,function(i,item){item.guid=obj.guid+"."+(item.get_isFolder()?item.get_name():i),util.rewritePlaceUrls(item)}),deferred.resolve(transformData(children))}),deferred.promise}var transformData=function(items){return $.each(items,function(i,item){"function"==typeof item.get_type&&(item.isPlanet=1===item.get_type(),item.isFGImage=2===item.get_type()&&"function"==typeof item.get_camParams),"function"==typeof item.get_dataSetType&&(item.isEarth=0===item.get_dataSetType(),item.isPanorama=3===item.get_dataSetType(),item.isSurvey=2===item.get_dataSetType(),item.isPlanet=1===item.get_dataSetType()),"function"==typeof item.get_projection&&"function"==typeof item.get_extension&&(item.isCatalogHips=7===item.get_projection()&&".tsv"===item.get_extension()),util.rewritePlaceUrls(item)}),items};function importImage(url,manualData){var deferred=$q.defer(),collection=(openCollectionsFolder||((openCollectionsFolder=wwt.wc.createFolder()).set_name("Open Collections"),root.addChildFolder(openCollectionsFolder)),wwt.wc.createFolder()),encodedUrl=(collection.set_name("Imported image"),-1!=url.indexOf("%2F%2F")?url:encodeURIComponent(url)),url=(manualData&&(encodedUrl+=manualData),wwtlib.URLHelpers.singleton.coreDynamicUrl("/wwtweb/TileImage.aspx?imageurl="+encodedUrl));return collection.loadFromUrl(url,function(){0!=collection.get_children()[0].get_RA()||0!=collection.get_children()[0].get_dec()?(openCollectionsFolder.addChildFolder(collection),getChildren(collection).then(function(children){""==collection.get_name()?deferred.resolve(collection.get_children()):deferred.resolve(collection)})):deferred.resolve(!1)}),deferred.promise}deferred=$q.defer(),function tryInit(){var url;wwt.wc?(root=wwt.wc.createFolder(),url=new URL(wwt.coreStaticUrlPrefix+"wwtweb/catalog.aspx?W=explorerootweb",window.location).toString(),root.loadFromUrl(url,function(){var collection;null!=util.getQSParam("wtml")?((openCollectionsFolder=wwt.wc.createFolder()).set_name("Open Collections"),(collection=wwt.wc.createFolder()).loadFromUrl(util.getQSParam("wtml"),function(){collection.get_children(),openCollectionsFolder.addChildFolder(collection),root.addChildFolder(openCollectionsFolder),deferred.resolve(root.get_children())})):-1!==location.href.indexOf("?image=")?importImage(location.href.split("?image=")[1]).then(function(data){deferred.resolve(root.get_children())}):deferred.resolve(root.get_children())})):setTimeout(tryInit,333)}();var deferred,initPromise=deferred.promise;return api}]),wwt.app.factory("SearchData",["$q","Util",function($q,util){var data,api={getData:function(){var deferred=$q.defer();return initPromise.then(function(){deferred.resolve(data)}),deferred.promise},getIndex:function(){var deferred=$q.defer();return initPromise.then(function(){deferred.resolve(searchIndex)}),deferred.promise}},searchIndex={},deferredInit=$q.defer();function init(){var start,end;return wwt.searchData?(wwt.searchDataIndexed=[],data=wwt.searchData,start=new Date,$.each(data.Constellations,function(i,item){i,item.name,$.each(item.places,function(j,place){var file_type,bottoms_up,quad_tree_map,offset_x,offset_y,default_set,rotation,width_factor,band_pass,fgi=place.fgi,projection=(fgi&&(imageset_id++,band_pass=void 0!==fgi.bp?fgi.bp:wwtlib.BandPass.visible,projection=void 0!==fgi.pr?fgi.pr:wwtlib.ProjectionType.tan,base_tile_level=void 0!==fgi.bl?fgi.bl:0,file_type=void 0!==fgi.ft?fgi.ft:".png",tile_levels=void 0!==fgi.lv?fgi.lv:4,bottoms_up=void 0!==fgi.bu&&fgi.bu,quad_tree_map=void 0!==fgi.q?fgi.q:"",offset_x=void 0!==fgi.oX?fgi.oX:0,offset_y=void 0!==fgi.oY?fgi.oY:0,default_set=void 0!==fgi.ds&&fgi.ds,rotation=void 0!==fgi.r?fgi.r:0,width_factor=void 0!==fgi.wf?fgi.wf:2,band_pass=wwtlib.Imageset.create(fgi.n,fgi.u,wwtlib.ImageSetType.sky,band_pass,projection,imageset_id,base_tile_level,tile_levels,null,fgi.bd,file_type,bottoms_up,quad_tree_map,fgi.cX,fgi.cY,rotation,!0,fgi.tu,default_set,!1,width_factor,offset_x,offset_y,fgi.ct,fgi.cu,"","",0,null),util.rewritePlaceUrls(band_pass)),void 0!==place.c?place.c:wwtlib.Classification.unidentified),base_tile_level=void 0!==place.z?place.z:-1,tile_levels=wwtlib.Place.create(place.n,place.d,place.r,projection,item.name,wwtlib.ImageSetType.sky,base_tile_level);band_pass&&tile_levels.set_studyImageset(band_pass),"SolarSystem"===item.name&&$.each(tile_levels,function(k,member){wwtlib.ss.canCast(member,wwtlib.CameraParameters)&&(member.target=wwtlib.SolarSystemObjects.undefined)}),tile_levels.guid=i+"."+j,util.rewritePlaceUrls(tile_levels),(pl=>{function addPlace(s,place){var firstChar=s.charAt(0).toLowerCase();if("'"===firstChar&&(firstChar=s.charAt(1).toLowerCase()),searchIndex[firstChar])searchIndex[firstChar][searchIndex[firstChar].length-1]!==place&&(searchIndex[firstChar].push(place),wwt.searchDataIndexed=searchIndex);else try{wwt.searchDataIndexed[firstChar]=searchIndex[firstChar]=[place]}catch(er){console.error(er)}}$.each(pl.get_names(),function(n,name){var words;-1!==name.indexOf(" ")?(words=name.split(" "),$.each(words,function(w,word){addPlace(word,pl)})):name.charAt(0)&&addPlace(name,pl)})})(item.places[j]=tile_levels)})}),end=new Date,util.log("parsed places in "+(end.valueOf()-start.valueOf())+"ms",data),deferredInit.resolve(data)):setTimeout(init,333),deferredInit.promise}var imageset_id=100,initPromise=init();return api}]),wwt.app.factory("Tours",["$rootScope","$http","$q","$timeout","Util",function($rootScope,$http,$q,$timeout,util){var root,rootFolders,api={getRoot:function(){var deferred=$q.defer();return initPromise.then(function(){rootFolders=root.get_children(),deferred.resolve(transformData(rootFolders)),$.each(rootFolders,function(i,folder){folder=folder.get_children();$.each(folder,function(j,tour){tour.get_isTour()&&(tourHash[tour.id.toLowerCase()]=tour)})})}),deferred.promise},getChildren:function(obj){var deferred=$q.defer();return obj.childLoadCallback(function(){deferred.resolve(transformData(obj.get_children()))}),deferred.promise},getTourById:getTourById,getToursById:function(guids){var tours;return guids&&(tours=[],$.each(guids.split(";"),function(i,item){item=getTourById(item);item&&tours.push(item)}),1<guids.length)?tours:null}},tourHash={};function getTourById(id){return tourHash[id.toLowerCase()]}var deferred,toursUrl,transformData=function(items){return $.each(items,function(i,item){item.name=item.get_name(),item.isFolder=item.get_isFolder(),util.rewritePlaceUrls(item)}),items},initPromise=(deferred=$q.defer(),root=wwt.wc.createFolder(),toursUrl=wwt.staticAssetsPrefix+"assets/builtin-tours.wtml",root.loadFromUrl(toursUrl,function(){deferred.resolve(root.get_children())}),deferred.promise);return api}]),wwt.controllers.controller("ContextPanelController",["$scope","$rootScope","$timeout","Util","SearchUtil","ThumbList",function($scope,$rootScope,$timeout,util,searchUtil,thumbList){var lastUpdate=new Date,calcPageSize=($scope.clickThumb=function(item,instant){$rootScope.instant=!!instant,thumbList.clickThumb(item,$scope),util.removeHoverCircle()},$scope.hoverThumb=function(item){$scope.drawCircleOverPlace(item)},function(){thumbList.calcPageSize($scope,!0)});function findNearbyObjects(){"Sky"!==$scope.lookAt&&"SolarSystem"!==$scope.lookAt||wwt.tourPlaying||searchUtil.findNearbyObjects({lookAt:$scope.lookAt,singleton:$rootScope.singleton}).then(function(result){$scope.currentPage=0,$("body").append($("#researchMenu")),$scope.collection=result,$rootScope.is_mobile&&$scope.setNBO($scope.collection),calcPageSize($scope.collection)})}$(window).on("resize",function(){$scope.currentPage=0,calcPageSize()}),$scope.moveNboMenu=function(i){$("#nboMenuContainer"+i).append($("#researchMenu"))},$scope.showMenu=function(item,i){$(".popover-content .close-btn").click(),setTimeout(function(){$(".popover-content .close-btn").click(),$("#menuContainer"+i).find(".dropdown").addClass("open")},10),$scope.setMenuContextItem(item,!0)},$scope.preventClickBubble=function(event){event.stopImmediatePropagation()},$scope.goBack=function(){thumbList.goBack($scope)},$scope.goFwd=function(){thumbList.goFwd($scope)},$scope.isContextPanel=!0,thumbList.init($scope,"context"),$scope.placesInCone=[],$scope.scrollDepth=40,$rootScope.$on("viewportchange",function(event,viewport){(!viewport.isDirty&&!viewport.init||2e3<(new Date).valueOf()-lastUpdate.valueOf())&&(findNearbyObjects(),lastUpdate=new Date)}),$scope.$watch("lookAt",findNearbyObjects)}]),wwt.app.controller("IntroController",["$rootScope","$scope","$timeout","Localization",function($rootScope,$scope,$timeout,localization){$scope.completed=function(){cleanUp()},$scope.exit=function(){cleanUp()};function loc(s){return localization.getFromEn(s)}function start(){setTimeout(function(){$("#rbnExplore").click()},500),$("#WorldWideTelescopeControlHost").css("zIndex",-2),$(".layer-manager").css("zIndex",-1),$(".introjs-nextbutton").hide()}var cleanUp=function(){$("#WorldWideTelescopeControlHost").css("zIndex",0),$(".layer-manager").css("zIndex",1)};$scope.beforeChange=function(){var step=$scope.options.steps[this._currentStep],stepNum=this._currentStep+1;try{step.before()}catch(er){setTimeout(function(){step.before()},10)}setTimeout(function(){$(".introjs-nextbutton").addClass("disabled").prop("disabled",!0)},100),setTimeout(function(){$(".introjs-nextbutton").removeClass("disabled").prop("disabled",!1),$(".introjs-tooltipbuttons small").text("(Step "+stepNum+" of "+($scope.options.steps.length-1)+")")},step.enableMs||1e3)},$scope.afterChange=function(){$(".introjs-tooltipbuttons small").remove();var descEl=$("<small class=pull-left></small>").text("(Preparing step "+(this._currentStep+1)+" of "+($scope.options.steps.length-1)+")").css({position:"relative",top:5,opacity:.8});$(".introjs-tooltipbuttons").append(descEl)};$timeout(function(){$scope.options={steps:[{element:$("#rbnExplore").parent().parent()[0],intro:loc("Each button has two parts.  Clicking on the top part with the label will reveal the associated panel."),position:"bottom",before:start},{element:$("#rbnExplore").parent().parent()[0],intro:loc("Clicking the arrow at the bottom of the button reveals a drop-down menu."),position:"bottom",before:function(){$("#tabMenu0").addClass("hover").parent().addClass("hover").parent().addClass("hover").parent().addClass("hover")}},{element:$("#topPanel")[0],intro:loc("Within the Explore panel, you can browse imagery organized into various collections."),position:"bottom",before:function(){$("#tabMenu0").removeClass("hover").parent().removeClass("hover").parent().removeClass("hover").parent().removeClass("hover")}},{element:$("#topPanel")[0],intro:loc("Choose from different image collections, such as this one on Hubble Studies."),position:"bottom",before:function(){$($("#topPanel .thumbnail")[5]).addClass("hover"),setTimeout(function(){$($("#topPanel .thumbnail")[5]).click()},1)},enableMs:2e3},{element:$(".tn-expander")[0],intro:loc("The arrow at the bottom of panel of thumbnails expands or collapses the panel."),position:"bottom",before:function(){$(".tn-expander").click()}},{element:$("#topPanel")[0],intro:loc("Choose an item, such as the Sombrero Galaxy.  This moves the view to that location and overlays a foreground image from the Hubble Space Telescope on top of the all-sky background."),position:"bottom",before:function(){$($("#topPanel .thumbnail")[12]).addClass("hover"),setTimeout(function(){$($("#topPanel .thumbnail")[12]).click()},800)},enableMs:8e3},{element:$("#rbnTours").parent().parent()[0],intro:loc("Guided Tours have been created to present particular topics by using WWT to show specific views of the sky and astronomical objects.  You can browse guided tours by clicking the Guided Tours button."),position:"bottom",before:function(){$("#rbnTours").click()}},{element:$("#topPanel")[0],intro:"Guided tours are grouped by category",position:"bottom",before:function(){$($("#topPanel .thumbnail")[2]).addClass("hover")}},{element:$("#topPanel")[0],intro:loc("You can play a tour by clicking on the thumbnail.   Note, that most tours have music and narration so turn on your speakers! Please wait until this feature tour is complete before clicking a guided tour."),position:"bottom",before:function(){$($("#topPanel .thumbnail")[2]).removeClass("hover").click()}},{element:$("#rbnSearch").parent().parent()[0],intro:"The search panel enables you to search for objects in the sky by name or position.",position:"bottom",before:function(){$("#rbnSearch").click()}},{element:$("#topPanel")[0],intro:loc("Lets search for M51. This shows a list of thumbnails in the search panel.  You can click on any to orient your view on the object."),position:"bottom",before:function(){var e=jQuery.Event("keypress");e.which=50,$("input").trigger(e),setTimeout(function(){$("#txtSearch").val("M"),$("#txtSearch").trigger(e)},300),setTimeout(function(){$("#txtSearch").val("M5"),$("#txtSearch").trigger(e)},1500),setTimeout(function(){$("#txtSearch").val("M51"),$("#txtSearch").trigger(e)},2500),setTimeout(function(){$($("#topPanel .thumbnail")[2]).addClass("hover").click()},3500)},enableMs:8e3},{element:$(".cross-fader").parent()[0],intro:loc("If you have a foreground and background image showing, you can adjust the opacity of the foreground image with the Image Crossfade slider."),position:"top",before:function(){$(".finder-scope").fadeOut()}},{element:$("#topPanel")[0],intro:loc("Clicking on the View tab brings up a panel that allows you to setup your viewing location and the time."),position:"bottom",before:function(){$("#rbnView").click()}},{element:$("#topPanel")[0],intro:loc("The Settings panel allows you to customize various things, such as the language."),position:"bottom",before:function(){$("#rbnSettings").click()}},{element:null,intro:loc("You can use your mouse wheel (or touchpad scrolling function) to zoom in and out. You can also type + or -"),position:"bottom",before:function(){setTimeout(function(){wwt.wc.zoom(.6667)},300),setTimeout(function(){wwt.wc.zoom(.6667)},1300),setTimeout(function(){wwt.wc.zoom(1.5)},2300),setTimeout(function(){wwt.wc.zoom(1.5)},3300)},enableMs:3500},{element:null,intro:loc("You can move the View by left-clicking and dragging your mouse."),position:"bottom",before:function(){wwt.wc.gotoRaDecZoom(0,0,60,!0),setTimeout(function(){wwt.wc.gotoRaDecZoom(22,0,60)},1200),setTimeout(function(){wwt.wc.gotoRaDecZoom(0,0,60)},2200)},enableMs:4e3},{element:null,intro:loc("You can rotate the view by holding the Control Key while you move your mouse."),position:"bottom",before:function(){wwtlib.WWTControl.singleton.renderContext.targetCamera.angle=-.3,wwtlib.WWTControl.singleton.renderContext.targetCamera.rotation=-.3,wwtlib.WWTControl.singleton.render(),setTimeout(function(){wwtlib.WWTControl.singleton.renderContext.targetCamera.angle=.3,wwtlib.WWTControl.singleton.renderContext.targetCamera.rotation=.3,wwtlib.WWTControl.singleton.render()},1100),setTimeout(function(){wwtlib.WWTControl.singleton.renderContext.targetCamera.angle=0,wwtlib.WWTControl.singleton.renderContext.targetCamera.rotation=0,wwtlib.WWTControl.singleton.render()},2200)},enableMs:2500},{element:$(".finder-scope")[0],intro:loc("Right-clicking anywhere in the main view brings up a Finder Scope that allows you to investigate a specific object in more detail. The white circle shows the nearest object from the center of the crosshairs."),position:"right",before:function(){wwt.wc.gotoRaDecZoom(22,-11,60,!0),$rootScope.$broadcast("showFinderScope")}},{element:$("#lstLookAt")[0],intro:loc("Near the bottom is a menu that controls what you are looking at.  You can look at the Sky, which is what you are looking at now."),position:"top",before:function(){$(".finder-scope").fadeOut()}},{element:$("#lstLookAt")[0],intro:loc("You can also look at Earth, which brings up a 3D view of our planet as seen from space."),position:"top",before:function(){setTimeout(function(){$("#lstLookAt").val(0).trigger("change")},10),setTimeout(function(){wwt.wc.zoom(.3)},1200)},enableMs:1500},{element:$("#lstLookAt")[0],intro:loc("You can look at Planets which shows you 3D views of other solar system worlds, such as the planet Mars."),position:"top",before:function(){$("#lstLookAt").val(1).trigger("change"),setTimeout(function(){wwt.wc.zoom(.3)},1200)},enableMs:2e3},{element:$("#lstLookAt")[0],intro:loc("When looking at Panoramas you can explore various panoramic images, which are wrap-around images taken from the surface of Earth, Mars, and Earths Moon."),position:"top",before:function(){$("#lstLookAt").val(3).trigger("change")},enableMs:2e3},{element:$("#lstLookAt")[0],intro:loc("You can also look at the SolarSystem, which shows a 3D view of our Solar System, the 3D views of planets and orbits."),position:"top",before:function(){$("#lstLookAt").val(4).trigger("change"),wwt.wc.gotoRaDecZoom(22,90,45)},enableMs:2e3},{element:$("#topPanel")[0],intro:loc("When looking at SolarSystem, you can open the View tab and advance time forward many times faster than real-time to show the motion of the planets."),position:"bottom",before:function(){wwt.wc.gotoRaDecZoom(22,90,15),$("#rbnView").click();function speedUp(){decimalPlaces++,setTimeout(function(){$("#btnFastFwd").click(),decimalPlaces<7&&speedUp()},500)}var decimalPlaces=0;setTimeout(speedUp,1500)},enableMs:5e3},{element:$(".context-panel")[0],intro:loc("The context panel at the bottom shows a list of objects with associated images that are in the main view."),position:"top",before:function(){$("#btnTimeNow").click(),$("#lstLookAt").val(2).trigger("change"),wwt.wc.gotoRaDecZoom(0,0,60)},enableMs:2e3},{element:$(".context-panel")[0],intro:loc("When you move the view, the context panel updates the list of images in the view."),position:"top",before:function(){wwt.wc.gotoRaDecZoom(33,-11,30)}},{element:$(".context-panel")[0],intro:loc("You can click on any thumbnail to move the main view to that location."),position:"top",before:function(){$($(".context-panel .thumbnail")[4]).addClass("hover").click()}},{element:$(".layer-manager")[0],intro:loc("Additional information, such as grids and constellations, are available in the Layer Manager shown on the left."),position:"right",before:function(){}},{element:$("#btnToggleLayerMgr")[0],intro:loc("You can hide and show the layer manager by clicking the Layer Manager button."),position:"right",before:function(){$(".introjs-nextbutton").hide()}},{element:null,intro:loc("The tour is finished. You can play this tour anytime from the Welcome dialog. The Welcome dialog is available under the Explore menu. We hope you enjoy using WorldWide Telescope!")}],showStepNumbers:!1,exitOnOverlayClick:!1,exitOnEsc:!0,nextLabel:'<strong>Next <i class="fa fa-arrow-right"></i></strong>',prevLabel:'<span><i class="fa fa-arrow-left"></i> Back</span>',skipLabel:"Exit Tour",doneLabel:"Close"}},3333)}]),wwt.controllers.controller("LayerManagerController",["$scope","$rootScope","AppState","$timeout","Util","UILibrary",function($scope,$rootScope,appState,$timeout,util,UILibrary){function treeNode(args){this.name=args.name,this.checked=((name,action,defaultState)=>{var sticky=appState.get("layerMgr_"+name+action);return name&&action&&void 0!==sticky?sticky:void 0===defaultState||defaultState})(args.name,args.action,args.checked),this.children=args.children||[],this.action=args.action,this.collapsed=args.collapsed||!1,this.disabled=!1,args.mergeWith&&(this.mergeWith=args.mergeWith),args.v&&(this.v=args.v)}function formatDateTime(d){return wwtlib.ss.format("{0:yyyy/MM/dd}",d)+wwtlib.ss.format(" {0:HH:mm:ss}",d)}var loopCheckTimer,allMaps={},constellations=[],initTree=($scope.initLayerManager=function(){wwtlib.Constellations.abbreviations?($.each(wwtlib.Constellations.abbreviations,function(name,abbrev){constellations.push(new treeNode({name:name}))}),$scope.tree=initTree(),$scope.scrubber={left:" ",right:" ",table:[0,1,2,3,4,5]},$timeout(function(){wwt.wc.add_timeScrubberHook(function(prop,val){if(!$scope.activeLayer||void 0===$scope.activeLayer.timeSeriesChecked)switch(prop){case"left":case"right":case"title":$scope.$applyAsync(function(){$scope.scrubber[prop]=val});break;default:var el=$(".scrubber-slider");el.find(".btn").css("left",val*el.width())}}),initTreeNode(0,$scope.tree),$timeout(function(){function debouncer(flt){clearTimeout(debounceTimer),debounceTimer=setTimeout(function(){(flt=>{var stc=wwtlib.SpaceTimeController;wwt.wc.setTimeScrubberPosition(flt),(l=$scope.activeLayer)&&l.timeSeriesChecked&&(flt=Math.round(l.scrubber.duration*flt),flt=new Date(l.scrubber.start.valueOf()+flt),stc.set_now(flt),$rootScope.updateDateUI(),bar.attr("title",flt.toDateString()))})(flt)},333)}var l,debounceTimer,w=$(".scrubber-slider").width(),bar=$(".scrubber-slider a.btn"),stc=wwtlib.SpaceTimeController,sunTree=(new wwt.Move({el:bar,bounds:{x:[0,w],y:[0,0]},onstart:function(){(l=$scope.activeLayer)&&l.canUseScrubber&&l.timeSeriesChecked&&(l.timeRate=stc.get_timeRate(),stc.set_timeRate(1),$rootScope.updateDateUI(),l.moving=1)},oncomplete:function(){(l=$scope.activeLayer)&&l.canUseScrubber&&l.moving&&(stc.set_timeRate(l.timeRate),delete l.moving,delete l.timeRate,$rootScope.updateDateUI())},onmove:function(){debouncer(this.css.left/w)}}),$scope.allMaps=allMaps=wwtlib.LayerManager.get_allMaps(),{Sun:allMaps.Sun});sunTree.Sun.collapsed=!1,$scope.skyNode=allMaps.Sky,$.each(sunTree.Sun.childMaps,function(name,node){node.collapsed=!1,$.each(node.childMaps,function(childName,child){child.collapsed=!0})}),$scope.sunTree=sunTree,appState.get("observingLocation")&&UILibrary.setObservingLocation(appState.get("observingLocation"))},123)})):setTimeout($scope.initLayerManager,333)},$scope.getChildren=function(node){if(!node)return{};var addedChildren,children=node.children||{};if(children.length){if(node.mergeWith&&(allMaps=$scope.allMaps=wwtlib.LayerManager.get_allMaps())&&allMaps[node.mergeWith])return addedChildren=$scope.getChildren(allMaps[node.mergeWith]),$.each(children,function(i,childNode){addedChildren[childNode.name]=childNode}),addedChildren}else node.childMaps&&Object.keys(node.childMaps).length&&(children=node.childMaps),node.layers&&node.layers.length&&node.layers.forEach(function(l){children[l._name]=l});return children},function(){return new treeNode({v:12,name:$scope.getFromEn("Sky"),mergeWith:"Sky",action:"showSkyNode",checked:!0,children:[new treeNode({name:$scope.getFromEn("Overlays"),action:"showSkyOverlays",children:[new treeNode({name:$scope.getFromEn("Constellations"),action:"constellationsEnabled",children:[new treeNode({name:$scope.getFromEn("Constellation Pictures"),action:"showConstellationPictures",checked:!1}),new treeNode({name:$scope.getFromEn("Constellation Figures"),action:"showConstellationFigures"}),new treeNode({name:$scope.getFromEn("Constellation Boundaries"),collapsed:!0,children:[new treeNode({name:$scope.getFromEn("Focused Only"),action:"showConstellationSelection"})],action:"showConstellationBoundries"}),new treeNode({name:$scope.getFromEn("Constellation Names"),checked:!1,action:"showConstellationLabels"})]}),new treeNode({name:$scope.getFromEn("Grids"),action:"showSkyGrids",children:[new treeNode({name:$scope.getFromEn("Equatorial Grid"),checked:!1,collapsed:!0,action:"showGrid",children:[new treeNode({name:$scope.getFromEn("Axis Labels"),checked:!0,action:"showEquatorialGridText"})]}),new treeNode({name:$scope.getFromEn("Galactic Grid"),checked:!1,collapsed:!0,action:"showGalacticGrid",children:[new treeNode({name:$scope.getFromEn("Axis Labels"),checked:!0,action:"showGalacticGridText"})]}),new treeNode({name:$scope.getFromEn("AltAz Grid"),checked:!1,collapsed:!0,action:"showAltAzGrid",children:[new treeNode({name:$scope.getFromEn("Axis Labels"),checked:!0,action:"showAltAzGridText"})]}),new treeNode({name:$scope.getFromEn("Ecliptic Grid"),checked:!1,collapsed:!0,children:[new treeNode({name:$scope.getFromEn("Axis Labels"),checked:!0,action:"showEclipticGridText"})],action:"showEclipticGrid"}),new treeNode({name:$scope.getFromEn("Ecliptic Overview"),checked:!0,collapsed:!0,action:"showEcliptic",children:[new treeNode({name:$scope.getFromEn("Month Labels"),checked:!1,action:"showEclipticOverviewText"})]}),new treeNode({name:$scope.getFromEn("Precession Chart"),checked:!1,action:"showPrecessionChart"})]})]}),new treeNode({name:$scope.getFromEn("2D Sky"),checked:!0,action:"showSkyNode",children:[new treeNode({name:$scope.getFromEn("Show Solar System"),checked:!0,action:"showSolarSystem"})]}),new treeNode({name:$scope.getFromEn("3D Universe"),checked:!0,action:"showSolarSystem",children:[new treeNode({name:$scope.getFromEn("Cosmos (SDSS Galaxies)"),checked:!0,action:"solarSystemCosmos"}),new treeNode({name:$scope.getFromEn("Milky Way (Dr. R. Hurt)"),checked:!0,action:"solarSystemMilkyWay"}),new treeNode({name:$scope.getFromEn("Stars (Hipparcos, ESA)"),checked:!0,action:"solarSystemStars"}),new treeNode({name:$scope.getFromEn("Planets (NASA, ETAL)"),checked:!0,action:"solarSystemPlanets"}),new treeNode({name:$scope.getFromEn("Planetary Orbits"),checked:!0,action:"solarSystemOrbits"}),new treeNode({name:$scope.getFromEn("Moon & Satellite Orbits"),checked:!1,action:"solarSystemMinorOrbits"}),new treeNode({name:$scope.getFromEn("Asteroids (IAU MPC)"),checked:!1,action:"solarSystemMinorPlanets"}),new treeNode({name:$scope.getFromEn("Lighting and Shadows"),checked:!0,action:"solarSystemLighting"}),new treeNode({name:$scope.getFromEn("Multi-Res Solar System Bodies"),checked:!0,action:"solarSystemMultiRes"})]})]})}),invokeSetting=($scope.showMenu=function(layerMap,event){$scope.activeLayer&&($scope.activeLayer.active=!1),$scope.$applyAsync(function(){layerMap.active=!0,void 0!==layerMap.timeSeries&&void 0!==layerMap._autoUpdate$1&&(layerMap.loopChecked=layerMap._autoUpdate$1,layerMap.timeSeriesChecked=layerMap.timeSeries,layerMap.canUseScrubber=!0),$scope.activeLayer=layerMap}),wwtlib.LayerManager.layerSelectionChanged(layerMap),wwtlib.LayerManager.showLayerMenu(layerMap,event.pageX,event.pageY)},$scope.selectionChanged=function(layerMap,event){"LABEL"===event.currentTarget.tagName&&17<event.offsetX&&(event.preventDefault(),event.stopImmediatePropagation(),$scope.activeLayer&&($scope.activeLayer.active=!1),$scope.$applyAsync(function(){layerMap&&$scope.isObjectNode(layerMap)&&wwtlib.LayerManager.layerSelectionChanged(layerMap),layerMap.active=!0,void 0!==($scope.activeLayer=layerMap).timeSeries&&void 0!==layerMap._autoUpdate$1&&(layerMap.loopChecked=layerMap._autoUpdate$1,layerMap.timeSeriesChecked=layerMap.timeSeries,layerMap.canUseScrubber=!0)}))},$scope.hasChildren=function(node){return!!node&&((node=$scope.getChildren(node)).length||0<Object.keys(node).length)},$scope.isObjectNode=function(node){return!!node&&(null==node.action||node.layers||node.childMaps)},$scope.nodeChange=function(node){invokeSetting(node)},$scope.collapsed=function(node){return!node||($scope.isObjectNode(node)?!node.open:node.collapsed)},$scope.collapse=function(node){var key="collapsed",collapse=!$scope.collapsed(node);$scope.isObjectNode(node)&&(key="open",collapse=!collapse),node[key]=collapse},function(node){var name,action,settingFlag;!node.disabled&&node.action&&wwt.wc.settings["set_"+node.action]&&(settingFlag=node.checked&&!node.disabled,wwt.wc.settings["set_"+node.action](settingFlag),name=node.name,action=node.action,settingFlag=settingFlag,name)&&action&&appState.set("layerMgr_"+name+action,settingFlag),setChildState(node)}),setChildState=function(node){node.children&&$.each(node.children,function(i,child){var settingFlag;child.disabled=!node.checked||node.disabled,child.action&&wwt.wc.settings["set_"+child.action]&&(settingFlag=child.checked&&!child.disabled,wwt.wc.settings["set_"+child.action](settingFlag)),setChildState(child)})};function initTreeNode(i,node){$.each(node.children,initTreeNode),invokeSetting(node)}$scope.setTimeSeries=function(layer,enable){layer.set_timeSeries(enable),enable?(layer.scrubber={start:layer.get_beginRange(),end:layer.get_endRange(),duration:layer.get_endRange().valueOf()-layer.get_beginRange().valueOf()},$scope.scrubber.left=formatDateTime(layer.get_beginRange()),$scope.scrubber.right=formatDateTime(layer.get_endRange())):($scope.scrubber.left="",delete layer.scrubber,layer.loopChecked=!1)},$scope.setAutoLoop=function(layer,on){var stc;layer.loopChecked=on,layer.set_autoUpdate(on),on?($scope.setTimeSeries(layer,!0),layer.timeSeriesChecked=!0,stc=wwtlib.SpaceTimeController,loopCheckTimer=setInterval(function(){var progress,dur;if(!layer.moving)return(progress=stc._now-layer.scrubber.start)<(dur=layer.scrubber.duration)&&0<progress?(progress=progress/dur,dur=$(".scrubber-slider").width(),void $(".scrubber-slider a.btn").css({left:dur*progress})):(dur=stc.get_timeRate()<0,stc.set_now(dur?layer.scrubber.end:layer.scrubber.start))},222)):clearInterval(loopCheckTimer)},wwt.detectNewLayers=function(){$scope.$applyAsync(function(){allMaps=$scope.allMaps=wwtlib.LayerManager.get_allMaps()})}}]),wwt.controllers.controller("LoginController",["$scope","$rootScope","Util","$cookies",function($scope,$rootScope,util,$cookies){$rootScope.loggedIn=!1,$scope.login=$rootScope.login=function(){localStorage.setItem("login",(new Date).valueOf());var wlUrl="https://login.live.com/oauth20_authorize.srf?client_id="+$rootScope.msLiveOAuthAppId+"&scope=wl.offline_access%20wl.emails&response_type=code&redirect_uri="+encodeURIComponent($rootScope.msLiveOAuthRedirUrl)+"&display=popup";location.href=wlUrl},$scope.logout=function(){localStorage.setItem("login",(new Date).valueOf());var storedData=localStorage.getItem("userSettings"),storedData=storedData?JSON.parse(storedData):{};storedData.rememberMe=!1,localStorage.setItem("userSettings",JSON.stringify(storedData)),location.href=$rootScope.communitiesUrlPrefix+"/Logout"},null!=util.getQSParam("code")?($scope=location.href.split("?")[0],location.href=$rootScope.communitiesUrlPrefix+"/LiveId/AuthenticateFromCode/"+util.getQSParam("code")+"/?returnUrl="+encodeURIComponent($scope)):$cookies.get("access_token")&&($rootScope.loggedIn=!0,$rootScope.token=$cookies.get("access_token"))}]),wwt.controllers.controller("MainController",["$scope","$rootScope","UILibrary","$q","AppState","Localization","$timeout","FinderScope","SearchData","Places","Util","HashManager","Skyball","SearchUtil","$modal","$element","$cookies","AutohidePanels","$window","$popover",function($scope,$rootScope,uiLibrary,$q,appState,loc,$timeout,finderScope,searchDataService,places,util,hashManager,skyball,searchUtil,$modal,$element,$cookies,AutohidePanels,$window,$popover){var ctl,initialPass=!0,lookAtFoundImagery=!1;function update_window_size(){var w=$window.innerWidth,h=$window.innerHeight,body=($rootScope.is_mobile=(h<600||w<700)&&h<900&&w<600,$("body")),wwt_div=$("#WWTCanvas");$rootScope.is_mobile?(body.removeClass("desktop").addClass("mobile"),wwt_div.height($("#WorldWideTelescopeControlHost").height()).width($("#WorldWideTelescopeControlHost").width())):(body.removeClass("mobile").addClass("desktop"),wwt_div.height(h).width(w))}$scope.lookTypes=["Earth","Planet","Sky","Panorama","SolarSystem"],$scope.lookAt="Sky",$scope.imagery=[[],[],[],[],[]],$scope.lookAtDropdownChanged=function(lookAtType){lookAtType&&($scope.lookAt=lookAtType),setTimeout(function(){$scope.lookAtChanged(null,!0),$scope.setTrackingObj(!1)},1)},$scope.lookAtChanged=function(imageryName,dropdownInvoked,noUpdate,keepCamera){keepCamera||util.resetCamera(!0),$timeout(function(){$("#lstLookAt").length&&($scope.lookAt=$("#lstLookAt option:selected").text()),""===$scope.lookAt&&($scope.lookAt="Sky");var collection=$scope.imagery[$.inArray($scope.lookAt,$scope.lookTypes)],foundName=("-"!==collection[0]&&collection.splice(0,0,"-"),!(imageryName=""==imageryName?"-":imageryName)&&"Planet"==$scope.lookAt&&dropdownInvoked&&(imageryName="Mars"),$scope.surveys=collection,!1);(imageryName="Mars"===imageryName?"Visible Imagery":imageryName)&&$.each(collection,function(i,item){""===item||!item.get_name||0!==item.get_name().indexOf(imageryName)&&0!==imageryName.indexOf(item.get_name())||($scope.backgroundImagery=item,lookAtFoundImagery=foundName=!0)}),foundName?($scope.setSurveyBg(),$rootScope.lookAt=$scope.lookAt):initialPass||dropdownInvoked?(setTimeout(function(){initialPass=!1},500),lookAtFoundImagery=!1,$timeout(function(){lookAtFoundImagery||($scope.backgroundImagery=collection[1],$scope.setSurveyBg())},123)):noUpdate||($scope.backgroundImagery=collection[0],lookAtFoundImagery=!0)},100),$rootScope.hideFinderScope()},$scope.setLookAt=function(lookAt,imageryName,noUpdate,keepCamera){(lookAt&&isNaN(parseInt(lookAt))||(lookAt=wwtlib.WWTControl.singleton.renderContext.get_backgroundImageset()._dataSetType,lookAt=$scope.lookTypes[lookAt],$scope.lookAt!==lookAt))&&($scope.lookAt=lookAt,$scope.lookAtChanged(imageryName,!1,noUpdate,keepCamera),$rootScope.hideFinderScope())},$rootScope.setLookAt=$scope.setLookAt,$rootScope.is_mobile=!1,angular.element($window).bind("resize",function(){$rootScope.$apply(update_window_size)});var hashChange=function(e,obj){obj=obj||hashManager.getHashObject();function setLookAtHash(cb){$timeout(function(){$scope.setLookAt(obj.lookAt,obj.imagery&&obj.imagery.split("_").join(" ")),cb?cb():!obj.ra||"Earth"!==obj.lookAt&&"Planet"!==obj.lookAt||setTimeout(goto,2220)},2e3)}function loadPlace(openPlace){function goPlace(place,delay){obj.ra&&wwt.wc.add_arrived(function(){setTimeout(goto,0)}),$scope.setForegroundImage(place),$("#loadingModal").modal("hide"),-1!==delay&&obj.cf&&setTimeout(function(){if(obj.cf){$(".cross-fader a.btn").css("left",parseFloat(obj.cf));for(var ensureProperOpacity=function(){ctl.setForegroundOpacity(parseFloat(obj.cf))},i=1;i<6;i++)setTimeout(ensureProperOpacity,1e3*i)}},delay||3333)}$("#loadingModal").modal("show"),obj.lookAt&&"SolarSystem"==obj.lookAt?setLookAtHash(function(){searchUtil.getPlaceById(openPlace).then(function(p){console.log(p),setTimeout(function(){goPlace(p)},2222)})}):searchUtil.getPlaceById(openPlace).then(goPlace)}var openPlace,goto=function(){obj=obj||hashManager.getHashObject(),ctl.gotoRaDecZoom(15*parseFloat(obj.ra),parseFloat(obj.dec),parseFloat(obj.fov),!1),obj=null};obj.place?(openPlace=obj.place,isNaN(parseInt(openPlace.charAt(0)))||loadPlace(openPlace)):void 0!==obj.ra&&setTimeout(goto,500);try{(obj=obj||hashManager.getHashObject()).lookAt?setLookAtHash():obj.imagery&&$timeout(function(){$scope.setLookAt("Sky",obj.imagery)},2e3)}catch(ex){setTimeout(hashChange,2e3),console.log(ex)}},changePanel=($scope.initUI=function(){$scope.ribbon={home_tab:{label:"WorldWide Telescope",button:"rbnHome",menu:{"Main Website":[util.nav_user,"/home"],"User Forums":[function(){window.open("https://wwt-forum.org/")}],"Contributor Hub":[function(){window.open("https://worldwidetelescope.github.io/")}],"GitHub Home":[function(){window.open("https://github.com/WorldWideTelescope")}],"Sign up for Newsletter":[function(){window.open("https://bit.ly/wwt-signup")}],"Support WWT ":[function(){window.open("https://numfocus.org/donate-for-worldwide-telescope")}],sep1:null,"@WWTelescope on Twitter":[function(){window.open("https://twitter.com/WWTelescope")}],"@AASWorldWideTelescope on YouTube":[function(){window.open("https://www.youtube.com/c/AASWorldWideTelescope")}],"@WWTelescope on Facebook":[function(){window.open("https://www.facebook.com/wwtelescope")}],sep2:null,"Download Windows App":[util.nav_user,"/Download#windows-client"],"About WorldWide Telescope":[util.nav_user,"/About"]}},tabs:[{label:"Explore",button:"rbnExplore",mobileLabel:"Explore Collections",mobileAction:function(){$("#exploreModalLink").click()},menu:{Open:{"Tour...":[$scope.openItem,"tour"],"Collection...":[$scope.openItem,"collection"],"Image...":[$scope.openItem,"image"],"FITS Image...":[$scope.openItem,"FITS image"]},sep1:null,"Tour WWT Features":[$scope.tourFeatures],"Show Welcome Tips":[showTips],"Show Finder (right click)":[$scope.showFinderScope],"WorldWide Telescope Home":[util.nav_user,"/home"],"Getting Started (Help)":[util.nav_user,"/Learn/"],"WorldWide Telescope Terms of Use":[util.nav_user,"/Terms"],"About WorldWide Telescope":[util.nav_user,"/About"]}},{label:"Guided Tours",button:"rbnTours",menu:{"Tour Home Page":[util.nav_user,"/Learn/Exploring#guidedtours"],"Music and other Tour Resources":[util.nav_user,"/Download/TourAssets"],sep2:null,"Create a New Tour...":[$scope.createNewTour]}},{label:"Search",button:"rbnSearch",menu:{"Search Now":[function(){$timeout(function(){changePanel("Search")})}],"VO Cone Search":[function(){var modalScope=$rootScope.$new();modalScope.customClass="vo-cone-modal",$modal({scope:modalScope,templateUrl:wwt.staticAssetsPrefix+"views/modals/centered-modal-template.html",contentTemplate:wwt.staticAssetsPrefix+"views/modals/vo-cone-search.html",show:!0,placement:"center",backdrop:!1})}]}},{label:"Communities",button:"rbnCommunities",menu:{"Search Communities":[util.nav_communities,"/Community"]}},{label:"View",button:"rbnView",menu:{"Reset Camera":[util.resetCamera],"Share this View":[copyShortcut],"Toggle Full Screen View (F11)":[util.toggleFullScreen],"Toggle Layer Manager":[$scope.toggleLayerManager]}},{label:"Settings",button:"rbnSettings",menu:{"Restore Defaults":[$scope.restoreDefaultSettings],"Product Support":[util.nav_user,"/Support/IssuesAndBugs"]}}]},$scope.activePanel="Explore",$scope.UITools=wwtlib.UiTools,$scope.Planets=wwtlib.Planets,$rootScope.$on("viewportchange",viewportChange),util.trackViewportChanges(),skyball.init(),$(window).on("keydown",function(e){187===e.which?ctl.zoom(.66666666666667):189===e.which&&ctl.zoom(1.5)})},function(panel){$("body").append($("#researchMenu")),$scope.expandTop(!1),$scope.activePanel=panel}),viewportChange=function(event,viewport){var lng,found;(viewport.isDirty||viewport.init)&&($rootScope.viewport=viewport,$scope.coords=wwtlib.Coordinates.fromRaDec(viewport.RA,viewport.Dec),wwt.coords=$scope.coords,wwt.viewport=viewport,lng=$scope.coords.get_lng(),"Earth"===$scope.lookAt&&(lng=(180-$scope.coords.get_RA()/24*360-180+540)%360-180),$scope.formatted={RA:util.formatHms(viewport.RA,!0,!1,!1,1),Dec:util.formatHms(viewport.Dec,!1,!0),Lat:util.formatHms($scope.coords.get_lat(),!1,!1),Lng:util.formatHms(lng,!1,!1),Zoom:util.formatHms(viewport.Fov)},trackConstellation(),viewport.init)&&$timeout(trackConstellation,1200),(viewport.isDirty||viewport.finderMove)&&checkVisibleFinderScope()&&(found=finderScope.scopeMove())&&$timeout(function(){$scope.scopePlace=found,$scope.drawCircleOverPlace($scope.scopePlace),$scope.scopePlaceNameForQueryString=placeNameForQueryString(found)})},placeNameForQueryString=function(item){item=item.get_name().split(";"),item=1<item.length?item[1]:item[0];return(item=encodeURIComponent(item)).replace(/%20/g,"+")},trackConstellation=function(){$scope.formatted.Constellation=$scope.constellations.fullNames?$scope.getFromEn($scope.constellations.fullNames[$rootScope.singleton.constellation]):"..."},checkVisibleFinderScope=function(){return $(".finder-scope:visible").length?finderActive=!0:finderActive&&(finderActive=!1,clearInterval(finderTimer)),finderActive};$scope.$on("showFinderScope",function(){$scope.showFinderScope()}),$scope.$on("showContextMenu",function(){$scope.showContextMenu()});var finderTimer,finderActive=!1,finderMoved=!0,pollFinder=($scope.showFinderScope=function(event){var finder,wasHidden;event.originalEvent&&event.originalEvent.ctrlKey?(event.preventDefault(),event.stopPropagation()):"Sky"!==$scope.lookAt||$scope.editingTour||(wasHidden="none"==(finder=$(".finder-scope")).prop("display"),finder.toggle(!wasHidden).css({top:event?event.pageY-88:180,left:event?event.pageX-301:250}),wasHidden&&finder.fadeIn(function(){finder.prop("movebound")||new wwt.Move({el:finder,target:finder.find(".moveable"),onmove:function(){finderMoved=!0}}),finder.prop("movebound",!0)}),finderScope.init(),event&&event.preventDefault(),finderTimer=setInterval(pollFinder,400),viewportChange(null,{finderMove:!0}))},function(){checkVisibleFinderScope()&&finderMoved&&(viewportChange(null,{finderMove:!0}),finderMoved=!1)}),solarSystemInit=!($scope.initFinder=function(){searchDataService.getData().then(function(){var finder=$(".finder-scope").fadeOut();finder.find(".close, .close-btn").on("click",function(){finder.fadeOut()}),$scope.showObject=function(place){$rootScope.singleton.gotoTarget(place),$(".finder-scope").hide()}})}),hideTopMenu=($scope.setSurveyBg=function(imageryName,imageSet){if(imageryName){"Mars"===imageryName&&(imageryName="Visible Imagery");var foundName=!1;if($.each($scope.surveys,function(){!this.name||0!==this.name.indexOf(imageryName)&&0!==imageryName.indexOf(this.name)||($scope.backgroundImagery=this,foundName=!0)}),!foundName)return $scope.backgroundImagery="",ctl.setBackgroundImageByName(imageryName),void(imageSet&&$rootScope.singleton.renderContext.set_backgroundImageset(imageSet))}$scope.backgroundImagery&&("?"!==$scope.backgroundImagery&&ctl.setBackgroundImageByName($scope.backgroundImagery.get_name()),"string"==typeof $scope.backgroundImagery||"3D Solar System View"!==$scope.backgroundImagery.get_name()||solarSystemInit||setTimeout(function(){var bar=$(".planetary-scale .btn");new wwt.Move({el:bar,bounds:{x:[0,66],y:[0,0]},onstart:function(){bar.addClass("moving")},onmove:function(){ctl.settings.set_solarSystemScale(Math.max(1.5*this.css.left,1))},oncomplete:function(){bar.removeClass("moving")}});solarSystemInit=!0},10))},$scope.setActiveItem=function(item){($scope.activeItem=item).guid&&($scope.shareUrl=hashManager.setHashVal("place",item.guid,!0,!0)),item.get_studyImageset&&($scope.activeItem.imageSet=item.get_studyImageset())},$scope.addCatalogHiPS=function(item){item.guid&&($scope.shareUrl=hashManager.setHashVal("place",item.guid,!0,!0)),$rootScope.is_mobile&&($("#explorerModal").modal("hide"),$("#nboModal").modal("hide")),$scope.setActiveItem({});item=util.getImageset(item);wwtlib.WWTControl.singleton.addCatalogHips(item)},$scope.setForegroundImage=function(item){var imageSet;item.isCatalogHips?$scope.addCatalogHiPS(item):(item.guid&&($scope.shareUrl=hashManager.setHashVal("place",item.guid,!0,!0)),$rootScope.is_mobile&&($("#explorerModal").modal("hide"),$("#nboModal").modal("hide")),(imageSet=util.getImageset(item))&&!item.isEarth&&wwtlib.WWTControl.singleton.renderContext.set_foregroundImageset(imageSet),$scope.setTrackingObj(item),!item.isSurvey&&wwtlib.ss.canCast(item,wwtlib.Place)?($(".finder-scope").hide(),$rootScope.singleton.gotoTarget(item,!1,!!$rootScope.instant,!0)):item.isEarth?$rootScope.singleton.renderContext.set_backgroundImageset(imageSet):ctl.setForegroundImageByName(imageSet.get_name()))},$scope.setBackgroundImage=function(item){var imageSet,imageryName,typeIndex,foundIt;item.isCatalogHips?$scope.addCatalogHiPS(item):((imageSet=util.getImageset(item))&&($rootScope.singleton.renderContext.set_backgroundImageset(imageSet),typeIndex=imageSet.get_dataSetType(),imageryName=imageSet.get_name(),typeIndex=$scope.imagery[typeIndex],foundIt=!1,$.each(typeIndex,function(i,item){!item.get_name||0!==(item=item.get_name()).indexOf(imageryName)&&0!==imageryName.indexOf(item)||(foundIt=!0)}),foundIt||(imageSet.name=imageSet.get_name(),typeIndex.push(imageSet))),item.isSurvey||item.isPanorama||!wwtlib.ss.canCast(item,wwtlib.Place)||$rootScope.singleton.gotoTarget(item,!1,!!$rootScope.instant,!0))},$scope.menuClick=function(menu,caret_override){$scope.keepMenu=!0;var m=$("#topMenu");m.html(""),$.each(menu,function(menuItem,action){var sub,item;0===menuItem.indexOf("sep")?item=$('<li class="divider" role="presentation"></li>'):((item=$('<li><a href="javascript:void(0)"></a></li>')).find("a").text(loc.getFromEn(menuItem)),$.isPlainObject(action)?(item.addClass("dropdown-submenu").find("a").attr("tab-index",-1),sub=$("<ul class=dropdown-menu></ul>"),item.append(sub),$.each(action,function(subItemLabel,subItemAction){var subItem=$('<li><a href="javascript:void(0)"></a></li>');subItem.find("a").on("click",function(){subItemAction[0](subItemAction[1])}).data("action",subItemAction).text(loc.getFromEn(subItemLabel)),sub.append(subItem)})):item.find("a").on("click",function(){action[0](action[1])}).data("action",action)),m.append(item)}),menu=void 0!==caret_override?$(caret_override):$("#tabMenu"+this.$index),m.css({top:menu.offset().top+menu.height(),left:menu.offset().left}).show(),setTimeout(function(){$(document).on("click",hideTopMenu),$scope.keepMenu=!1},123)},function(){$scope.keepMenu||($("#topMenu").hide(),$(document).off("click",hideTopMenu))});function tourChangeHandler(){$rootScope.$broadcast("tourFinished");appState.get("settings");$scope.$applyAsync(function(){wwt.tourPlaying=$rootScope.tourPlaying=!1}),$rootScope.landscapeMessage=!1,ctl.clearAnnotations()}$scope.tabClick=function(tab){$rootScope.editingTour,$("body").append($("#researchMenu")),$scope.expandTop(!1),$scope.activePanel=tab.label,appState.set("activePanel",tab.label)},$scope.openItem=function(type){$scope.$applyAsync(function(){$rootScope.openType=type,$rootScope.$broadcast("openItem"),"collection"===type&&$scope.tabClick($scope.ribbon.tabs[0]),$("#openModal").modal("show")})},$scope.playTour=function(url,edit){$(".finder-scope").hide(),wwt.wc.add_tourError(function(e){util.exitFullscreen(),$scope.$applyAsync(function(){wwt.tourPlaying=$rootScope.tourPlaying=!1}),uiLibrary.showErrorMessage("There was an error loading this tour. The tour file may be damaged or inaccessible."),console.warn("Tour error",$scope,e)}),wwt.wc.add_tourReady(function(){console.log({ready:wwtlib.WWTControl.singleton.tourEdit}),$scope.$applyAsync(function(){$scope.isLoading=!1,$scope.activeItem={label:"currentTour"},$scope.activePanel="currentTour",$scope.ribbon.tabs[1].menu["Edit Tour"]=[$scope.editTour]}),edit&&$scope.editTour()}),wwtlib.WWTControl.singleton.playTour(url),$scope.$applyAsync(function(){wwt.tourPlaying=$rootScope.tourPlaying=!0,$rootScope.tourPaused=edit}),wwt.wc.add_tourEnded(tourChangeHandler)},$scope.editTour=function(){$rootScope.$applyAsync(function(){$rootScope.editingTour=!0})},$scope.initSlides=function(){$rootScope.$broadcast("showingSlides")},$rootScope.closeTour=function($event){util.exitFullscreen(),$event.preventDefault(),$event.stopPropagation(),wwtlib.WWTControl.singleton.tourEdit.get_tour().get_tourDirty()&&!confirm("You have unsaved changes. Close this tour and lose changes?")||($rootScope.editingTour=!1,delete $scope.ribbon.tabs[1].menu["Edit Tour"],delete $scope.ribbon.tabs[1].menu["Show Slide Overlays"],delete $scope.ribbon.tabs[1].menu["Show Slide Numbers"],wwtlib.WWTControl.singleton.stopCurrentTour(),$rootScope.$broadcast("closeTour"),$scope.$applyAsync(function(){$scope.activePanel="Guided Tours",$rootScope.editingTour=!1,$rootScope.tourPlaying=!1,$rootScope.currentTour=null}))};var shareModal=$modal({contentTemplate:wwt.staticAssetsPrefix+"views/popovers/shareplace.html",show:!($scope.createNewTour=function(){$scope.$applyAsync(function(){$rootScope.currentTour=wwtlib.WWTControl.singleton.createTour("New Tour"),$scope.activeItem={label:"currentTour"},$scope.activePanel="currentTour",$rootScope.$applyAsync(function(){$rootScope.editingTour=!0,$rootScope.currentTour._editMode=!0})})}),scope:$scope}),copyShortcut=function(){shareModal.$promise.then(shareModal.show)},showTips=($scope.restoreDefaultSettings=function(){$rootScope.$broadcast("restoreDefaults")},function(){$("#introModal").modal("show")}),localized=($scope.selectedLanguage="EN",$scope.setLanguageCode=function(code){appState.set("language",code),$timeout(function(){$scope.selectedLanguage!==code&&($scope.selectedLanguage=code,$scope.languageCode=code)},200),$rootScope.languagePromise=loc.setLanguage(code)},$scope.setLanguageCode(appState.get("language")||"EN"),$scope.locString=function(id){var deferred=$q.defer();return $rootScope.languagePromise.then(function(){localized[id]=loc.getString(id),deferred.resolve(localized[id])}),deferred.promise},[]);$scope.getFromEn=function(englishString){0;var deferred,key=englishString+$scope.selectedLanguage;return"EN"===$scope.selectedLanguage&&(localized[key]=englishString),localized[key]||(deferred=$q.defer(),$rootScope.languagePromise.then(function(){"EN"==$scope.selectedLanguage?localized[key]=englishString:localized[key]=loc.getFromEn(englishString),deferred.resolve(localized[key])}),deferred.promise)},loc.getAvailableLanguages().then(function(result){$scope.availableLanguages=result}),$rootScope.loc={na:"",neverRises:""},$rootScope.languagePromise.then(function(result){if($rootScope.na=loc.getFromEn("n/a"),$rootScope.neverRises=loc.getFromEn("Never Rises"),$scope.hideIntroModal=appState.get("hideIntroModalv2"),!$scope.hideIntroModal&&!$scope.loadingUrlPlace){if(localStorage.getItem("login"))if((new Date).valueOf()-parseInt(localStorage.getItem("login"))<33333)return;setTimeout(showTips,1200)}}),$scope.formatHms=function(angle,isHmsFormat,signed,spaced,extraPrecision){return util.formatHms(angle,isHmsFormat,signed,spaced,extraPrecision)},$scope.formatDecimalHours=function(dayFraction,spaced){dayFraction=wwtlib.UiTools.formatDecimalHours(dayFraction).split(":");return parseInt(dayFraction[0])<10&&(dayFraction[0]="0"+dayFraction[0]),parseInt(dayFraction[1])<10&&(dayFraction[1]="0"+dayFraction[1]),dayFraction.join(" : ")},$rootScope.showTrackingString=function(){return $scope.trackingObj&&1159<$(window).width()},$rootScope.showCrossfader=function(){var show=!1;try{"Sky"===$scope.lookAt&&$scope.trackingObj&&null!=util.getImageset($scope.trackingObj)&&(800<$(window).width()||$rootScope.is_mobile)&&(show=!0)}catch(er){show=!1}return show},$scope.hideIntroModalChange=function(hideIntroModal){appState.set("hideIntroModalv2",hideIntroModal)},$scope.iswebclientHome="home"!==$cookies.get("homepage"),$scope.homePrefChange=function(isWebclient){$cookies.remove("homepage"),isWebclient?$cookies.put("homepage","webclient",{expires:new Date(2050,1,1),path:"/"}):$cookies.put("homepage","home",{expires:new Date(2050,1,1),path:"/"})},$scope.setMenuContextItem=function(item,isExploreTab){$scope.menuContext=item,$scope.propertyItem=item,$scope.propertyItem.isExploreTab=isExploreTab,$scope.menuContextNameForQueryString=placeNameForQueryString(item)},$scope.showProperties=function(){$(".popover-content .close-btn").click();var tp=$(".dropdown.open #researchMenu, .dropup.open #researchMenu").closest(".thumbwrap").find(".thumb-popover"),pop=$popover(tp,{container:"body",contentTemplate:wwt.staticAssetsPrefix+"views/popovers/property-panel.html",placement:"auto bottom",scope:$scope});pop.$promise.then(function(){pop.show()})},$scope.setTrackingObj=function(item){$scope.trackingObj=item,null===$scope.trackingObj&&hashManager.removeHashVal("place",!0)},$scope.showMobileTracking=function(){return $scope.trackingObj&&$scope.trackingObj.get_name&&!$scope.tourPlaying&&"Earth"!==$scope.lookAt&&"Planet"!==$scope.lookAt&&"Panorama"!==$scope.lookAt},$scope.displayXFader=function(){return"Sky"===$scope.lookAt&&$scope.trackingObj&&!$scope.tourPlaying&&(null!=$scope.trackingObj.get_backgroundImageset()||null!=$scope.trackingObj.get_studyImageset())},$scope.gotoConstellation=function(c){$rootScope.singleton.gotoTarget(wwtlib.Constellations.constellationCentroids[c],!1,!1,!0)},$scope.drawCircleOverPlace=function(place){util.drawCircleOverPlace(place)},$scope.clearAnnotations=function(){ctl.clearAnnotations()},$scope.topExpanded=!1,$scope.expandTop=function(flag,panel){$scope.topExpanded=flag,$scope.expandedPanel=panel},$scope.tourFeatures=function(){$scope.loadingTour=!0,setTimeout(function(){$("#introStartButton").click()},3),setTimeout(function(){$("#btnCloseIntro").click(),$scope.loadingTour=!1},1e3)},update_window_size(),ctl=$rootScope.ctl=wwtlib.WWTControl.initControlParam("WWTCanvas",appState.get("WebGl")),(wwt.wc=ctl).add_ready(function(){var imageSets=wwtlib.WWTControl.imageSets;$scope.surveys=[],$.each(imageSets,function(){var typeIndex=this.get_dataSetType();this.name="Visible Imagery"===this.get_name()?"Mars":this.get_name(),2===typeIndex&&-1!==this.name.toLowerCase().indexOf("hipparcos")&&$scope.surveys.push(this);try{2===typeIndex&&-1!==this.name.toLowerCase().indexOf("hipparcos")||$scope.imagery[typeIndex].push(this)}catch(er){util.log(typeIndex,this)}}),$scope.backgroundImagery={name:"Digitized Sky Survey (Color)",get_name:function(){return"Digitized Sky Survey (Color)"}},$scope.lookAtChanged(),AutohidePanels.init()}),ctl.settings.set_showConstellationBoundries(!1),util.resetCamera(!0),ctl.endInit(),$rootScope.singleton=wwtlib.WWTControl.singleton,$rootScope.$on("hashChange",hashChange),$timeout(function(){var hash=hashManager.getHashObject();$rootScope.$broadcast("hashChange",hash),$scope.smallVP=wwt.smallVP},100),$scope.constellations=wwtlib.Constellations,$scope.nbo=[],$scope.setNBO=function(nbo){$scope.nbo=nbo,$scope.nboCount=nbo.length,$scope.isLoading&&($scope.isLoading=!1)},$scope.hideMenu=function(){$(".navbar-collapse.in").removeClass("in").addClass("collapse")},$scope.showNbo=function(){$("#nboModalLink").click(),$scope.hideMenu()},$scope.isLoading=!0,$scope.fovClass=function(){return"Planet"===$scope.lookAt||"Panorama"===$scope.lookAt||"Earth"===$scope.lookAt?"hide":"SolarSystem"===$scope.lookAt?"solar-system-mode fov-panel":"fov-panel"},$scope.contextPanelClass=function(){var cls="Planet"===$scope.lookAt||"Panorama"===$scope.lookAt||"Earth"===$scope.lookAt?"context-panel compressed":"context-panel";return $rootScope.tourPlaying&&(cls+=" hide"),$rootScope.compressed=$scope.compressed=0<cls.indexOf("compressed"),cls},$scope.contextPagerRight=function(){return $scope.showTrackingString()?0:50},util.getQSParam("editTour")?($scope.playTour(decodeURIComponent(util.getQSParam("editTour"))),$scope.autoEdit=!0):appState.get("editTourOnLogin")&&!util.getQSParam("code")&&($scope.playTour(appState.get("editTourOnLogin")),appState.set("editTourOnLogin",!1),$scope.autoEdit=!0),util.getQSParam("playTour")&&$scope.playTour(decodeURIComponent(util.getQSParam("editTour"))),$timeout(function(){var bar=$(".cross-fader a.btn").css("left",100);new wwt.Move({el:bar,bounds:{x:[-100,0],y:[0,0]},onstart:function(){bar.addClass("moving")},onmove:function(){ctl.setForegroundOpacity(this.css.left)},oncomplete:function(){bar.removeClass("moving")}});util.getQSParam("tourUrl")&&$scope.playTour(decodeURIComponent(util.getQSParam("tourUrl"))),util.getQSParam("tour")&&$scope.playTour(decodeURIComponent(util.getQSParam("tour"))),uiLibrary.addDialogHooks(),wwt.wc.add_refreshLayerManager(function(){$scope.$applyAsync(function(){})})},0)}]),wwt.controllers.controller("MobileNavController",["$rootScope","$scope","Util","$modal","Localization",function($rootScope,$scope,util,$modal,loc){var v="?v="+wwt.gitShortSha;$scope.showModal=function(modalButton){$scope.hideMenu(),"object"==typeof modalButton.modal?modalButton.modal.$promise.then(modalButton.modal.show):$(modalButton.modal).modal("show")},$rootScope.languagePromise.then(function(){$scope.modalButtons=[{text:loc.getFromEn("Explore"),icon:"fa-binoculars",modal:"#explorerModal"},{text:loc.getFromEn("Tours"),icon:"fa-play",modal:$modal({contentTemplate:wwt.staticAssetsPrefix+"views/modals/mobile-tours.html"+v,show:!1,scope:$scope})},{text:loc.getFromEn("Search"),icon:"fa-search",modal:$modal({contentTemplate:wwt.staticAssetsPrefix+"views/modals/mobile-search.html"+v,show:!1,scope:$scope,prefixEvent:"searchModal"})},{text:loc.getFromEn("View"),icon:"fa-eye",modal:$modal({contentTemplate:wwt.staticAssetsPrefix+"views/modals/mobile-view.html"+v,show:!1,scope:$scope})},{text:loc.getFromEn("Settings"),icon:"fa-gears",modal:$modal({contentTemplate:wwt.staticAssetsPrefix+"views/modals/mobile-settings.html"+v,show:!1,scope:$scope})},{text:loc.getFromEn("Layers"),icon:"fa-align-left",modal:$modal({contentTemplate:wwt.staticAssetsPrefix+"views/modals/mobile-layer-manager.html"+v,show:!1,scope:$scope})}]}),$scope.gotoPage=function(url){$scope.hideMenu(),open(url)},$scope.resetCamera=function(){$scope.trackingObj=null,$scope.hideMenu(),util.resetCamera()},$scope.tabClick=function(tab){$scope.hideMenu(),tab.action()},$scope.hideMenu=function(selector){"string"!=typeof selector&&(selector=".navbar-collapse"),$(selector+".in").removeClass("in").addClass("collapse")},$scope.$on("searchModal.show.before",function(){$rootScope.searchModal=!0}),$scope.$on("searchModal.hide",function(){$rootScope.searchModal=!1})}]),wwt.controllers.controller("ColorPickerController",["$scope",function($scope){function setMouse(e){$scope.mouse||($scope.mouse=e),$(window).off("mousemove",setMouse)}var opacity,cp=$scope.colorpicker;$(window).on("mousemove",setMouse),$scope.init=function(){var e=$scope.mouse||wwt.lastmouseContext,e=($("body.wwt-webclient-wrapper div.colorpicker-modal.wwt-modal div.modal-dialog").css({marginTop:e.pageY,marginLeft:e.pageX}),opacity=cp.color.a/255,Math.round(100*opacity)),bar=$(".cross-fader.color-picker a.btn").css("left",e);new wwt.Move({el:bar,bounds:{x:[0-e,100-e],y:[0,0]},onstart:function(){bar.addClass("moving")},onmove:function(args){opacity=this.css.left/100,$scope.setColor()},oncomplete:function(){bar.removeClass("moving")}});$scope.pickColor()},$scope.pickColor=function(event){var c;event?c=cp.getColorFromClick(event):(c=cp.color,opacity=cp.color.a/255),$scope.rgb=[c.r,c.g,c.b],$scope.setColor()},$scope.setColor=function(){$scope.$applyAsync(function(){$scope.previewColor="rgba("+$scope.rgb.join(",")+","+opacity+")"})},$scope.commitColor=function(){cp.color.a=Math.min(255,Math.max(0,Math.round(255*opacity)));var rgb=$scope.rgb;cp.color.r=rgb[0],cp.color.g=rgb[1],cp.color.b=rgb[2],cp.pickColor({}),$scope.$hide()},setTimeout($scope.init,800)}]),wwt.controllers.controller("DataVizController",["$scope","$rootScope","Util",function($scope,$rootScope,util){$scope.pages=["Welcome","Position","Scale","Markers","Color Map","Date Time","Hover Text"],$scope.propertyMode?($scope.pages.splice(0,1),$scope.page="Position",initColumns()):$scope.page="Welcome",$scope.buttonsEnabled={next:!1,back:!1,finish:!0},$scope.log=function(s){console.log(s||$scope.layer)},$scope.pasteExcel=function(e){e=e.originalEvent.clipboardData.getData("Text").replace(/(\r\n|\r|\n)/g,"\r\n");$("#pasteRow").remove(),$scope.layerName="clipboard",l=$scope.layer=wwtlib.LayerManager.createSpreadsheetLayer($scope.layerMap,$scope.layerName,e),initColumns(),$scope.buttonsEnabled.next=$scope.buttonsEnabled.finish=1};var l,oldName="clipboard";function initColumns(){l=$scope.layer,$scope.columns=$scope.layer._table$1.header.map(function(c,i){return{label:c,type:i}}),l.computeDateDomainRange(0,-1);$scope.columns.splice(0,0,{label:"None",index:-1}),l.psType=l.get_pointScaleType(),sliders={}}$scope.setName=function(n){setTimeout(function(){l.set_name(n);var maps=wwtlib.LayerManager.get_allMaps()[l.referenceFrame].childMaps;maps[n]=maps[oldName],delete maps[oldName],oldName=n,wwt.detectNewLayers()},123)};function initExpSlider(sel,prop,initVal){var value=$scope[prop];null==value&&(null==(value=l["get_"+prop]())&&(value=initVal),$scope[prop]=value),sliders[prop]||setTimeout(function(){var bar=$(sel),pxValue=4*Math.round(Math.log2(value))+50,pxValue=(bar[0].style.left=pxValue.toString()+"px",parseInt(bar.css("left").replace("px","")));sliders[prop]=new wwt.Move({el:bar,grid:4,bounds:{y:[0,0],x:[0-pxValue,100-pxValue]},onstart:function(){bar.addClass("moving")},onmove:function(){var f=(this.css.left-50)/4,f=($scope[prop],Math.min(Math.max(f,-12),12)),v=Math.pow(2,f);$scope.$applyAsync(function(){$scope[prop]=v,l["set_"+prop](v)})},oncomplete:function(){bar.removeClass("moving")}})},10)}function calcButtonState(){var i;$scope.propertyMode||(i=$scope.pages.indexOf($scope.page),$scope.buttonsEnabled.next="Welcome"===$scope.page?!!$scope.layer:i<$scope.pages.length-1,$scope.buttonsEnabled.back=0<i,$scope.buttonsEnabled.finish=!!$scope.layer),"Scale"===$scope.page&&initExpSlider(".scale-factor .btn","scaleFactor",1),"Date Time"===$scope.page&&initExpSlider(".time-decay .btn","decay",16)}var sliders={};$scope.setPage=function(p){$scope.page=p,calcButtonState()},calcButtonState(),$scope.next=function(){var i=$scope.pages.indexOf($scope.page);$scope.page=$scope.pages[i+1],calcButtonState()},$scope.back=function(){var i=$scope.pages.indexOf($scope.page);$scope.page=$scope.pages[i-1],calcButtonState()},$scope.finish=function(){$scope.layer.version++,$scope.dialog.OK($scope.layer)}}]),wwt.controllers.controller("EmbedController",["$scope","AppState","$rootScope",function($scope,appState,$rootScope){$rootScope.$on("escKey",$scope.$hide);function save(){setTimeout(function(){$(".embed-vid").length&&(embedSize=$scope.embedSize={height:modal.height(),width:modal.width(),top:modal.parent().css("top"),left:modal.parent().css("left")},appState.set("embedSize",embedSize),console.log("saved",embedSize))},333)}function repos(){modal.parent().css({top:embedSize.top,left:embedSize.left})}var modal,embedSize=appState.get("embedSize");$scope.embedSize=embedSize=embedSize||{height:500,width:800},console.log("stored embed",embedSize),$(".embed-modal").css("visibility","hidden");$.getScript("https://code.jquery.com/ui/1.11.3/jquery-ui.min.js",function(){$(".modal-content .embed").parent().addClass("embed-vid");var modalBody=(modal=$(".embed-vid")).find(".embed");modalBody.height(embedSize.height-24).width(embedSize.width),modal.parent().on("movecomplete",save),embedSize.top?(setTimeout(function(){console.log("positions",embedSize),$(".embed-modal").css("visibility","visible")},555),setTimeout(repos,333),setTimeout(repos,111),setTimeout(repos,777),setTimeout(repos,999),setTimeout(repos,1234)):$(".embed-modal").css("visibility","visible"),modal.height(embedSize.height).width(embedSize.width).resizable({minHeight:150,minWidth:250}).on("resize",function(){save(),modalBody.height(embedSize.height-24).width(embedSize.width)})})}]),wwt.controllers.controller("greatCircleController",["$scope","$rootScope","Util",function($scope,$rootScope,util){$scope.getFromView=function(key){var cam=$rootScope.singleton.renderContext.viewCamera;$scope.layer["_lat"+key+"$1"]=cam.lat,$scope.layer["_lng"+key+"$1"]=cam.lng},$scope.hexColor=util.argb2Hex($scope.layer.color),$scope.colorChange=function(){util.hex2argb($scope.hexColor,$scope.layer.color)},$scope.ok=function(layer){layer.opened=!0,console.log(layer),$scope.$hide()},console.log($scope.layer)}]),wwt.controllers.controller("ObservingLocationController",["$scope","AppState","$http","$rootScope","$timeout","UILibrary",function($scope,appState,$http,$rootScope,$timeout,UILibrary){$scope.pages=["Select city","Choose on globe"];var ol=$rootScope.observingLocation,pageIndex=ol&&ol.type?$scope.pages.indexOf(ol.type):0,viewportChange=($scope.setPage=function(p){($scope.page=p)===$scope.pages[1]&&("Earth"!==$scope.lookAt&&($scope.setLookAt("Earth","Bing Maps Aerial"),wwt.wc.settings._showCrosshairs=!0,void 0!==ol.ra)&&void 0!==ol.dec&&setTimeout(function(){wwt.wc.gotoRaDecZoom(15*parseFloat(ol.ra),parseFloat(ol.dec),parseFloat(ol.fov),!0)}),$timeout(viewportChange,500))},$scope.setPage($scope.pages[pageIndex]),function(){var lng;$scope.page===$scope.pages[1]&&(lng=(180-$scope.coords.get_RA()/24*360-180+540)%360-180,lng=$rootScope.singleton.renderContext.getEarthAltitude($scope.coords.get_lat(),lng,!0),$scope.altitude=lng.toFixed(1))}),loadRegions=($rootScope.$on("viewportchange",viewportChange),$scope.datasets=[{name:"World Cities",regions:wwt.staticAssetsPrefix+"assets/worldregions.json",regiondata:[],index:0},{name:"US Cities",regions:wwt.staticAssetsPrefix+"assets/usaregions.json",regiondata:[],index:1},{name:"Canadian Cities",regions:wwt.staticAssetsPrefix+"assets/canadaregions.json",regiondata:[],index:2}],$scope.selectedDatasetIndex=0,$scope.selectedRegionIndex=0,$scope.selectedRegion={},$scope.selectedCity=null,$scope.cities=[],$scope.cityIndex=0,$scope.selectedDataset=$scope.datasets[0],$scope.locationName=ol&&ol.name?ol.name:"My location",$scope.datasetChange=function(index){$scope.selectedDataset=$scope.datasets[void 0!==index?index:$scope.selectedDatasetIndex],loadRegions()},$scope.regionChange=function(index){$scope.selectedRegionIndex=void 0!==index?index:$scope.selectedRegionIndex,$scope.selectedDataset.regiondata.length&&($scope.selectedRegion=$scope.selectedDataset.regiondata[$scope.selectedRegionIndex],$scope.cityIndex=0,$scope.cities=$scope.selectedRegion.cities.map(function(c,i){return c.name?c:{name:c[0],lat:c[1],lng:c[2],el:c[3],index:i}}),$scope.selectedCity={},$scope.cityIndex=0)},$scope.selectCity=function(index){index=$scope.cities[index];index.altMeters=Math.round(1e4*index.el)/10,$scope.selectedCity=index},$scope.loadRegions=function(dataset,init){dataset=dataset||$scope.selectedDataset,$scope.selectedRegionIndex=0,$scope.selectedRegion={},$scope.selectedCity={},$scope.cityIndex=0,$scope.cities=[];function dataLoaded(regionData){var off;regionData.length&&(off=init?1:0,dataset.regiondata=regionData.map(function(r,i){return r.index=i+off,r}),init&&((regionData={name:"All Regions",index:0,cities:[].concat.apply(this,dataset.regiondata.map(function(r){return r.cities.map(function(c){c=JSON.parse(JSON.stringify(c));return c[0]+=" ("+r.name+")",c})}))}).cities.splice(0,1),dataset.regiondata.splice(0,0,regionData)),$scope.selectedRegionIndex=0,$scope.regionChange())}if(dataset.regiondata.length)return dataLoaded(dataset.regiondata);$http.get(dataset.regions).success(function(data){dataLoaded(data)})}),hadCrosshairsOff=0==wwt.wc.settings._showCrosshairs;$scope.setLocation=function(city){hadCrosshairsOff&&(wwt.wc.settings.set_showCrosshairs=!1),city=(city?(lat=city.lat,lng=city.lng,$scope.coords=wwtlib.Coordinates.fromLatLng(lat,lng),$scope.coords.set_lng($scope.coords.get_RA()),altitude=city.altMeters,city):(lng=(180-$scope.coords.get_RA()/24*360-180+540)%360-180,lat=$scope.coords.get_lat(),altitude=$rootScope.singleton.renderContext.getEarthAltitude($scope.coords.get_lat(),lng,!0)+500,$rootScope.observingLocation)).name;var lng,altitude,lat={lat:lat,lng:lng,altitude:altitude,name:city,type:$scope.page,ra:$scope.coords.get_RA(),dec:$scope.coords.get_dec(),fov:wwt.wc.get_fov()};UILibrary.setObservingLocation(lat),appState.set("observingLocation",lat),hadCrosshairsOff&&(wwt.wc.settings._showCrosshairs=!1),$scope.$hide()},loadRegions(null,!0)}]),wwt.controllers.controller("ObservingTimeController",["$scope","AppState",function($scope,appState){var now=$scope.now;$scope.dt={},$scope.dt.year=now.getFullYear(),$scope.dt.month=(now.getMonth()+1)%12,$scope.dt.date=now.getDate(),$scope.dt.hours=now.getHours(),$scope.dt.minutes=now.getMinutes(),$scope.dt.seconds=now.getSeconds(),$scope.setNow=function(){var date=new Date(parseInt($scope.dt.year),parseInt($scope.dt.month)-1,parseInt($scope.dt.date),parseInt($scope.dt.hours),parseInt($scope.dt.minutes),parseInt($scope.dt.seconds));wwtlib.SpaceTimeController.set_now(date)}}]),wwt.controllers.controller("OpenItemController",["$rootScope","$scope","AppState","Places","Util","Astrometry","MediaFile",function($rootScope,$scope,appState,places,util,astrometry,media){$rootScope.$on("openItem",function(){$scope.openItemUrl="",setTimeout(function(){$("#txtOpenItem").focus()},100)}),$scope.tour={edit:!1},$scope.openItem=function(){var itemType=$rootScope.openType;"collection"===itemType?places.openCollection($scope.openItemUrl).then(function(folder){util.log("initExplorer broadcast",folder),$rootScope.newFolder=folder,$rootScope.$broadcast("initExplorer",$scope.openItemUrl),$("#openModal").modal("hide")}):"tour"===itemType?($scope.playTour($scope.openItemUrl,!!$scope.tour.edit),$("#openModal").modal("hide")):"FITS image"===itemType?(wwt.wc.loadFits($scope.openItemUrl),setTimeout(wwt.detectNewLayers,555),$("#openModal").modal("hide")):places.importImage($scope.openItemUrl).then(function(folder){folder?(util.log("initExplorer broadcast",folder),$rootScope.newFolder=folder,$rootScope.$broadcast("initExplorer",$scope.openItemUrl),$("#openModal").modal("hide")):($scope.importState="notAVMTagged",$scope.imageFail=!0)})},$scope.mediaFileChange=function(e){var type=$rootScope.openType,e=e.target.files[0];e.name&&($scope[type+"FileName"]=e.name,media.addLocalMedia(type,e).then(function(mediaResult){$scope.openItemUrl=mediaResult.url,$scope.openItem(),$("#addFileReset")[0].reset()}))},$scope.astrometryStatusText="",$scope.astroCallback=function(data){var qs;$scope.$applyAsync(function(){0==$scope.astrometryStatusText.indexOf(data.message)?$scope.astrometryStatusText+=" .":$scope.astrometryStatusText=data.message}),data.calibration&&($scope.importState="astrometrySuccess",qs="&ra="+data.calibration.ra+"&dec="+data.calibration.dec+"&scale="+data.calibration.scale/3600+"&rotation="+data.calibration.rotation,1!==data.calibration.parity&&(qs+="&reverseparity=true"),places.importImage($scope.openItemUrl,qs).then(function(folder){$rootScope.newFolder=folder,$rootScope.$broadcast("initExplorer",$scope.openItemUrl),$scope.imageFail=!1,$scope.importState="",$("#openModal").modal("hide")})),-1!=data.status.toLowerCase().indexOf("fail")&&($scope.importState="astrometryFail")},$scope.solveAstrometry=function(){$scope.importState="astrometryProgress",astrometry.submitImage($scope.openItemUrl,$scope.astroCallback,!1)}}]),wwt.controllers.controller("ShareController",["$scope","$rootScope","Util","$timeout","HashManager",function($scope,$rootScope,util,$timeout,hashManager){$scope.includeViewport=!0,$scope.init=function(){$scope.shareUrlReadOnly=$scope.shareUrl,"Sky"!==$scope.lookAt?$scope.shareUrlReadOnly=hashManager.setHashVal("lookAt",$scope.lookAt,!0):"Earth"===$scope.lookAt&&($scope.shareUrlReadOnly=$scope.shareUrl=hashManager.removeHashVal("place",!0)),$scope.backgroundImagery&&"Digitized Sky Survey (Color)"!=$scope.backgroundImagery.get_name()&&($scope.shareUrlReadOnly=$scope.shareUrl=hashManager.setHashVal("imagery",$scope.backgroundImagery.get_name(),!0)),"100px"!=$(".cross-fader a.btn").css("left")&&($scope.shareUrlReadOnly=$scope.shareUrl=hashManager.setHashVal("cf",$(".cross-fader a.btn").css("left").replace(/px/,""),!0)),$("#shareUrl").on("focus",function(){$(this).select()}),$scope.includeViewportChange(),selectUrl(999)},$rootScope.$on("viewportchange",$scope.init),$scope.includeViewportChange=function(){var title,image;$scope.includeViewport?(hashManager.setHashVal("ra",$rootScope.viewport.RA.toFixed(5),!0),hashManager.setHashVal("dec",$rootScope.viewport.Dec.toFixed(5),!0),$scope.shareUrlReadOnly=$scope.shareUrl=hashManager.setHashVal("fov",$rootScope.viewport.Fov.toFixed(5),!0)):(hashManager.removeHashVal("ra",!0),hashManager.removeHashVal("dec",!0),$scope.shareUrlReadOnly=$scope.shareUrl=hashManager.removeHashVal("fov",!0)),image=$scope.trackingObj?(title=$scope.trackingObj.get_name()+" - WorldWide Telescope",$scope.trackingObj.get_thumbnailUrl()):(title=$scope.getFromEn("WorldWide Telescope Web Client"),new URL(wwt.staticAssetsPrefix+"images/wwtlogo.png",window.location).toString()),$('meta[property="og:url"]').attr("content",$scope.shareUrlReadOnly),$('meta[property="og:title"]').attr("content",title),$('meta[property="og:image"]').attr("content",image),selectUrl(222)};var selectUrl=function(delay){setTimeout(function(){$("#shareUrl").length&&($("#shareUrl")[0].focus(),$("#shareUrl")[0].select())},delay)};$scope.hide=function(){$scope.$parent.$hide()}}]),wwt.controllers.controller("SlideSelectionController",["$scope","$timeout",function($scope,$timeout){function rebind(){init.apply($scope,[])}var overlays,selection,tourScope=angular.element("#currentTourPanel").scope(),init=$scope.init=function(){selection=tourScope.tourEdit.tourEditorUI.selection,$scope.selectionSet=selection.selectionSet,overlays=$scope.overlays=tourScope.selectedSlide._overlays,$scope.$applyAsync(function(){overlays.forEach(function(overlay,j){overlay.selected=selection.isOverlaySelected(overlay)})})};$scope.selectionChange=function(overlay){selection.clearSelection();var range=[];overlays.forEach(function(overlay,i){overlay.selected&&range.push(overlay)}),selection.addSelectionRange(range)};$("canvas").on("dblclick click keyup",rebind),tourScope.$on("initSlides",rebind),$timeout(rebind,100)}]),wwt.controllers.controller("TourSlideText",["$scope","$rootScope","Util","$timeout",function($scope,$rootScope,util,$timeout){var iframeBody,editorUI=wwtlib.WWTControl.singleton.tourEdit.tourEditorUI,editScope=null,pristineText=null;var textObject={text:"",foregroundColor:"#ffffff",backgroundColor:"transparent",bold:!1,italic:!1,underline:!1,fontSize:24,fontName:"Arial",borderStyle:0},editableKeys=Object.keys(textObject),saving=!1;function initEditorObserver(){iframeBody=$(".modal.tour-text iframe").contents().find("body"),editScope.editText&&(iframeBody.html(""),textObject.text.split("\n").forEach(function(s,i){iframeBody.append($("<p></p>").html(s))}),iframeBody.find("p").css({color:textObject.foregroundColor,backgroundColor:textObject.backgroundColor,fontWeight:textObject.fontWeight?"bold":"normal",fontSize:textObject.fontSize+"pt",textDecoration:textObject.underline?"underline":"none",fontStyle:textObject.italic?"italic":"none",fontFamily:textObject.fontName,margin:"3px 0"}));function getObserver(cb){return new MutationObserver(function(mutations){saving?console.log("not observing after save"):mutations.forEach(function(){setTimeout(cb,100)})})}var fontConfig={attributes:!0,childList:!0,characterData:!0},fontFamily=$('.mce-widget[aria-label="Font Family"] span.mce-txt'),fontSizes=(fontFamily.text(textObject.fontName),$('.mce-widget[aria-label="Font Sizes"] span.mce-txt')),boldBtn=(fontSizes.text(textObject.fontSize),$(".mce-i-bold").parent().parent()),italicBtn=$(".mce-i-italic").parent().parent(),underBtn=$(".mce-i-underline").parent().parent(),bgColor=(getObserver(function(mutation){0===fontFamily.text().indexOf("Font")?fontFamily.text(textObject.fontName):(iframeBody.find("*").css("font-family",fontFamily.text()),textObject.fontName=fontFamily.text())}).observe(fontFamily.parent().parent()[0],fontConfig),getObserver(function(mutation){0===fontSizes.text().indexOf("Font")?fontSizes.text(textObject.fontSize):(iframeBody.find("*").css("font-size",fontSizes.text()),textObject.fontSize=parseInt(fontSizes.text().replace("pt","")))}).observe(fontSizes.parent().parent()[0],fontConfig),getObserver(function(mutation){textObject.bold=boldBtn.hasClass("mce-active"),iframeBody.find("*").css("font-weight",textObject.bold?"bold":"normal")}).observe(boldBtn[0],fontConfig),getObserver(function(mutation){textObject.italic=italicBtn.hasClass("mce-active"),iframeBody.find("*").css("font-style",textObject.italic?"italic":"normal")}).observe(italicBtn[0],fontConfig),getObserver(function(mutation){textObject.underline=underBtn.hasClass("mce-active"),iframeBody.find("*").css("text-decoration",textObject.underline?"underline":"none")}).observe(underBtn[0],fontConfig),$(".mce-ico.mce-i-backcolor").parent().parent().find(".mce-preview")[0]),fgColor=$(".mce-ico.mce-i-forecolor").parent().parent().find(".mce-preview")[0],fontConfig={attributes:!0,childList:!1,characterData:!1};getObserver(function(mutation){var newFg=$(fgColor).css("background-color");iframeBody.find("*").css("color",newFg),textObject.foregroundColor=newFg}).observe(fgColor,fontConfig),getObserver(function(mutation){var newBg=$(bgColor).css("background-color");textObject.backgroundColor=newBg,console.log(newBg,$(".popover.tour-text iframe").contents()),iframeBody.css("background-color",newBg)}).observe(bgColor,fontConfig)}function readyTimer(){att++,$(".modal .mce-ico.mce-i-forecolor").length?(console.log("editor ready"),initEditorObserver()):(console.log(att+" init attempts"),setTimeout(readyTimer,100))}var att=0,hideEditor=$scope.hideEditor=function(){editScope.editText&&(editScope.editText.onFinished(pristineText),editScope.editText=null),$scope.$parent.$applyAsync(function(){$scope.$parent.$hide()})};$timeout(function(){tinymce.init({selector:"textarea.tour-text",fontsize_formats:"8pt 9pt 10pt 11pt 12pt 14pt 16pt 18pt 20pt 24pt 28pt 32pt 36pt 40pt 44pt 48pt 54pt 60pt 66pt 72pt 80pt 88pt 96pt 112pt 128pt 150pt 200pt",height:500,theme:"modern",plugins:["save contextmenu textcolor colorpicker"],toolbar1:"save | undo redo | fontselect fontsizeselect | bold italic underline | forecolor backcolor ",toolbar2:"",save_onsavecallback:function(){for(saving=!0,textObject.text="";""===iframeBody.find("p").last().text().trim();)iframeBody.find("p").last().remove();iframeBody.find("p").each(function(i,p){0<i&&(textObject.text+="\n"),textObject.text+=$(p).text()});try{function rgb2hex(rgb){return 0!==rgb.indexOf("rgb")?rgb:"#"+hex((rgb=rgb.split("(")[1].replace(")","").split(","))[0])+hex(rgb[1])+hex(rgb[2]);function hex(x){return("0"+parseInt(x).toString(16)).slice(-2)}}var txtObj;editScope.editText?($.each(editableKeys,function(i,key){pristineText[key]!==textObject[key]&&(0<key.indexOf("Color")?pristineText[key]=wwtlib.Color.load(rgb2hex(textObject[key])):pristineText[key]=textObject[key])}),editScope.editText.onFinished(pristineText),editScope.editText=null):(txtObj=wwtlib.TextObject.create(textObject.text,textObject.bold,textObject.italic,textObject.underline,textObject.fontSize,textObject.fontName,wwtlib.Color.load(rgb2hex(textObject.foregroundColor)),wwtlib.Color.load(rgb2hex(textObject.backgroundColor)),textObject.borderStyle),editorUI.addText({},txtObj))}catch(ex){console.trace(ex)}hideEditor()},content_css:wwt.staticAssetsPrefix+"css/mcecontent.css"}),readyTimer()},10),(editScope=angular.element("#currentTourPanel").scope()).editText&&(pristineText=editScope.editText.textObject,$.each(editableKeys,function(i,key){pristineText[key]!==textObject[key]&&(0<key.indexOf("Color")?textObject[key]=0===pristineText[key].a?"transparent":pristineText[key].toFormat():textObject[key]=pristineText[key])}))}]),wwt.controllers.controller("voTableViewer",["$rootScope","$scope","AppState","Util",function($rootScope,$scope,appState,util){var layer=$scope.voTableLayer;$scope.plotTypes=[{lbl:"Gaussian",type:0},{lbl:"Point",type:1},{lbl:"Circle",type:2},{lbl:"Square",type:3},{lbl:"Push Pin",type:4}],$scope.plotType=layer.get_plotType();$scope.mapColumn=function(layerPropKey,modelVal){layer[layerPropKey]=$scope.votable.columns[modelVal].index,layer.cleanUp()},$scope.updatePlot=function(){layer.set_plotType($scope.plotType),console.log($scope.plotType),layer.cleanUp()},$scope.hilite=function(row,$index){var ra=parseFloat(row.columnData[$scope.RAIndex]),row=parseFloat(row.columnData[$scope.DecIndex]);wwt.wc.gotoRaDecZoom(ra,row,$rootScope.viewport.Fov,!0),$scope.hiliteIndex=$index},$scope.hiliteIndex=-1,setTimeout(function(){var colArray=[];$scope.votable&&$scope.votable.columns&&(Object.keys($scope.votable.columns).forEach(function(c,i){var col=$scope.votable.columns[c];col.id=col.id||c,colArray.push(col),"RA"!==c.toUpperCase()&&"pos.eq.ra;meta.main"!==col.ucd||($scope.RASource=col.id,$scope.RAIndex=col.index),"DEC"!==c.toUpperCase()&&"pos.eq.dec;meta.main"!==col.ucd||($scope.DecSource=col.id,$scope.DecIndex=col.index)}),$scope.SizeSource=$scope.votable.column[layer.get_sizeColumn()].id,$scope.SizeIndex=$scope.votable.column[layer.get_sizeColumn()].index,$(".modal-content div.results").on("scroll",function(e){var e=e.currentTarget,rows=$scope.votable.rows,paged=$scope.votable.pagedRows;paged.length<rows.length&&e.scrollHeight-e.scrollTop<800&&$scope.$applyAsync(function(){paged=paged.concat(rows.slice(paged.length,Math.min(rows.length,paged.length+100))),$scope.votable.pagedRows=paged})})),$scope.colArray=colArray},555)}]),wwt.controllers.controller("voConeSearch",["$rootScope","$scope","AppState","Util",function($rootScope,$scope,appState,util){$scope.searchRegistry=function(){$scope.hiliteIndex=-1,$scope.searchBaseURL="";var searchUrl="//nvo.stsci.edu/vor10/NVORegInt.asmx/VOTCapabilityPredicate?predicate=(title%20like%20'%25"+$scope.regTitle+"%25'%20or%20shortname%20like%20'%25"+$scope.regTitle+"%25')&capability="+($scope.coneSearch?"ConeSearch":"SIAP");console.log(searchUrl),$rootScope.loading(!0,"Loading NVO Registry Data. Please wait..."),wwtlib.VoTable.loadFromUrl(searchUrl,function(){$rootScope.loading(!1),$scope.table=this,$scope.$applyAsync(function(){}),Object.keys(this.columns).forEach(function(c,i){console.log($scope.table.columns[c].index+":"+c+"("+$scope.table.rows[5].columnData[$scope.table.columns[c].index]+")")}),console.log(this)})},$scope.displayColumns=["title","type","capabilityClass","publisher","waveband","identifier","maxSearchRadius","maxRecords"],$scope.getData=function(row,columnKey){return row.columnData[$scope.table.columns[columnKey].index]||"-"},$scope.hilite=function(row,$index){$scope.hiliteIndex=$index,$scope.searchBaseURL=$scope.getData(row,"accessURL"),$scope.searchBaseTitle=$scope.getData(row,"title")},$scope.hiliteIndex=-1,$scope.regTitle="",$scope.searchBaseURL="",$scope.fromRegistry=!0,$scope.fromView=!0,$scope.coneSearch=!0,$scope.siapImages=!1,$scope.search=function(){var url=$scope.hiliteIndex<0?($scope.searchBaseTitle="casjobs.sdss.org","//casjobs.sdss.org/vo/dr5cone/sdssConeSearch.asmx/ConeSearch"):$scope.searchBaseURL.replace("&amp;","&"),lastIndex=url.length-1,qObj=(url.lastIndexOf("?")!==lastIndex&&url.lastIndexOf("&")!==lastIndex&&(0<url.indexOf("?")?url+="&":url+="?"),$scope.coneSearch?{RA:$scope.RA,DEC:$scope.Dec,SR:$scope.Fov,VERB:$scope.verbosity}:{POS:$scope.RA+","+$scope.Dec,SIZE:$scope.Fov,VERB:$scope.verbosity}),params=[];Object.keys(qObj).forEach(function(k){params.push(k+"="+qObj[k])}),lastIndex=url+params.join("&"),wwtlib.VoTable.loadFromUrl(lastIndex,function(){$rootScope.loading(!1);this.rows.length?(this.pagedRows=this.rows.slice(0,100),$rootScope.loadVOTableModal(wwt.wc.addVoTableLayer(this)),$scope.$parent.$hide()):$scope.noResults=!0}),$rootScope.loading(!0,"Loading "+$scope.searchBaseTitle+" result. Please wait...")},$scope.hideBanner=function(){$scope.noResults=!1},$scope.RA=15*$rootScope.viewport.RA,$scope.Dec=$rootScope.viewport.Dec,$scope.Fov=$rootScope.viewport.Fov,$scope.verbosity=1,console.log($rootScope.viewport),setTimeout(function(){},444)}]),wwt.controllers.controller("refFrameController",["$scope","Util",function($scope,util){$scope.page=$scope.propertyMode?"options":"welcome",$scope.pages=["welcome","options","position"],$scope.offsetTypes=[{type:0,label:"Fixed Spherical"},{type:1,label:"Orbital"},{type:2,label:"Trajectory"},{type:3,label:"Synodic"}],$scope.offsetType=1,$scope.buttonsEnabled={next:!1,back:!1,finish:!1},$scope.pasteTLE=function(e){e=e.originalEvent.clipboardData.getData("Text").replace(/(\r\n|\r|\n)/g,"\r\n").split("\r\n").filter(function(l){return 1<l.length});$scope.tleError=!wwtlib.LayerManager.pasteFromTle(e,$scope.refFrame),console.log(e),setTimeout(function(){$("table .paste-control").html("")},1)},$scope.offsetTypeChange=function(){$scope.refFrame.referenceFrameType=$scope.offsetType},$scope.hexColor=util.argb2Hex($scope.refFrame.representativeColor),$scope.colorChange=function(){util.hex2argb($scope.hexColor,$scope.refFrame.representativeColor)};function calcButtonState(){var i=$scope.pages.indexOf($scope.page);$scope.buttonsEnabled.next="welcome"===$scope.page?$scope.refFrame.name.length:i<$scope.pages.length-1,$scope.buttonsEnabled.back=0<i,$scope.buttonsEnabled.finish=i===$scope.pages.length-1}$scope.next=function(){var i=$scope.pages.indexOf($scope.page);$scope.page=$scope.pages[i+1],calcButtonState()},$scope.back=function(){var i=$scope.pages.indexOf($scope.page);$scope.page=$scope.pages[i-1],calcButtonState()},$scope.finish=function(){console.log($scope.dialog),$scope.dialog.OK($scope.refFrame)},calcButtonState()}]),wwt.controllers.controller("CommunityController",["$scope","Util","$timeout","ThumbList","Community",function($scope,util,$timeout,thumbList,community){var bc,depth=1,cache=[],calcPageSize=($scope.initCommunityView=function(){thumbList.init($scope,"communities"),community.getRoot().then(function(result){$("body").append($("#researchMenu")),$scope.collection=result;var collectionsString=$scope.getFromEn("Collections");collectionsString.then?collectionsString.then(function(s){$scope.breadCrumb=bc=[s]}):$scope.breadCrumb=bc=[collectionsString],cache=[result],calcPageSize()})},function(){thumbList.calcPageSize($scope,!1)});$scope.clickThumb=function(item,folderCallback){var outParams={breadCrumb:bc,depth:depth,cache:cache},item=thumbList.clickThumb(item,$scope,outParams,folderCallback);bc=item.breadCrumb,cache=item.cache,depth=item.depth},$scope.expanded=!1,$scope.breadCrumbClick=function(index){for($scope.collection=cache[index];bc.length-1>index;)bc.pop(),cache.pop();$scope.currentPage=0,calcPageSize()},$(window).on("resize",function(){$scope.currentPage=0,calcPageSize()}),$scope.preventClickBubble=function(event){event.stopImmediatePropagation()},$scope.initCommunityView()}]),wwt.controllers.controller("CurrentTourController",["$scope","$rootScope","Util","MediaFile","AppState","$timeout","$modal",function($scope,$rootScope,util,media,appState,$timeout,$modal){var tour,refreshLoop,tourEdit=$scope.tourEdit=wwtlib.WWTControl.singleton.tourEdit,isNewTour=!1,mainScope=angular.element("div.desktop").scope(),scrollerInit=($scope.slideNumbering=appState.get("slideNumbering"),$scope.overlayList=appState.get("overlayList"),!1),showSlides=($scope.init=function(curTour){tourEdit=$scope.tourEdit=wwtlib.WWTControl.singleton.tourEdit,$rootScope.currentTour=$scope.tour=tour=tourEdit.get_tour(),console.log("looking for a nextSlideCallback!",tourEdit),initSetNextSlideModal(),tourEdit.tourEditorUI.editTextCallback=function(textObject,onFinished){$scope.editText={textObject:textObject,onFinished:onFinished},$("#editTourText").click()},mapStops(!0),wwt.wc.add_slideChanged(function(){$scope.$applyAsync(function(){$scope.activeIndex=tour.get_currentTourstopIndex(),$scope.activeSlide=tour.get_currentTourStop(),tourEdit.tourStopList.selectedItems={},tourEdit.tourStopList.selectedItems[$scope.activeIndex]=$scope.activeSlide})}),tourEdit.tourStopList.refreshCallback=mapStops,$scope.editText=null,mainScope.ribbon.tabs[1].menu["Show Slide Overlays"]=[$scope.showOverlayList],mainScope.ribbon.tabs[1].menu["Show Slide Numbers"]=[$scope.showSlideNumbers],$rootScope.$on("escKey",showSlides),$rootScope.$on("closeTour",closeTour),$rootScope.$watch("editingTour",initEditMode),$rootScope.$on("tourFinished",finishedPlaying),$rootScope.$on("showingSlides",function(){scrollerInit||(scrollerInit=!0,showTourSlides())}),(mainScope.autoEdit||util.getQSParam("edit")&&util.getQSParam("debug"))&&(showSlides(),tour._editMode=!0,tourEdit.pauseTour(),$rootScope.editingTour=!0),self.addEventListener("beforeunload",function(e){tourEdit.get_tour().get_tourDirty()&&(e.returnValue="You have unsaved changes that will be lost if you proceed. Click cancel to save changes.")})},function(){tourEdit.playing&&tourEdit.pauseTour(),$scope.$applyAsync(showTourSlides)}),initEditMode=function(){if(!0===$rootScope.editingTour){if(console.log("logged in state:",$rootScope.loggedIn),!$rootScope.loggedIn){var loginModalData=$scope.$new({});if(loginModalData.canLogin=location.href.indexOf("localhost")<0,!1===appState.get("remindEditTourLogin"))return;appState.set("remindEditTourLogin",!0),loginModalData.remindEditTourLogin=appState.get("remindEditTourLogin"),loginModalData.remindPrefChange=function(checked){appState.set("remindEditTourLogin",checked)},loginModalData.loginThenEdit=function(){appState.set("editTourOnLogin",tour.url),$rootScope.login()},$modal({scope:loginModalData,templateUrl:wwt.staticAssetsPrefix+"views/modals/centered-modal-template.html",contentTemplate:wwt.staticAssetsPrefix+"views/modals/login-before-edit.html",show:!0,placement:"center",backdrop:"static"})}tour._editMode=!0,tourEdit.pauseTour(),$("#contextmenu,#popoutmenu").on("click",function(){mapStops.apply($scope,[])}),setTimeout(initVolumeSliders,111),$("canvas").on("dblclick click",function(){mapStops.apply($scope,[])})}},closeTour=function(){console.trace("closetour"),$scope.tourEdit=tourEdit=null,$rootScope.currentTour=$scope.tour=tour=null},finishedPlaying=function(){tour._currentTourstopIndex==tour._tourStops.length-1&&(showSlides(!0),$scope.selectStop(0,null),tourEdit.playing?$scope.playButtonClick():($rootScope.tourPlaying=!1,$rootScope.tourPaused=!0))},initVolumeSliders=($scope.showSlideNumbers=function(){$scope.$applyAsync(function(){$scope.slideNumbering=!$scope.slideNumbering,appState.set("slideNumbering",$scope.slideNumbering)})},$scope.showOverlayList=function(){$scope.$applyAsync(function(){$scope.overlayList=!$scope.overlayList,appState.set("overlayList",$scope.overlayList)})},function(){function volumeOpts(barEl){return{el:barEl,bounds:{x:[-50,50],y:[0,0]},onstart:function(){barEl.addClass("moving")},onmove:function(){var audio="voiceVol"===barEl.attr("id")?$scope.activeSlide.voice:$scope.activeSlide.music;audio&&audio.set_volume(this.css.left)},oncomplete:function(){barEl.removeClass("moving");var audio="voiceVol"===barEl.attr("id")?$scope.activeSlide.voice:$scope.activeSlide.music;$scope.$applyAsync(function(){audio.vol=this.css.left})}}}new wwt.Move(volumeOpts($("#musicVol"))),new wwt.Move(volumeOpts($("#voiceVol")))}),showTourSlides=($scope.tourProp=function($event,prop){tour["set_"+prop]($event.target.value)},$scope.saveTour=function(){function saveRawFile(){var saveUrl,a;navigator&&navigator.msSaveBlob?navigator.msSaveBlob(blob,filename):($("#downloadTour").remove(),saveUrl=URL.createObjectURL(blob),(a=document.createElement("a")).download=filename,a.href=saveUrl,a.innerHTML="&nbsp;",a.id="downloadTour",a.style.position="absolute",a.style.top="-999px",a.dataset.downloadurl=["application/wtt",a.download,a.href].join(":"),document.body.appendChild(a),$("#downloadTour")[0].click())}var blob=tour.saveToBlob(),filename=tour._title+".wtt";$scope.modalData={step:"save",tourTitle:tour._title},$rootScope.loggedIn?($scope.modalData.saveChoice=function(upload){$scope.$applyAsync(function(){var fd;upload?($scope.modalData.step="progress",(fd=new FormData).append("fname",filename),fd.append("data",blob),$.ajax("/Resource/Service/Content/PublishTour/"+tour._title,{type:"POST",data:blob,processData:!1,beforeSend:function(request){request.setRequestHeader("LiveUserToken",$rootScope.token)},contentType:"text/plain"}).done(function(data){$scope.$applyAsync(function(){var url;data&&1<data.length?($scope.modalData.step="success",url="//"+location.host+"/file/Download/"+data+"/"+tour._title+"/wtt",$scope.modalData.download={url:url,showStatus:!1,label:"Share Download Link"},$scope.modalData.share={url:"//"+location.host+"/webclient?tourUrl="+encodeURIComponent(url),showStatus:!1,label:"Share Playable Link"}):($scope.modalData.step="error",$scope.modalData.error=+data)})})):saveRawFile()})},$modal({scope:$scope,templateUrl:wwt.staticAssetsPrefix+"views/modals/tour-uploader.html",show:!0,content:"",placement:"center"})):saveRawFile()},$scope.addShape=function(type){tourEdit.tourEditorUI.addShape("",type)},$scope.mediaFileChange=function(e,mediaKey,isImage){console.time("storeLocal: "+mediaKey);e=e.target.files[0];e.name&&(isImage?tourEdit.tourEditorUI.addPicture(e):(console.log("addAudio"),tourEdit.tourEditorUI.addAudio(e,"music"===mediaKey),$timeout(bindAudio,500)))},function(){console.log(tourEdit.playing),setTimeout(function(){$rootScope.stopScroller=$(".scroller").jScrollPane({scrollByY:155,horizontalDragMinWidth:155}).data("jsp"),$(window).on("resize",function(){$rootScope.stopScroller.reinitialise()})},500)}),bindAudio=($scope.showContextMenu=function(index,e){e&&($scope.selectStop(index),tourEdit.tourStopList_MouseClick(index,e))},$scope.selectStop=function(index,e){$scope.$applyAsync(function(){if($scope.activeSlide=tourEdit.tourStopList.selectedItem=$scope.tourStops[index],$scope.activeIndex=index,tour._editMode)if(e&&e.shiftKey){tourEdit.tourStopList.selectedItems={};for(var i=Math.min(index,$scope.lastFocused);i<=Math.max(index,$scope.lastFocused);i++)tourEdit.tourStopList.selectedItems[i]=$scope.tourStops[i]}else{var keys;e&&e.ctrlKey?(keys=Object.keys(tourEdit.tourStopList.selectedItems),tourEdit.tourStopList.selectedItems[index]&&1<keys.length?(delete tourEdit.tourStopList.selectedItems[index],$scope.activeIndex=keys[0]):tourEdit.tourStopList.selectedItems[index]=$scope.tourStops[index]):(tourEdit.tourStopList.selectedItems={},tourEdit.tourStopList.selectedItems[index]=$scope.tourStops[index])}else tourEdit.tourStopList.selectedItems={},tourEdit.tourStopList.selectedItems[index]=$scope.tourStops[index];tour.set_currentTourstopIndex($scope.activeIndex),$scope.lastFocused=index,$scope.selectedSlide=$scope.tourStops[$scope.activeIndex],tourEdit.tour_CurrentTourstopChanged(),$scope.$broadcast("initSlides"),$timeout(bindAudio,500)})},function(){var mapAudioProps;$scope.activeSlide&&($scope.activeSlide.music=(mapAudioProps=function(audio){return audio&&(audio.muted=audio.get_mute(),audio.name=""===audio._name?audio._filename$1:audio._name,audio.vol=audio.get_volume(),audio.mute=function(flag){$scope.$applyAsync(function(){audio.muted=flag,audio.set_mute(flag)})}),audio})($scope.activeSlide._musicTrack),$scope.activeSlide.voice=mapAudioProps($scope.activeSlide._voiceTrack))}),mapStops=($scope.showStartCameraPosition=function(index){tour.set_currentTourstopIndex(index),tourEdit.tourStopList_ShowStartPosition()},$scope.showEndCameraPosition=function(index){tour.set_currentTourstopIndex(index),tourEdit.tourStopList_ShowEndPosition()},$scope.playButtonClick=function(){tourEdit.playing?tourEdit.pauseTour():tour._editMode?($scope.selectStop(0),tourEdit.playNow(!0)):tourEdit.playFromCurrentTourstop(),$rootScope.tourPlaying=tourEdit.playing,$rootScope.tourPaused=!tourEdit.playing},$scope.refreshStops=function(isInit){refreshLoop||(refreshLoop=!0,setTimeout(function(){refreshLoop=!1},55),$scope.$applyAsync(function(){tour.duration=0,$scope.tourStops=tour.get_tourStops().map(function(s){return s.description=s.get_description(),s.thumb=s.get_thumbnail(),s.duration=s.get_duration(),tour.duration+=s.duration,s.atime=s.get__transitionOutTime(),s.btime=s.get__transitionTime(),s.holdtime=s.get__transitionHoldTime(),s.transitionType=s.get__transition(),s.isMaster=s.get_masterSlide(),s}),tour.minuteDuration=tour.duration/60/1e3<<0,tour.secDuration=tour.duration/1e3%60<<0,$scope.tour=tour,isNewTour||$scope.tourStops.length||"New Tour"!==tour._title?((isNewTour&&$scope.tourStops.length||isInit&&!0===isInit)&&(isNewTour=!1,$scope.selectStop(0),$scope.$watch("activeSlide._tweenPosition",function(e){1===e&&finishedPlaying()})),$scope.$broadcast("initSlides")):(isNewTour=!0,setTimeout(function(){$("#newTourProps").click()},500))}))}),initSetNextSlideModal=($scope.launchFileBrowser=function(inputId){$("#"+inputId).click()},$scope.setStopTransition=function(index,transitionType,transTime){if(transitionType||0===transitionType)(stop=$scope.tourStops[index]).set__transition(transitionType),stop.transitionType=transitionType;else if(transTime&&"string"==typeof transTime){var stop=$scope.tourStops[index];switch(transTime){case"atime":stop.set__transitionOutTime(stop.atime);break;case"btime":stop.set__transitionTime(stop.btime);break;case"holdtime":stop.set__transitionHoldTime(stop.holdtime)}}},function(){tourEdit.nextSlideCallback=tourEdit.tourEditorUI.nextSlideCallback=function(selectDialog,onFinished){var nextSlideModal=$scope.$new({});nextSlideModal.dialog=selectDialog,nextSlideModal.dialog_ok=function(ok){var dialog=nextSlideModal.dialog;console.log(dialog,selectDialog),dialog._ok=ok,dialog._next&&dialog.set_id("Next"),onFinished(selectDialog)},nextSlideModal.selectedNextSlide=null,nextSlideModal.tourStops=$scope.tourStops,nextSlideModal.slideClick=function(id){nextSlideModal.selectedNextSlide=id,nextSlideModal.dialog.set_id(id),nextSlideModal.dialog._linkSlide=!0,nextSlideModal.dialog._return=!1,nextSlideModal.dialog._next=!1},nextSlideModal.checkChange=function(key){console.log(nextSlideModal.tourStops);var v=selectDialog[key];selectDialog._next=!1,selectDialog._return=!1,selectDialog._linkSlide=!1,selectDialog["set_"+{_linkSlide:"linkToSlide",_next:"next",_return:"returnCaller"}[key]](v),console.log(key,selectDialog)},$modal({scope:nextSlideModal,templateUrl:wwt.staticAssetsPrefix+"views/modals/centered-modal-template.html",contentTemplate:wwt.staticAssetsPrefix+"views/modals/set-next-slide.html",show:!0,content:"",placement:"center"});setTimeout(function(){console.log(nextSlideModal),$(".scroller.next-slide").jScrollPane({scrollByY:155,horizontalDragMinWidth:155}).data("jsp")},400)}})}]),wwt.controllers.controller("ExploreController",["$scope","$rootScope","AppState","Places","$timeout","Util","ThumbList","UILibrary",function($scope,$rootScope,appState,places,$timeout,util,thumbList,uiLib){var exploreRoot,bc,openCollection,collectionPlace,collectionPlaceIndex,hashObj,newCollectionUrl,depth=1,cache=[],findCollectionChild=($rootScope.$on("hashChange",function(event,obj){obj.place&&isNaN(parseInt(obj.place.charAt(0)))&&(collectionPlace=(hashObj=obj).place,collectionPlaceIndex=1,$scope.loadingUrlPlace=!0,$("#loadingModal").modal("show"),places.getRoot().then(function(){$scope.breadCrumb=bc=[$scope.getFromEn("Collections")],$("body").append($("#researchMenu")),$scope.collection=exploreRoot,findCollectionChild()}))}),$scope.initExploreView=function(hashChange){thumbList.init($scope,"explore"),hashChange||places.getRoot().then(function(result){$("body").append($("#researchMenu")),$scope.collection=exploreRoot=result;var collectionsString=$scope.getFromEn("Collections");collectionsString.then?collectionsString.then(function(s){$scope.breadCrumb=bc=[s]}):$scope.breadCrumb=bc=[collectionsString],cache=[result],calcPageSize(),$.each(result,function(i,item){"Open Collections"===item.get_name()&&(result.splice(0,0,result.splice(i,1)[0]),"Open Collections"===item.get_name())&&(openCollection=!0,$scope.clickThumb(item))})})},function(){var guidParts=collectionPlace.split("."),relevantPart=guidParts.slice(0,collectionPlaceIndex).join("."),child=places.findChildById(relevantPart,$scope.collection);collectionPlaceIndex<guidParts.length?(collectionPlaceIndex++,$scope.clickThumb(child,findCollectionChild)):$timeout(function(){var timer;$scope.loadingUrlPlace=!1,$scope.clickThumb(child),$("#loadingModal").modal("hide"),hashObj.ra&&(timer=-1!==hashObj.place.toLowerCase().indexOf("hirise")?6666:3333,setTimeout(function(){$rootScope.ctl.gotoRaDecZoom(15*parseFloat(hashObj.ra),parseFloat(hashObj.dec),parseFloat(hashObj.fov),!1)},timer)),location.hash="/"},2222)}),handledInitBroadcast=!1,calcPageSize=($scope.$on("initExplorer",function(event,collectionUrl){handledInitBroadcast||(newCollectionUrl=collectionUrl,$scope.initExploreView(),handledInitBroadcast=!0,setTimeout(function(){handledInitBroadcast=!1},2e3))}),function(){thumbList.calcPageSize($scope,!1)}),annotations=($scope.clickThumb=function(item,folderCallback){"boolean"==typeof folderCallback&&($rootScope.instant=folderCallback);var outParams={breadCrumb:bc,depth:depth,cache:cache,openCollection:openCollection,newCollectionUrl:newCollectionUrl};item=thumbList.clickThumb(item,$scope,outParams,function(){"function"==typeof folderCallback&&folderCallback(),checkAnnotations()});bc=item.breadCrumb,cache=item.cache,openCollection=item.openCollection,newCollectionUrl=item.newCollectionUrl,depth=item.depth},$scope.expanded=!1,[]),checkAnnotations=function(){annotations&&annotations.length&&(annotations.forEach(function(a){wwt.wc.removeAnnotation(a)}),console.log("cleanup "+annotations.length+" annotations"),annotations=[]);var col=$scope.collection;col.forEach(function(place){var opts,a;wwtlib.ss.canCast(place,wwtlib.Place)&&place.annotation&&place.annotation.length&&(opts=uiLib.annotationOpts(place.annotation),a=wwt.wc.createCircle(opts.fill),opts.fill&&a.set_fillColor(opts.fill),a.set_id(place.annotation),annotations.push(place.annotation),a.setCenter(15*place.get_RA(),place.get_dec()),a.set_lineColor(opts.linecolor||"#00ff00"),a.set_lineWidth(2),opts.linewidth&&a.set_lineWidth(parseFloat(opts.linewidth)),a.set_skyRelative(!0),a.set_radius(opts.radius?parseFloat(opts.radius):.005),wwt.wc.addAnnotation(a),annotations.push(a))})};$scope.breadCrumbClick=function(index){for($scope.collection=cache[index];bc.length-1>index;)bc.pop(),cache.pop();$scope.currentPage=0,calcPageSize(),checkAnnotations()},$(window).on("resize",function(){$scope.currentPage=0,calcPageSize()}),$scope.preventClickBubble=function(event){event.stopImmediatePropagation()},$scope.initExploreView()}]),wwt.controllers.controller("SearchController",["$scope","$rootScope","$timeout","Util","SearchUtil","ThumbList",function($scope,$rootScope,$timeout,util,searchUtil,thumbList){$scope.goto={RA:"",Dec:""};function calcPageSize(){thumbList.calcPageSize($scope,!1)}$scope.clickThumb=function(item,instant){$rootScope.instant=!!instant,thumbList.clickThumb(item,$scope)};$scope.expanded=!1,$scope.expandThumbnails=function(flag){$scope.currentPage=0,$scope.expanded=null!=flag?flag:!$scope.expanded,$scope.expandTop($scope.expanded),calcPageSize()},$(window).on("resize",function(){$scope.currentPage=0,calcPageSize()}),$scope.gotoCoord=function(){var ra=util.parseHms($scope.goto.RA),dec=util.parseHms($scope.goto.Dec);isNaN(ra)||isNaN(dec)?$scope.goto.error=!0:($scope.goto.error=!1,dec=wwtlib.Place.create("tmp",dec,ra,null,null,wwtlib.ImageSetType[$scope.lookAt.toLowerCase()],60),$rootScope.singleton.gotoTarget(dec,!1,!1,!0))},$scope.searchKeyPress=function(){$timeout(function(){var q=$scope.q=$("#txtSearch").val();searchUtil.runSearch(q).then(function(result){$scope.collection=result,calcPageSize()})},10)},thumbList.init($scope,"search"),$rootScope.is_mobile&&($scope.scrollDepth=40),$timeout(function(){$scope.SearchType="J2000",$("#txtSearch").focus()},123)}]),wwt.controllers.controller("SettingsController",["$scope","$rootScope","AppState","$timeout","$cookies","Util","$q",function($scope,$rootScope,appState,$timeout,$cookies,util,$q){var redirTimer;$scope.defaults={autoHideTabs:!1,autoHideContext:!1,smoothPanning:!util.isAccelDevice(),version:"5.1.02",crosshairs:!0},$q.all([$scope.getFromEn("HTML5"),$scope.getFromEn("Silverlight")]).then(function(arrayLabels){$scope.availableClients=[{code:"HTML5",label:arrayLabels[0]},{code:"SL",label:arrayLabels[1]}]}),$scope.setClientPref=function(){util.log($scope.preferredClient),$cookies.preferredClient=$scope.preferredClient,"SL"==$scope.preferredClient&&($scope.redirecting=!0,$scope.redirectingSeconds=5,setInterval(function(){$timeout(function(){$scope.redirectingSeconds--})},1e3),redirTimer=setTimeout(function(){location.reload()},5e3))},$scope.cancelRedir=function(){clearTimeout(redirTimer),$scope.redirecting=!1},$timeout(function(){$scope.preferredClient=$cookies.preferredClient||$scope.availableClients[0].code},10),$scope.$on("restoreDefaults",function(){appState.set("settings",null),$scope.retrieveSettings()}),$scope.retrieveSettings=function(){$scope.savedSettings=appState.get("settings"),$scope.savedSettings&&$scope.savedSettings.version&&$scope.savedSettings.version==$scope.defaults.version||($scope.savedSettings=$scope.defaults),void 0===$scope.savedSettings.crosshairs&&($scope.savedSettings=$scope.defaults),$scope.saveSettings(!0)},$scope.WebGl=!!appState.get("WebGl"),$scope.setWebGl=function(){appState.set("WebGl",$scope.WebGl),location.reload()},$scope.saveSettings=function(init){$timeout(function(){var broadcast=!1;$.each($scope.savedSettings,function(setting,flag){$scope[setting]===flag&&!init||(init?$scope[setting]=flag:$scope.savedSettings[setting]=$scope[setting],0!==setting.indexOf("autoHide"))||(broadcast=!0)}),wwt.wc.settings.set_showCrosshairs($scope.crosshairs),wwt.wc.settings.set_smoothPan($scope.smoothPanning),appState.set("settings",$scope.savedSettings),broadcast&&$rootScope.$broadcast("autohideChange")},10)},$scope.retrieveSettings()}]),wwt.controllers.controller("ToursController",["$scope","$rootScope","AppState","Tours","$timeout","Util","$popover",function($scope,$rootScope,appState,tours,$timeout,util,$popover){var bc=[$scope.getFromEn("Tours")],cache=[],calcPageSize=($scope.pageCount=1,$scope.pageSize=1,$scope.currentPage=0,tours.getRoot().then(function(result){$scope.tourList=result,$scope.breadCrumb=bc,cache.push(result),calcPageSize()}),$scope.clickThumb=function(item){$scope.activeItem=item.get_thumbnailUrl()+item.get_name(),"Up Level"===item.get_name()?($scope.currentPage=0,bc.pop(),$scope.breadCrumb=bc,cache.pop(),$scope.tourList=cache[cache.length-1],calcPageSize()):(item.get_isFolder()&&($scope.currentPage=0,bc.push(item.get_name()),$scope.breadCrumb=bc,tours.getChildren(item).then(function(result){$scope.tourList=result,cache.push(result),calcPageSize()})),wwtlib.ss.canCast(item,wwtlib.Tour)&&($scope.playTour(item.get_tourUrl()),$rootScope.is_mobile)&&($rootScope.landscapeMessage=!0,setTimeout(function(){$scope.$hide()},2222)))},$scope.breadCrumbClick=function(index){for($scope.tourList=cache[index];bc.length-1>index;)bc.pop(),cache.pop()},function(){$timeout(function(){var winWid=$(window).width();$scope.pageSize=Math.floor(winWid/118),$scope.pageCount=Math.ceil($scope.tourList.length/$scope.pageSize)},1)}),popover=null,mask=null,hideMask=($scope.tourPreview=function(event,item){item.get_isFolder()||"Up Level"===item.get_name()||($scope.relatedTours=tours.getToursById(item.relatedTours),$rootScope.tour=item,mask||(mask=$("<div></div>").css({height:70,width:120,top:-999,left:-999,opacity:0,background:"#fff",position:"fixed",zIndex:2}).on("mouseleave",hideMask),$("body").append(mask)),popover&&popover.hide(),item={title:item.get_name(),target:$(event.currentTarget),id:"tourpop",templateUrl:wwt.staticAssetsPrefix+"views/popovers/tour-template.html",contentTemplate:wwt.staticAssetsPrefix+"views/popovers/tour-info.html",placement:"bottom-left",scope:$scope,trigger:"manual"},(popover=$popover($(event.currentTarget),item)).$promise.then(function(){popover.show();function fixImages(){$(".tour-info .author-image img").each(function(){0<this.naturalHeight&&0===$(this).height()&&$(this).css({height:this.naturalHeight,width:this.naturalWidth})})}var pos=$(event.currentTarget).offset();mask.css({top:pos.top-2,left:pos.left-2,opacity:.01});$(".tour-info img").off("load"),$(".tour-info img").on("load",fixImages),setTimeout(fixImages,500),setTimeout(fixImages,1500)}))},function(){mask.css({top:-999,left:-999})});$(window).on("resize",calcPageSize)}]),wwt.controllers.controller("ViewController",["$scope","AppState","$timeout","Util","$rootScope","UILibrary",function($scope,appState,$timeout,util,$rootScope,UILibrary){var stc=$scope.spaceTimeController=wwtlib.SpaceTimeController;function timeDateTimerTick(){$scope.activePanel!==$scope.loc.view&&!$rootScope.is_mobile||$timeout(function(){var now=$scope.now=stc.get_now();$scope.year=now.getFullYear(),$scope.month=(now.getMonth()+1)%12,$scope.date=now.getDate(),$scope.hours=now.getHours(),$scope.minutes=now.getMinutes(),$scope.seconds=now.getSeconds()})}function updateSpeed(){var tr=stc.get_timeRate();1==(tr=-2==tr?-1:tr)?$scope.TimeMode=$scope.loc.realTime:-2==stc.TimeRate?$scope.TimeMode=$scope.loc.reverseime:$scope.TimeMode="X "+tr,stc.get_syncToClock()||($scope.TimeMode=$scope.TimeMode+" : "+$scope.loc.paused)}$scope.galaxyModeChange=function(){$scope.galaxyMode&&$scope.viewFromLocation&&($scope.viewFromLocation=!1,$scope.setViewFromLocation()),wwt.wc.settings.set_galacticMode($scope.galaxyMode)},$scope.now=new Date,$scope.loc={view:"View",realTime:"Real Time",reverseTime:"Reverse Time",paused:"Paused"},$rootScope.languagePromise.then(function(){$scope.loc.view=$scope.getFromEn("View"),$scope.loc.realTime=$scope.getFromEn("Real Time"),$scope.loc.reverseTime=$scope.getFromEn("Reverse Time"),$scope.loc.paused=$scope.getFromEn("Paused")}),$scope.fastBack_Click=function(){var tr=stc.get_timeRate();tr<-2&&-1e9<=tr?stc.set_timeRate(10*tr):stc.set_timeRate(-10),stc.set_syncToClock(!0),updateSpeed()},$scope.back_Click=function(){var tr=stc.get_timeRate();tr<=-10?stc.set_timeRate(tr/10):stc.set_timeRate(-2),stc.set_syncToClock(!0),-1===stc.get_timeRate()&&stc.set_timeRate(-2),updateSpeed()},$scope.pause_Click=function(){stc.set_syncToClock(!stc.set_syncToClock),updateSpeed()},$scope.play_Click=function(){var tr=stc.get_timeRate();10<=tr?tr/=10:tr=1,stc.set_timeRate(tr),stc.set_syncToClock(!0),updateSpeed()},$scope.fastForward_Click=function(){var tr=stc.get_timeRate();0<tr&&tr<=1e9?stc.set_timeRate(10*tr):stc.set_timeRate(10),stc.set_syncToClock(!0),updateSpeed()},$rootScope.updateDateUI=function(){updateSpeed(),timeDateTimerTick()},$scope.timeNow_Click=function(){stc.set_syncToClock(!0),stc.syncTime(),stc.set_timeRate(1),updateSpeed()},$scope.setViewFromLocation=function(){$scope.galaxyMode&&$scope.viewFromLocation&&($scope.galaxyMode=!1,$scope.galaxyModeChange()),$scope.$applyAsync(function(){$rootScope.observingLocation.localHorizonMode=$scope.viewFromLocation,appState.set("observingLocation",$rootScope.observingLocation),$rootScope.ctl.settings.set_localHorizonMode($scope.viewFromLocation)})},$scope.showObservingLocationOptions=function(){UILibrary.showModal({scope:$scope,controller:"ObservingLocationController",template:"observing-loc-options",cssClass:"set-position observing-loc",fixedPosition:!0})},setInterval(timeDateTimerTick,300),updateSpeed(),$scope.viewFromLocation=$rootScope.ctl.settings._localHorizonMode,setTimeout(function(){$rootScope.observingLocation&&void 0!==$rootScope.observingLocation.lat||wwtlib.WWTControl.useUserLocation()},100)}]),wwt.Move=function(createArgs){var el,grid,bounds,onmove,onstart,oncomplete,isMoving,target,pointerId,actualBounds={left:null,top:null},moveObj={};function setBounds(newBounds){var css_top;(bounds=newBounds||bounds)?(newBounds=parseFloat(el.css("left"))||0,css_top=parseFloat(el.css("top"))||0,bounds.x?actualBounds.left=[newBounds+bounds.x[0],newBounds+bounds.x[1]]:actualBounds.left=[-1/0,1/0],bounds.y?actualBounds.top=[css_top+bounds.y[0],css_top+bounds.y[1]]:actualBounds.top=[-1/0,1/0]):(actualBounds.left=[-1/0,1/0],actualBounds.top=[-1/0,1/0])}function moveInit(event){moveObj.mouseCoord=getCoord(event),moveObj.startCoord={x:parseFloat(el.css("left")),y:parseFloat(el.css("top"))},isNaN(moveObj.startCoord.x)&&(moveObj.startCoord.x=0),isNaN(moveObj.startCoord.y)&&(moveObj.startCoord.y=0),moveObj.moveDist={x:0,y:0},moveObj.totalDist={x:0,y:0},moveObj.clickOffset=wwt.getClickOffset(event),moveObj.css={top:moveObj.startCoord.y,left:moveObj.startCoord.x},moveObj.maxX=actualBounds.left[0]+actualBounds.left[1],moveObj.maxY=actualBounds.top[0]+actualBounds.top[1],isMoving=!0,onstart&&onstart.call(moveObj)}var pointerUpName,pointerMoveName,motionHandler=function(evt){evt.stopPropagation();evt=getCoord(evt);moveObj.moveDist={x:evt.x-moveObj.mouseCoord.x,y:evt.y-moveObj.mouseCoord.y},moveObj.mouseCoord=evt,moveObj.css.top+=moveObj.moveDist.y,moveObj.css.left+=moveObj.moveDist.x,moveObj.totalDist={x:moveObj.totalDist.x+moveObj.moveDist.x,y:moveObj.totalDist.y+moveObj.moveDist.y},moveObj.gridCss={left:Math.round(moveObj.totalDist.x/grid)*grid+moveObj.startCoord.x,top:Math.round(moveObj.totalDist.y/grid)*grid+moveObj.startCoord.y},moveObj.css=moveObj.gridCss,moveObj.css.top=Math.min(Math.max(actualBounds.top[0],moveObj.css.top),actualBounds.top[1]),moveObj.css.left=Math.min(Math.max(actualBounds.left[0],moveObj.css.left),actualBounds.left[1]),moveObj.pctX=Math.max(actualBounds.left[0],moveObj.css.left)/moveObj.maxX,moveObj.pctY=Math.max(actualBounds.top[0],moveObj.css.top)/moveObj.maxY,el.css(moveObj.css),onmove&&onmove.call(moveObj)},unbind=function(evt){pointerId=null,isMoving=!1,$(document).off("mouseup touchend MSPointerUp",unbind),$(document).off("mousemove touchmove MSPointerMove",motionHandler),moveEnd(evt)},moveEnd=function(event){oncomplete&&oncomplete.call(moveObj),isMoving=moveObj.isMoving=!1,event&&event.preventDefault(),el.trigger("movecomplete",moveObj)},getCoord=function(evt){var coord={};return evt.originalEvent&&evt.originalEvent.targetTouches?(coord.x=evt.originalEvent.targetTouches[0].pageX,coord.y=evt.originalEvent.targetTouches[0].pageY):evt.originalEvent?(coord.x=evt.originalEvent.pageX,coord.y=evt.originalEvent.pageY):(coord.x=evt.pageX,coord.y=evt.pageY),coord};return bounds=(createArgs=createArgs).bounds||null,grid=createArgs.grid||1,el=createArgs.el,target=createArgs.target||el,onstart=createArgs.onstart,onmove=createArgs.onmove,oncomplete=createArgs.oncomplete,setBounds(),window.PointerEvent||window.MSPointerEvent?(target.css("touch-action","none"),createArgs=window.PointerEvent?"pointerdown":"MSPointerDown",pointerUpName=window.PointerEvent?"pointerup":"MSPointerUp",pointerMoveName=window.PointerEvent?"pointermove":"MSPointerMove",document.body.addEventListener(createArgs,function(event){target.hasClass("disabled")||event.target!==target[0]&&!$(target).has(event.target).length||isMoving||-1<event.target.className.indexOf("close")||(document.body.setPointerCapture?document.body.setPointerCapture(event.pointerId):document.body.msSetPointerCapture&&document.body.msSetPointerCapture(event.pointerId),event.preventDefault(),event.stopPropagation(),void 0!==event.pointerId&&(pointerId=event.pointerId),moveInit(event),document.body.addEventListener(pointerUpName,unbind,!1),document.body.addEventListener(pointerMoveName,function(evt){void 0!==pointerId&&evt.pointerId===pointerId&&motionHandler(evt)},!1))},!1)):target.on("mousedown touchstart",function(event){target.hasClass("disabled")||(event.preventDefault(),event.stopPropagation(),moveInit(event),$(document).on("mouseup touchend",unbind),$(document).on("mousemove touchmove",motionHandler))}),el.css({position:"absolute"}),{setBounds:setBounds}},wwt.getRGBArray=function(colorString){try{var rgb=[];if(0==colorString.indexOf("#"))if(colorString.length<=5)for(i=1;i<colorString.length;i++)rgb.push(16*parseInt("0x"+colorString.charAt(i),16));else for(i=1;i<colorString.length;i+=2)rgb.push(parseInt("0x"+colorString.substr(i,2),16));else for(var split=(colorString=-1!=colorString.indexOf(")")?colorString.split("(")[1].split(")")[0]:colorString).split(","),i=0;i<split.length;i++)rgb.push(parseFloat(split[i]));return rgb}catch(error){return error}},wwt.getHSV=function(c,rgb){c=(rgb=rgb||this.getRGBArray(c))[0],g=rgb[1],rgb=rgb[2],c/=255,g/=255,rgb/=255;var g,min=Math.min(Math.min(c,g),rgb),max=Math.max(Math.max(c,g),rgb),value=max,rgb=max==min?0:max==c?(g-rgb)/(max-min)*60%360:max==g?(rgb-c)/(max-min)*60+120:max==rgb?(c-g)/(max-min)*60+240:0;return rgb<0&&(rgb+=360),c=0==max?0:1-min/max,[Math.round(rgb),Math.round(100*c),Math.round(100*value)]},wwt.getHex=function(rgb){rgb=this.convertToIntArray(rgb);for(var hex="#",i=0;i<rgb.length;i++){var s=rgb[i].toString(16);hex+=1==s.length?"0"+s:s}return hex},wwt.rgbFromHSV=function(hsv){var h=hsv[0],s=hsv[1]/100,v=hsv[2]/100,hsv=Math.floor(h/60%6),h=h/60-hsv,p=v*(1-s),q=v*(1-h*s),t=v*(1-(1-h)*s),rgb=[];switch(hsv){case 0:rgb=[v,t,p];break;case 1:rgb=[q,v,p];break;case 2:rgb=[p,v,t];break;case 3:rgb=[p,q,v];break;case 4:rgb=[t,p,v];break;case 5:rgb=[v,p,q]}return[Math.min(255,Math.round(256*rgb[0])),Math.min(255,Math.round(256*rgb[1])),Math.min(255,Math.round(256*rgb[2]))]},wwt.blendColors=function(rgba1,rgba2,v1,v2,val){var ratio=(val-v1)/(v2-v1),rgba=[],val=!1;rgba1[3]&&rgba1[3]<=1&&0<=rgba1[3]&&(val=!0,rgba1[3]=Math.round(1e3*rgba1[3]),rgba2[3]=Math.round(1e3*rgba2[3]));for(var i=0;i<rgba1.length;i++){var hc=rgba2[i],lc=rgba1[i],reverse=hc<lc,hc=Math.round((reverse?lc-hc:hc-lc)*ratio);rgba[i]=reverse?lc-hc:hc+lc}return val&&(rgba[3]=rgba[3]/1e3,rgba1[3]=rgba1[3]/1e3,rgba2[3]=rgba2[3]/1e3),rgba},wwt.convertToIntArray=function(a){for(var i=0;i<a.length;i++)a[i]=parseInt(a[i]);return a},wwt.rnd=function(high){var r=16180339*Math.random()%1;return Math.floor(r*high+1)},wwt.getClickOffset=function(event){var coords_x=event.pageX,coords_y=event.pageY,event=$(event.target).offset();return{x:coords_x-event.left,y:coords_y-event.top}},wwt.getAngle=function(c1,c2,getDist){!c1.left&&0!=c1.left||(c1.x=c1.left,c1.y=c1.top,c2.x=c2.left,c2.y=c2.top);var dx=Math.abs(c1.x-c2.x),dy=Math.abs(c1.y-c2.y),dx=Math.sqrt(dx*dx+dy*dy),dy=3600-(dy=(3600+Math.round(Math.atan2(c2.y-c1.y,c2.x-c1.x)/6.28*3600))%3600);return dy/=10,getDist?{dist:dx,deg:dy%360}:dy%360},wwt.getCoordsFromDegrees=function(deg,r,midX,midY){return{x:midX+r*Math.cos(deg*(Math.PI/180)),y:midY-r*Math.sin(deg*(Math.PI/180))}},wwt.cssInt=function(el,attr){return parseInt(el.css(attr))},wwt.round=function(flt,precision){precision=Math.pow(10,precision);return Math.round(flt*precision)/precision},wwt.pct=function(v){return Math.round(1e3*v)/10+"%"},wwt.tweenStep=function(vFrom,vTo,curStep,steps,transition,easing){var b=vFrom,c=vTo-vFrom,t=curStep,d=steps;switch(transition){case 0:return c*t/d+b;case 1:switch(s=1.70158,easing){case 1:return c*(t/=d)*t*((s+1)*t-s)+b;case 2:return c*((t=t/d-1)*t*((s+1)*t+s)+1)+b;default:return(t/=d/2)<1?c/2*(t*t*((1+(s*=1.525))*t-s))+b:c/2*((t-=2)*t*((1+(s*=1.525))*t+s)+2)+b}case 2:var bounceOut=function(t,b,c,d){return(t/=d)<1/2.75?c*(7.5625*t*t)+b:t<2/2.75?c*(7.5625*(t-=1.5/2.75)*t+.75)+b:t<2.5/2.75?c*(7.5625*(t-=2.25/2.75)*t+.9375)+b:c*(7.5625*(t-=2.625/2.75)*t+.984375)+b},bounceIn=function(t,b,c,d){return c-bounceOut(d-t,0,c,d)+b};switch(easing){case 1:return bounceIn(t,b,c,d);case 2:return bounceOut(t,b,c,d);default:return t<d/2?.5*bounceIn(2*t,0,c,d)+b:.5*bounceOut(2*t-d,0,c,d)+.5*c+b}case 3:switch(easing){case 1:return-c*(Math.sqrt(1-(t/=d)*t)-1)+b;case 2:return c*Math.sqrt(1-(t=t/d-1)*t)+b;default:return(t/=d/2)<1?-c/2*(Math.sqrt(1-t*t)-1)+b:c/2*(Math.sqrt(1-(t-=2)*t)+1)+b}case 4:switch(easing){case 1:return c*(t/=d)*t*t+b;case 2:return c*((t=t/d-1)*t*t+1)+b;default:return(t/=d/2)<1?c/2*t*t*t+b:c/2*((t-=2)*t*t+2)+b}case 5:var s=.3*d/4,p=.3*d,a=c;switch(easing){case 1:return 0==t?b:1==(t/=d)?b+c:(s=p/(2*Math.PI)*Math.asin(c/a),-(a*Math.pow(2,10*--t)*Math.sin(2*Math.PI*(t*d-s)/p))+b);case 2:return 0==t?b:1==(t/=d)?b+c:(s=p/(2*Math.PI)*Math.asin(c/a),a*Math.pow(2,-10*t)*Math.sin(2*Math.PI*(t*d-s)/p)+c+b);default:return 0==t?b:2==(t/=d/2)?b+c:(p=d*(.3*1.5),s=!a||a<Math.abs(c)?(a=c,p/4):p/(2*Math.PI)*Math.asin(c/a),t<1?a*Math.pow(2,10*--t)*Math.sin(2*Math.PI*(t*d-s)/p)*-.5+b:a*Math.pow(2,-10*--t)*Math.sin(2*Math.PI*(t*d-s)/p)*.5+c+b)}case 6:switch(easing){case 1:return 0==t?b:c*Math.pow(2,10*(t/d-1))+b;case 2:return t==d?b+c:c*(1-Math.pow(2,-10*t/d))+b;default:return 0==t?b:t==d?b+c:(t/=d/2)<1?c/2*Math.pow(2,10*(t-1))+b:c/2*(2-Math.pow(2,-10*--t))+b}case 7:switch(easing){case 1:return c*(t/=d)*t+b;case 2:return-c*(t/=d)*(t-2)+b;default:return(t/=d/2)<1?c/2*t*t+b:-c/2*(--t*(t-2)-1)+b}case 8:switch(easing){case 1:return c*(t/=d)*t*t*t+b;case 2:return-c*((t=t/d-1)*t*t*t-1)+b;default:return(t/=d/2)<1?c/2*t*t*t*t+b:-c/2*((t-=2)*t*t*t-2)+b}case 9:switch(easing){case 1:return c*(t/=d)*t*t*t*t+b;case 2:return c*((t=t/d-1)*t*t*t*t+1)+b;default:return(t/=d/2)<1?c/2*t*t*t*t*t+b:c/2*((t-=2)*t*t*t*t+2)+b}case 10:switch(easing){case 1:return-c*Math.cos(t/d*(Math.PI/2))+c+b;case 2:return c*Math.sin(t/d*(Math.PI/2))+b;default:return-c/2*(Math.cos(Math.PI*t/d)-1)+b}}return 0},wwt.clone=function(obj){return $.parseJSON(JSON.stringify(obj))},wwt.requestFullScreen=function(element){element.requestFullscreen?element.requestFullscreen():element.msRequestFullscreen?element.msRequestFullscreen():element.mozRequestFullScreen?element.mozRequestFullScreen():element.webkitRequestFullscreen?element.webkitRequestFullscreen():console.log("Fullscreen API is not supported")},wwt.exitFullScreen=function(cb){var previousFullScreen=document.fullScreenElement||document.mozFullScreenElement||document.webkitFullscreenElement;previousFullScreen?previousFullScreen.cancelFullScreen?previousFullScreen.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),cb&&setTimeout(function(){cb({fullscreen:!1})},888)};